import{_ as W,l as X,u as Y,k as se,r as M,a as te,w as K,m as ne,b as c,p as Z,c as m,d as g,g as t,e as s,f as a,q as P,s as L,F as x,v as Q,h as ee,j as $,t as h,x as oe,y as ae,E as S,o as ie,i as I,z as re}from"./index-Dk6zR9k4.js";import{e as de,c as ue,g as me}from"./events-CUXDbKN2.js";import{E as J}from"./ElementTransition-B1nF07HC.js";const ce={class:"card glass-card"},pe={class:"header-with-tip"},ve={class:"time-input-container"},ge={class:"time-input-row"},fe={class:"time-input-field min-field"},_e={class:"time-input-field sec-field"},be={class:"time-input-field ms-field"},Ve={class:"time-input-field sec-field"},ke={class:"time-input-field ms-field"},ye={class:"format-toggle-container"},we={class:"toggle-switch"},Me={class:"time-input-container"},Se={class:"time-input-row"},Fe={class:"time-input-field min-field"},xe={class:"time-input-field sec-field"},$e={class:"time-input-field ms-field"},Te={class:"time-input-field sec-field"},Ue={class:"time-input-field ms-field"},Ce={class:"more-options-toggle"},he={class:"more-options"},Re={__name:"SubmitRecordForm",emits:["success"],setup(le,{emit:D}){const w=X(),f=Y(),R=se(),k=M(!1),y=M(!1),T=M(!1),p=i=>{const l=i?"minutes":"seconds";e.singleTimeFormat=l,e.averageTimeFormat=l,B("single"),B("average")},U=M(),e=te({category:"",event:"",single:null,average:null,singleTimeFormat:"seconds",averageTimeFormat:"seconds",singleMinutes:null,singleSeconds:null,singleMilliseconds:null,averageMinutes:null,averageSeconds:null,averageMilliseconds:null,cube:"",method:"",remark:"",videoLink:""});K([()=>e.singleTimeFormat,()=>e.averageTimeFormat],([i,l])=>{i!==l&&(e.averageTimeFormat=i),T.value=i==="minutes"});const z=ne(()=>{var i;return e.category?((i=de[e.category])==null?void 0:i.options)||[]:[]}),B=i=>{i==="single"?(e.singleMinutes=null,e.singleSeconds=null,e.singleMilliseconds=null):i==="average"&&(e.averageMinutes=null,e.averageSeconds=null,e.averageMilliseconds=null)};K(()=>e.event,i=>{i&&["444","555","666","777","meg","333bf","444bf","555bf","333mbf"].includes(i)&&(T.value=!0,p(!0))});const A=()=>{e.event=""},C=i=>i==="single"?e.singleTimeFormat==="seconds"?e.singleSeconds!==null||e.singleMilliseconds!==null:e.singleMinutes!==null||e.singleSeconds!==null||e.singleMilliseconds!==null:i==="average"?e.averageTimeFormat==="seconds"?e.averageSeconds!==null||e.averageMilliseconds!==null:e.averageMinutes!==null||e.averageSeconds!==null||e.averageMilliseconds!==null:!1,H={category:[{required:!0,message:"请选择项目类型",trigger:"change"}],event:[{required:!0,message:"请选择具体项目",trigger:"change"}],single:[{validator:(i,l,u)=>{u()},trigger:"blur"}],average:[{validator:(i,l,u)=>{const b=C("single"),F=C("average");!b&&!F?u(new Error("单次成绩和平均成绩至少填写一个")):u()},trigger:"blur"}]},N=i=>{if(i==="single")if(e.singleTimeFormat==="seconds"){const l=e.singleSeconds||0,u=e.singleMilliseconds||0;return l+u/100}else{const l=e.singleMinutes||0,u=e.singleSeconds||0,b=e.singleMilliseconds||0;return l*60+u+b/100}else if(i==="average")if(e.averageTimeFormat==="seconds"){const l=e.averageSeconds||0,u=e.averageMilliseconds||0;return l+u/100}else{const l=e.averageMinutes||0,u=e.averageSeconds||0,b=e.averageMilliseconds||0;return l*60+u+b/100}return null},d=async i=>{if(i)try{await i.validate(async l=>{if(l){k.value=!0;try{if(!f.user||!f.user._id){S.error("请先登录"),R.push("/login");return}const u=C("single")?N("single"):null,b=C("average")?N("average"):null,F={event:e.event,single:u?{time:u,nickname:f.user.nickname,userId:f.user._id}:null,average:b?{time:b,nickname:f.user.nickname,userId:f.user._id}:null,cube:e.cube||"",method:e.method||"",remark:e.remark||"",videoLink:e.videoLink||"",timestamp:new Date().toISOString()};await w.addRecord(F),n(i),S.success("成绩提交成功"),v("success")}catch(u){S.error(u.message||"提交失败，请重试")}finally{k.value=!1}}})}catch{S.error("表单验证失败，请检查输入"),k.value=!1}},n=i=>{i&&(i.resetFields(),e.singleTimeFormat="seconds",e.averageTimeFormat="seconds",T.value=!1,e.singleMinutes=null,e.singleSeconds=null,e.singleMilliseconds=null,e.averageMinutes=null,e.averageSeconds=null,e.averageMilliseconds=null,y.value=!1)},v=D;return(i,l)=>{const u=c("el-tooltip"),b=c("el-option"),F=c("el-select"),_=c("el-form-item"),V=c("el-input-number"),O=c("el-switch"),E=c("el-input"),G=c("el-icon"),r=c("el-button"),j=c("el-form"),q=Z("loading");return m(),g("div",ce,[t("div",pe,[l[21]||(l[21]=t("h2",{class:"text-2xl font-bold mb-6"},"上传成绩",-1)),s(u,{content:`开创新的【整活项目】可以联系群主添加：3169164181（q）
        或者直接在意见箱中写明`,placement:"top",effect:"light",class:"glass-popover"},{default:a(()=>l[20]||(l[20]=[t("span",{class:"new-project-tip"},"我想开创新项目",-1)])),_:1})]),P((m(),L(j,{ref_key:"formRef",ref:U,model:e,rules:H,"label-width":"100px",class:"max-w-xl glass-form"},{default:a(()=>[s(_,{label:"项目类型",prop:"category"},{default:a(()=>[s(F,{modelValue:e.category,"onUpdate:modelValue":l[0]||(l[0]=o=>e.category=o),placeholder:"请选择项目类型",class:"w-full glass-select",onChange:A},{default:a(()=>[(m(!0),g(x,null,Q(ee(ue),o=>(m(),L(b,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(_,{label:"具体项目",prop:"event"},{default:a(()=>[s(F,{modelValue:e.event,"onUpdate:modelValue":l[1]||(l[1]=o=>e.event=o),placeholder:"请选择具体项目",class:"w-full glass-select",disabled:!e.category},{default:a(()=>[(m(!0),g(x,null,Q(z.value,o=>(m(),L(b,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),s(_,{label:"单次成绩",prop:"single"},{default:a(()=>[t("div",ve,[t("div",ge,[e.singleTimeFormat==="minutes"?(m(),g(x,{key:0},[t("div",fe,[s(V,{modelValue:e.singleMinutes,"onUpdate:modelValue":l[2]||(l[2]=o=>e.singleMinutes=o),min:0,precision:0,step:1,controls:!1,placeholder:"",class:"number-input"},null,8,["modelValue"])]),l[22]||(l[22]=t("div",{class:"time-separator"},":",-1)),t("div",_e,[s(V,{modelValue:e.singleSeconds,"onUpdate:modelValue":l[3]||(l[3]=o=>e.singleSeconds=o),min:0,max:59,precision:0,step:1,controls:!1,placeholder:"",class:"number-input"},null,8,["modelValue"])]),l[23]||(l[23]=t("div",{class:"time-separator"},".",-1)),t("div",be,[s(V,{modelValue:e.singleMilliseconds,"onUpdate:modelValue":l[4]||(l[4]=o=>e.singleMilliseconds=o),min:0,max:99,precision:0,step:1,controls:!1,placeholder:"",class:"number-input"},null,8,["modelValue"])])],64)):(m(),g(x,{key:1},[t("div",Ve,[s(V,{modelValue:e.singleSeconds,"onUpdate:modelValue":l[5]||(l[5]=o=>e.singleSeconds=o),min:0,precision:0,step:1,controls:!1,placeholder:"",class:"number-input"},null,8,["modelValue"])]),l[24]||(l[24]=t("div",{class:"time-separator"},".",-1)),t("div",ke,[s(V,{modelValue:e.singleMilliseconds,"onUpdate:modelValue":l[6]||(l[6]=o=>e.singleMilliseconds=o),min:0,max:99,precision:0,step:1,controls:!1,placeholder:"",class:"number-input"},null,8,["modelValue"])])],64))]),t("div",ye,[l[25]||(l[25]=t("div",{class:"toggle-label"},"秒",-1)),t("div",we,[s(O,{modelValue:T.value,"onUpdate:modelValue":l[7]||(l[7]=o=>T.value=o),onChange:p,"active-color":"#409EFF","inactive-color":"#409EFF"},null,8,["modelValue"])]),l[26]||(l[26]=t("div",{class:"toggle-label"},"分:秒",-1))])])]),_:1}),s(_,{label:"平均成绩",prop:"average"},{default:a(()=>[t("div",Me,[t("div",Se,[e.averageTimeFormat==="minutes"?(m(),g(x,{key:0},[t("div",Fe,[s(V,{modelValue:e.averageMinutes,"onUpdate:modelValue":l[8]||(l[8]=o=>e.averageMinutes=o),min:0,precision:0,step:1,controls:!1,placeholder:"",class:"number-input"},null,8,["modelValue"])]),l[27]||(l[27]=t("div",{class:"time-separator"},":",-1)),t("div",xe,[s(V,{modelValue:e.averageSeconds,"onUpdate:modelValue":l[9]||(l[9]=o=>e.averageSeconds=o),min:0,max:59,precision:0,step:1,controls:!1,placeholder:"",class:"number-input"},null,8,["modelValue"])]),l[28]||(l[28]=t("div",{class:"time-separator"},".",-1)),t("div",$e,[s(V,{modelValue:e.averageMilliseconds,"onUpdate:modelValue":l[10]||(l[10]=o=>e.averageMilliseconds=o),min:0,max:99,precision:0,step:1,controls:!1,placeholder:"",class:"number-input"},null,8,["modelValue"])])],64)):(m(),g(x,{key:1},[t("div",Te,[s(V,{modelValue:e.averageSeconds,"onUpdate:modelValue":l[11]||(l[11]=o=>e.averageSeconds=o),min:0,precision:0,step:1,controls:!1,placeholder:"",class:"number-input"},null,8,["modelValue"])]),l[29]||(l[29]=t("div",{class:"time-separator"},".",-1)),t("div",Ue,[s(V,{modelValue:e.averageMilliseconds,"onUpdate:modelValue":l[12]||(l[12]=o=>e.averageMilliseconds=o),min:0,max:99,precision:0,step:1,controls:!1,placeholder:"",class:"number-input"},null,8,["modelValue"])])],64))])])]),_:1}),s(_,{label:"使用魔方",prop:"cube"},{default:a(()=>[s(E,{modelValue:e.cube,"onUpdate:modelValue":l[13]||(l[13]=o=>e.cube=o),placeholder:"选填，请输入使用的魔方型号"},null,8,["modelValue"])]),_:1}),s(_,{label:"使用方法",prop:"method"},{default:a(()=>[s(E,{modelValue:e.method,"onUpdate:modelValue":l[14]||(l[14]=o=>e.method=o),placeholder:"选填，请输入使用的方法"},null,8,["modelValue"])]),_:1}),t("div",Ce,[s(r,{type:"primary",link:"",onClick:l[15]||(l[15]=o=>y.value=!y.value)},{default:a(()=>[$(h(y.value?"收起更多选项":"展开更多选项")+" ",1),s(G,{class:"ml-1"},{default:a(()=>[(m(),L(oe(y.value?"ArrowUp":"ArrowDown")))]),_:1})]),_:1})]),P(t("div",he,[s(_,{label:"感想",prop:"remark"},{default:a(()=>[s(E,{modelValue:e.remark,"onUpdate:modelValue":l[16]||(l[16]=o=>e.remark=o),type:"textarea",rows:3,placeholder:"选填，记录你的感想"},null,8,["modelValue"])]),_:1}),s(_,{label:"视频链接",prop:"videoLink"},{default:a(()=>[s(E,{modelValue:e.videoLink,"onUpdate:modelValue":l[17]||(l[17]=o=>e.videoLink=o),placeholder:"选填，可附上你的视频链接地址"},null,8,["modelValue"])]),_:1})],512),[[ae,y.value]]),s(_,null,{default:a(()=>[s(r,{type:"primary",onClick:l[18]||(l[18]=o=>d(U.value)),loading:k.value},{default:a(()=>l[30]||(l[30]=[$("上传")])),_:1},8,["loading"]),s(r,{onClick:l[19]||(l[19]=o=>n(U.value))},{default:a(()=>l[31]||(l[31]=[$("重置")])),_:1})]),_:1})]),_:1},8,["model"])),[[q,k.value]])])}}},Ee=W(Re,[["__scopeId","data-v-fe1dbb6e"]]),De={class:"submit-container"},Ie={class:"page-header glass-header"},Le={class:"form-section"},Be={class:"card glass-card"},Ne={class:"history-header"},je={class:"records-list"},qe={class:"record-content"},ze={class:"record-main"},Ae={class:"event-name"},He={class:"record-times"},Oe={class:"record-time"},Ge={class:"record-time"},Je={class:"record-info"},Ke={class:"record-date"},Pe={class:"record-actions"},Qe={key:0,class:"record-cube"},We={key:1,class:"record-remark"},Xe={class:"glass-form"},Ye={class:"dialog-footer"},Ze={__name:"SubmitRecordView",setup(le){const D=X(),w=Y(),f=M([]),R=M(!1),k=async()=>{var d;if(!((d=w.user)!=null&&d._id)){f.value=[];return}R.value=!0;try{const n=await fetch(`https://w3mavh11ex.bja.sealos.run/users-history-record?userId=${w.user._id}`);if(!n.ok)throw new Error("获取历史记录失败");const v=await n.json();v.code===0?f.value=v.data||[]:(console.error("获取历史记录失败:",v.message),f.value=[])}catch(n){console.error("获取历史记录出错:",n),f.value=[],S.error("获取历史记录失败")}finally{R.value=!1}},y=M(!1),T=M(),p=M({}),U=M(null),e=d=>{var n,v;U.value=d,p.value={single:((n=d.single)==null?void 0:n.time)||null,average:((v=d.average)==null?void 0:v.time)||null,cube:d.cube||"",remark:d.remark||""},y.value=!0},z=async()=>{if(U.value)try{const d={...U.value,single:p.value.single?{time:p.value.single,nickname:w.user.nickname,userId:w.user._id}:null,average:p.value.average?{time:p.value.average,nickname:w.user.nickname,userId:w.user._id}:null,cube:p.value.cube,remark:p.value.remark};await D.updateRecord(d),y.value=!1,S.success("记录已更新"),await k()}catch(d){S.error("更新记录失败: "+d.message)}},B=async d=>{try{await re.confirm("确定要删除这条记录吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await D.deleteRecord(d._id),S.success("记录已删除"),await k()}catch(n){n!=="cancel"&&S.error("删除记录失败: "+n.message)}},A=async()=>{await k()},C=d=>D.formatTime(d),H=d=>d?new Date(d).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",N=async()=>{S.success("成绩上传成功！"),await k()};return K(()=>w.user,d=>{d?k():f.value=[]},{immediate:!0}),ie(()=>{w.user&&k()}),(d,n)=>{const v=c("el-button"),i=c("router-link"),l=c("el-col"),u=c("el-empty"),b=c("el-row"),F=c("el-input-number"),_=c("el-form-item"),V=c("el-input"),O=c("el-form"),E=c("el-dialog"),G=Z("loading");return m(),g("div",De,[s(J,{name:"fade",duration:600,appear:""},{default:a(()=>[t("div",Ie,[n[7]||(n[7]=t("h1",{class:"page-title"},"上传成绩",-1)),s(i,{to:"/records",class:"view-records-link"},{default:a(()=>[s(v,null,{default:a(()=>n[6]||(n[6]=[$("查看记录")])),_:1})]),_:1})])]),_:1}),s(b,{gutter:24},{default:a(()=>[s(l,{xs:24,sm:24,md:14},{default:a(()=>[s(J,{name:"slide-up",duration:600,delay:200,appear:""},{default:a(()=>[t("div",Le,[s(Ee,{onSuccess:N})])]),_:1})]),_:1}),s(l,{xs:24,sm:24,md:10},{default:a(()=>[s(J,{name:"slide-up",duration:600,delay:400,appear:""},{default:a(()=>[t("div",Be,[t("div",Ne,[n[9]||(n[9]=t("h2",{class:"section-title"},"上传历史",-1)),s(v,{type:"primary",text:"",onClick:A},{default:a(()=>n[8]||(n[8]=[$(" 刷新 ")])),_:1})]),P((m(),g("div",je,[f.value.length>0?(m(!0),g(x,{key:0},Q(f.value,r=>{var j,q;return m(),g("div",{key:r._id||r.timestamp,class:"record-item glass-effect-light"},[t("div",qe,[t("div",ze,[t("span",Ae,h(ee(me)(r.event)),1),t("div",He,[(j=r.single)!=null&&j.time?(m(),g(x,{key:0},[n[10]||(n[10]=t("span",{class:"record-label"},"单次:",-1)),t("span",Oe,h(C(r.single.time)),1)],64)):I("",!0),(q=r.average)!=null&&q.time?(m(),g(x,{key:1},[n[11]||(n[11]=t("span",{class:"record-label"},"平均:",-1)),t("span",Ge,h(C(r.average.time)),1)],64)):I("",!0)])]),t("div",Je,[t("span",Ke,h(H(r.timestamp)),1),t("div",Pe,[s(v,{type:"primary",link:"",onClick:o=>e(r)},{default:a(()=>n[12]||(n[12]=[$(" 修改 ")])),_:2},1032,["onClick"]),s(v,{type:"danger",link:"",onClick:o=>B(r)},{default:a(()=>n[13]||(n[13]=[$(" 删除 ")])),_:2},1032,["onClick"])])]),r.cube?(m(),g("div",Qe," 使用魔方: "+h(r.cube),1)):I("",!0),r.remark?(m(),g("div",We," 感想: "+h(r.remark),1)):I("",!0)])])}),128)):R.value?I("",!0):(m(),L(u,{key:1,description:"暂无上传记录","image-size":200},{description:a(()=>n[14]||(n[14]=[t("p",null,"暂无上传记录",-1),t("p",{class:"empty-tip"},"开始上传你的第一个成绩吧！",-1)])),_:1}))])),[[G,R.value]])])]),_:1})]),_:1})]),_:1}),s(E,{modelValue:y.value,"onUpdate:modelValue":n[5]||(n[5]=r=>y.value=r),title:"修改记录",width:"500px",class:"glass-dialog"},{footer:a(()=>[t("span",Ye,[s(v,{onClick:n[4]||(n[4]=r=>y.value=!1)},{default:a(()=>n[15]||(n[15]=[$("取消")])),_:1}),s(v,{type:"primary",onClick:z},{default:a(()=>n[16]||(n[16]=[$(" 确认 ")])),_:1})])]),default:a(()=>[t("div",Xe,[s(O,{ref_key:"editFormRef",ref:T,model:p.value,"label-width":"100px"},{default:a(()=>[s(_,{label:"单次成绩"},{default:a(()=>[s(F,{modelValue:p.value.single,"onUpdate:modelValue":n[0]||(n[0]=r=>p.value.single=r),min:0,precision:2,step:.01,class:"full-width"},null,8,["modelValue"])]),_:1}),s(_,{label:"平均成绩"},{default:a(()=>[s(F,{modelValue:p.value.average,"onUpdate:modelValue":n[1]||(n[1]=r=>p.value.average=r),min:0,precision:2,step:.01,class:"full-width"},null,8,["modelValue"])]),_:1}),s(_,{label:"使用魔方"},{default:a(()=>[s(V,{modelValue:p.value.cube,"onUpdate:modelValue":n[2]||(n[2]=r=>p.value.cube=r)},null,8,["modelValue"])]),_:1}),s(_,{label:"感想"},{default:a(()=>[s(V,{modelValue:p.value.remark,"onUpdate:modelValue":n[3]||(n[3]=r=>p.value.remark=r),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}},tl=W(Ze,[["__scopeId","data-v-d1d8ba3e"]]);export{tl as default};
