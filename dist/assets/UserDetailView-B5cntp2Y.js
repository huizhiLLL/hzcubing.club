import{_ as Ce,T as Ie,u as Te,a as Ve,r as k,c as y,i as xe,g as z,b as O,e as Be,w as ze,f as J,E as de,o as Ee,j as R,k as De,l,m as i,n as d,p as u,q as a,v as p,t as v,y as ue,z as b,x as m,F as S,A as ce,s as Y}from"./index-PkMhL9Jo.js";import{E as ve}from"./ElementTransition-CBiVA3Qv.js";const Ue={class:"profile-container"},Ae={class:"card profile-header glass-card"},Oe={class:"user-profile"},$e={key:0,class:"avatar-container"},je={class:"user-info"},Le={class:"nickname"},Me={class:"bio"},Fe={key:0,class:"wca-id"},Pe={class:"card glass-card"},He={class:"section-header"},We={key:0,class:"record-value"},Ge={key:1},qe={key:0,class:"record-value"},Je={key:1},Ye={class:"card glass-card"},Ke={class:"section-header"},Qe={class:"filter-controls"},Xe=["onClick"],Ze={key:0,class:"pagination-container"},et={class:"card glass-card"},tt={class:"stats-container"},st={key:0,class:"stats-message"},at={class:"highlight-number"},nt={class:"highlight-number"},lt={class:"highlight-number"},ot={class:"highlight-number"},rt={key:1,class:"stats-message"},it={key:0,class:"medal-container"},dt={class:"rank-list"},ut={class:"event-name"},ct={class:"rank-badges"};const vt={key:0,class:"record-details"},gt={class:"detail-item"},ft={class:"detail-value"},mt={class:"detail-item"},pt={class:"detail-value"},_t={key:0,class:"detail-item"},kt={class:"detail-value"},yt={class:"detail-item"},bt={class:"detail-value"},ht={key:0,class:"detail-item"},Rt={class:"detail-value"},St={key:2,class:"detail-item"},wt={class:"detail-value"},Nt={key:3,class:"detail-item"},Ct={class:"detail-value"},It={key:4,class:"detail-item"},Tt={class:"detail-value"},Vt={key:5,class:"detail-item"},xt=["href"],Bt={class:"detail-item"},zt={class:"detail-value"},Et={__name:"UserDetailView",setup(Dt){const K=Ie();Te();const M=Ve(),w=k(null),C=k({}),N=k([]),F=k(!0),P=k(!1),Q=k("personal-bests"),$=k("all"),V=k("all"),H=k("latest"),E=k(1),D=k(10),W=k(!1),f=k(null),U=y(()=>K.params.id);y(()=>xe());const X=y(()=>{const t=[];for(const[e,s]of Object.entries(C.value||{}))s&&(!isNaN(s.singleSeconds)||!isNaN(s.averageSeconds))&&t.push({event:e,eventName:O(e),eventType:z(e),...s});return t.sort((e,s)=>{var L;const r={official:1,fun:2,meme:3},g=r[e.eventType]-r[s.eventType];if(g!==0)return g;const _=((L=Be[e.eventType])==null?void 0:L.options)||[],c=_.findIndex(A=>A.value===e.event),o=_.findIndex(A=>A.value===s.event);return(c===-1?999:c)-(o===-1?999:o)}),t}),ge=y(()=>$.value==="all"?X.value:X.value.filter(t=>t.eventType===$.value)),fe=y(()=>{let t=N.value.map(r=>({...r,eventName:O(r.event)}));V.value!=="all"&&(t=t.filter(r=>r.event===V.value)),H.value==="fastest"?t.sort((r,g)=>{const _=r.singleSeconds??1/0,c=g.singleSeconds??1/0;return _-c}):t.sort((r,g)=>{const _=new Date(r.timestamp);return new Date(g.timestamp)-_});const e=(E.value-1)*D.value,s=e+D.value;return t.slice(e,s)}),Z=y(()=>V.value==="all"?N.value.length:N.value.filter(t=>t.event===V.value).length),me=y(()=>{const t=new Set;return N.value.forEach(e=>{e.event&&t.add(e.event)}),Array.from(t).sort()}),ee=y(()=>N.value.length),pe=y(()=>{const t=new Set;return N.value.forEach(e=>{t.add(e.event)}),t.size}),I=k(0),T=k(0),_e=y(()=>{const t={};return N.value.forEach(e=>{t[e.event]||(t[e.event]=0),t[e.event]++}),t}),Ut=y(()=>{const t=Object.values(_e.value);return t.length>0?Math.max(...t):0}),x=t=>{if(!t||isNaN(t))return"-";if(t<60)return t.toFixed(2);const e=Math.floor(t/60),s=(t%60).toFixed(2).padStart(5,"0");return`${e}:${s}`},te=(t,e=!1)=>{if(!t)return"-";try{const s=new Date(t.$date||t),r=s.getFullYear(),g=String(s.getMonth()+1).padStart(2,"0"),_=String(s.getDate()).padStart(2,"0");let c=`${r}.${g}.${_}`;if(e){const o=String(s.getHours()).padStart(2,"0"),h=String(s.getMinutes()).padStart(2,"0");c+=` ${o}:${h}`}return c}catch{return"日期格式错误"}},ke=t=>{console.log("Record details:",JSON.stringify(t,null,2));const e={...t,cube:t.cube,method:t.method,remark:t.remark,videoLink:t.videoLink};f.value=e,W.value=!0},ye=t=>{D.value=t,E.value=1},be=t=>{E.value=t},se=async()=>{F.value=!0;try{const t=await J.getUser(U.value);t.code===0&&t.data?w.value=t.data:de.error(t.message||"获取用户信息失败")}catch(t){console.error("获取用户信息出错:",t),de.error(t.message||"获取用户信息失败")}finally{F.value=!1}},ae=async()=>{try{const t=await J.getUsersBestRecord(U.value);if(t.code===200&&t.data){const e={};(t.data||[]).forEach(s=>{e[s.event]={singleSeconds:typeof s.bestSingleSeconds=="number"?s.bestSingleSeconds:null,averageSeconds:typeof s.bestAverageSeconds=="number"?s.bestAverageSeconds:null}}),C.value=e}else console.error("获取用户成绩失败:",t.message)}catch(t){console.error("获取用户成绩出错:",t)}},ne=async()=>{P.value=!0;try{const t=await J.getUsersHistoryRecord(U.value);if(t.code===200&&t.data){const e=(t.data||[]).map(s=>({...s,singleSeconds:typeof s.singleSeconds=="number"?s.singleSeconds:s.single&&typeof s.single.time=="number"?s.single.time:null,averageSeconds:typeof s.averageSeconds=="number"?s.averageSeconds:s.average&&typeof s.average.time=="number"?s.average.time:null}));N.value=e,await he()}else console.error("获取用户历史成绩失败:",t.message)}catch(t){console.error("获取用户历史成绩出错:",t)}finally{P.value=!1}},he=async()=>{try{M.records.length===0&&await M.fetchRecords(),Re()}catch(t){console.error("加载排行榜数据出错:",t),I.value=G(),T.value=q()}},Re=()=>{try{for(const[t,e]of Object.entries(C.value)){if(z(t)==="meme")continue;const r=M.getRecordsByEvent(t);if(!isNaN(e.singleSeconds)){const g=new Map;r.forEach(o=>{!o.userId||o.singleSeconds==null||(!g.has(o.userId)||o.singleSeconds<g.get(o.userId).time)&&g.set(o.userId,{userId:o.userId,time:o.singleSeconds})});const c=Array.from(g.values()).sort((o,h)=>o.time-h.time).findIndex(o=>o.userId===U.value)+1;c>0&&(e.singleRank=c)}if(!isNaN(e.averageSeconds)){const g=new Map;r.forEach(o=>{!o.userId||o.averageSeconds==null||(!g.has(o.userId)||o.averageSeconds<g.get(o.userId).time)&&g.set(o.userId,{userId:o.userId,time:o.averageSeconds})});const c=Array.from(g.values()).sort((o,h)=>o.time-h.time).findIndex(o=>o.userId===U.value)+1;c>0&&(e.averageRank=c)}}I.value=G(),T.value=q()}catch(t){console.error("计算排名信息出错:",t),I.value=G(),T.value=q()}},G=()=>{let t=0;for(const[e,s]of Object.entries(C.value))z(e)!=="meme"&&(s.singleRank&&s.singleRank<=3||s.averageRank&&s.averageRank<=3)&&t++;return t},q=()=>{let t=0;for(const[e,s]of Object.entries(C.value))z(e)!=="meme"&&(s.singleRank===1||s.averageRank===1)&&t++;return t};ze(()=>K.params.id,()=>{se(),ae(),ne()}),Ee(()=>{se(),ae(),ne()});const j=t=>t!=null&&t!=="null"&&t!=="",Se=t=>t?t.includes("default-avatar")||t==="/default-avatar.svg":!0,we=y(()=>{const t={};for(const[e,s]of Object.entries(C.value))z(e)!=="meme"&&(s.singleRank&&s.singleRank<=3||s.averageRank&&s.averageRank<=3)&&(t[e]=s);return t}),Ne=y(()=>{const t=[];for(const[e,s]of Object.entries(we.value))t.push({eventCode:e,singleRank:s.singleRank,averageRank:s.averageRank,rankWeight:Math.min(s.singleRank&&s.singleRank<=3?s.singleRank:999,s.averageRank&&s.averageRank<=3?s.averageRank:999)});return t.sort((e,s)=>e.rankWeight-s.rankWeight)});return y(()=>{const t={};for(const[e,s]of Object.entries(C.value))z(e)!=="meme"&&(s.singleRank===1||s.averageRank===1)&&(t[e]=s);return t}),(t,e)=>{const s=R("el-avatar"),r=R("el-option"),g=R("el-select"),_=R("el-table-column"),c=R("el-tag"),o=R("el-table"),h=R("el-tab-pane"),le=R("el-pagination"),L=R("el-tabs"),A=R("el-dialog"),oe=De("loading");return l(),i("div",Ue,[d(ve,{name:"zoom",duration:600,appear:""},{default:u(()=>{var n,B,re,ie;return[a("div",Ae,[a("div",Oe,[(n=w.value)!=null&&n.avatar&&!Se(w.value.avatar)?(l(),i("div",$e,[d(s,{size:128,src:w.value.avatar,class:"avatar"},null,8,["src"])])):p("",!0),a("div",je,[a("h1",Le,v(((B=w.value)==null?void 0:B.nickname)||"加载中..."),1),a("p",Me,v(((re=w.value)==null?void 0:re.bio)||"这个人很懒，什么都没写~"),1),(ie=w.value)!=null&&ie.wcaId?(l(),i("p",Fe,"WCA ID: "+v(w.value.wcaId),1)):p("",!0)])])])]}),_:1}),d(ve,{name:"slide-up",duration:600,delay:200,appear:""},{default:u(()=>[d(L,{modelValue:Q.value,"onUpdate:modelValue":e[5]||(e[5]=n=>Q.value=n),class:"profile-tabs glass-tabs"},{default:u(()=>[d(h,{label:"个人最佳",name:"personal-bests"},{default:u(()=>[a("div",Pe,[a("div",He,[e[7]||(e[7]=a("div",null,null,-1)),d(g,{modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=n=>$.value=n),placeholder:"项目类型",size:"small",style:{width:"120px"},class:"glass-select"},{default:u(()=>[d(r,{label:"全部类型",value:"all"}),d(r,{label:"官方项目",value:"official"}),d(r,{label:"趣味项目",value:"fun"}),d(r,{label:"整活项目",value:"meme"})]),_:1},8,["modelValue"])]),ue((l(),b(o,{data:ge.value,style:{width:"100%"},"empty-text":"该选手暂无成绩记录",class:"glass-table"},{default:u(()=>[d(_,{label:"项目",prop:"eventName","min-width":"120"}),d(_,{label:"单次","min-width":"120"},{default:u(n=>[isNaN(n.row.singleSeconds)?(l(),i("span",Ge,"-")):(l(),i("div",We,[m(v(x(n.row.singleSeconds))+" ",1),n.row.singleRank===1?(l(),b(c,{key:0,size:"small",type:"danger",effect:"dark",class:"gr-tag"},{default:u(()=>e[8]||(e[8]=[m(" GR ")])),_:1})):p("",!0)]))]),_:1}),d(_,{label:"平均","min-width":"120"},{default:u(n=>[isNaN(n.row.averageSeconds)?(l(),i("span",Je,"-")):(l(),i("div",qe,[m(v(x(n.row.averageSeconds))+" ",1),n.row.averageRank===1?(l(),b(c,{key:0,size:"small",type:"danger",effect:"dark",class:"gr-tag"},{default:u(()=>e[9]||(e[9]=[m(" GR ")])),_:1})):p("",!0)]))]),_:1})]),_:1},8,["data"])),[[oe,F.value]])])]),_:1}),d(h,{label:"历史成绩",name:"history"},{default:u(()=>[a("div",Ye,[a("div",Ke,[e[10]||(e[10]=a("h2",{class:"section-title"},"历史成绩",-1)),a("div",Qe,[d(g,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=n=>V.value=n),placeholder:"选择项目",size:"small",class:"glass-select"},{default:u(()=>[d(r,{label:"全部项目",value:"all"}),(l(!0),i(S,null,ce(me.value,n=>(l(),b(r,{key:n,label:Y(O)(n),value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),d(g,{modelValue:H.value,"onUpdate:modelValue":e[2]||(e[2]=n=>H.value=n),placeholder:"排序方式",size:"small",class:"glass-select"},{default:u(()=>[d(r,{label:"最新优先",value:"latest"}),d(r,{label:"最快优先",value:"fastest"})]),_:1},8,["modelValue"])])]),ue((l(),b(o,{data:fe.value,style:{width:"100%"},"empty-text":"暂无历史成绩记录",class:"glass-table"},{default:u(()=>[d(_,{label:"项目",prop:"eventName","min-width":"100"}),d(_,{label:"单次","min-width":"100"},{default:u(n=>[a("span",null,v(x(n.row.singleSeconds)),1)]),_:1}),d(_,{label:"平均","min-width":"100"},{default:u(n=>[a("span",null,v(x(n.row.averageSeconds)),1)]),_:1}),d(_,{label:"提交时间","min-width":"160"},{default:u(n=>[a("div",{class:"record-cell",onClick:B=>ke(n.row)},[a("span",null,v(te(n.row.timestamp)),1),e[11]||(e[11]=a("span",{class:"detail-text"}," 详情 ",-1))],8,Xe)]),_:1})]),_:1},8,["data"])),[[oe,P.value]]),Z.value>0?(l(),i("div",Ze,[d(le,{"current-page":E.value,"onUpdate:currentPage":e[3]||(e[3]=n=>E.value=n),"page-size":D.value,"onUpdate:pageSize":e[4]||(e[4]=n=>D.value=n),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",total:Z.value,onSizeChange:ye,onCurrentChange:be},null,8,["current-page","page-size","total"])])):p("",!0)])]),_:1}),d(h,{label:"统计分析",name:"statistics"},{default:u(()=>[a("div",et,[e[27]||(e[27]=a("h2",{class:"section-title"},null,-1)),a("div",tt,[ee.value>0?(l(),i("div",st,[T.value>0?(l(),i(S,{key:0},[e[12]||(e[12]=m(" 该选手一共在 ")),a("span",at,v(T.value),1),e[13]||(e[13]=m(" 个项目中取得了第一名 "))],64)):p("",!0),I.value>0?(l(),i(S,{key:1},[T.value>0?(l(),i(S,{key:0},[m("，")],64)):(l(),i(S,{key:1},[m("该选手")],64)),e[14]||(e[14]=m(" 在 ")),a("span",nt,v(I.value),1),e[15]||(e[15]=m(" 个项目中取得了前三名 "))],64)):p("",!0),T.value>0||I.value>0?(l(),i(S,{key:2},[m("，")],64)):(l(),i(S,{key:3},[m("该选手")],64)),e[16]||(e[16]=m(" 总共参与了 ")),a("span",lt,v(pe.value),1),e[17]||(e[17]=m(" 个项目， 上传了 ")),a("span",ot,v(ee.value),1),e[18]||(e[18]=m(" 个成绩数 "))])):(l(),i("div",rt," 该选手还未参与任何项目哦 "))]),I.value>0?(l(),i("div",it,[e[25]||(e[25]=a("h3",{class:"chart-title"},"排名分布",-1)),a("div",dt,[(l(!0),i(S,null,ce(Ne.value,(n,B)=>(l(),i("div",{key:B,class:"rank-item"},[a("span",ut,v(Y(O)(n.eventCode)),1),a("div",ct,[n.singleRank===1?(l(),b(c,{key:0,type:"danger",effect:"dark",size:"small",round:""},{default:u(()=>e[19]||(e[19]=[m(" 单次 #1 ")])),_:1})):n.singleRank===2?(l(),b(c,{key:1,type:"warning",effect:"dark",size:"small",round:""},{default:u(()=>e[20]||(e[20]=[m(" 单次 #2 ")])),_:1})):n.singleRank===3?(l(),b(c,{key:2,type:"success",effect:"dark",size:"small",round:""},{default:u(()=>e[21]||(e[21]=[m(" 单次 #3 ")])),_:1})):p("",!0),n.averageRank===1?(l(),b(c,{key:3,type:"danger",effect:"dark",size:"small",round:""},{default:u(()=>e[22]||(e[22]=[m(" 平均 #1 ")])),_:1})):n.averageRank===2?(l(),b(c,{key:4,type:"warning",effect:"dark",size:"small",round:""},{default:u(()=>e[23]||(e[23]=[m(" 平均 #2 ")])),_:1})):n.averageRank===3?(l(),b(c,{key:5,type:"success",effect:"dark",size:"small",round:""},{default:u(()=>e[24]||(e[24]=[m(" 平均 #3 ")])),_:1})):p("",!0)])]))),128))])])):p("",!0),p("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),d(A,{modelValue:W.value,"onUpdate:modelValue":e[6]||(e[6]=n=>W.value=n),title:"成绩详情",width:"500px"},{default:u(()=>[f.value?(l(),i("div",vt,[a("div",gt,[e[28]||(e[28]=a("span",{class:"detail-label"},"项目:",-1)),a("span",ft,v(Y(O)(f.value.event)),1)]),isNaN(f.value.singleSeconds)?p("",!0):(l(),i(S,{key:0},[a("div",mt,[e[29]||(e[29]=a("span",{class:"detail-label"},"单次成绩:",-1)),a("span",pt,v(x(f.value.singleSeconds)),1)]),f.value.singleRank?(l(),i("div",_t,[e[30]||(e[30]=a("span",{class:"detail-label"},"单次排名:",-1)),a("span",kt,"#"+v(f.value.singleRank),1)])):p("",!0)],64)),isNaN(f.value.averageSeconds)?p("",!0):(l(),i(S,{key:1},[a("div",yt,[e[31]||(e[31]=a("span",{class:"detail-label"},"平均成绩:",-1)),a("span",bt,v(x(f.value.averageSeconds)),1)]),f.value.averageRank?(l(),i("div",ht,[e[32]||(e[32]=a("span",{class:"detail-label"},"平均排名:",-1)),a("span",Rt,"#"+v(f.value.averageRank),1)])):p("",!0)],64)),j(f.value.cube)?(l(),i("div",St,[e[33]||(e[33]=a("span",{class:"detail-label"},"使用魔方:",-1)),a("span",wt,v(f.value.cube),1)])):p("",!0),j(f.value.method)?(l(),i("div",Nt,[e[34]||(e[34]=a("span",{class:"detail-label"},"解法:",-1)),a("span",Ct,v(f.value.method),1)])):p("",!0),j(f.value.remark)?(l(),i("div",It,[e[35]||(e[35]=a("span",{class:"detail-label"},"感想:",-1)),a("span",Tt,v(f.value.remark),1)])):p("",!0),j(f.value.videoLink)?(l(),i("div",Vt,[e[36]||(e[36]=a("span",{class:"detail-label"},"视频链接:",-1)),a("a",{href:f.value.videoLink,target:"_blank",class:"video-link"},v(f.value.videoLink),9,xt)])):p("",!0),a("div",Bt,[e[37]||(e[37]=a("span",{class:"detail-label"},"提交时间:",-1)),a("span",zt,v(te(f.value.timestamp,!0)),1)])])):p("",!0)]),_:1},8,["modelValue"])])}}},jt=Ce(Et,[["__scopeId","data-v-809f49ff"]]);export{jt as default};
