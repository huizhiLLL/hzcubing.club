import{_ as we,J as ke,r as g,m as f,w as Ne,E as ae,o as Re,b as p,p as Ve,c as n,d,e as l,f as o,g as a,t as i,i as _,q as se,s as R,j as D,F as E,v as P,h as le,K as xe}from"./index-Dk6zR9k4.js";import{E as ne}from"./ElementTransition-B1nF07HC.js";import{a as ze,b as Ce,g as L}from"./events-CUXDbKN2.js";const De={class:"profile-container"},Ee={class:"card profile-header glass-card"},Ue={class:"user-profile"},je={class:"avatar-container"},Ie={class:"user-info"},Te={class:"nickname"},Le={class:"bio"},Se={key:0,class:"wca-id"},$e={class:"card glass-card"},Be={class:"section-header"},Oe={key:0,class:"record-value"},Fe={key:1},Pe={key:0,class:"record-value"},Me={key:1},He={class:"card glass-card"},Ae={class:"section-header"},Je={class:"filter-controls"},qe={key:0,class:"pagination-container"},Ge={class:"card glass-card"},Ke={class:"stat-card glass-stat-card"},We={class:"stat-value"},Qe={class:"stat-card glass-stat-card"},Xe={class:"stat-value"},Ye={class:"stat-card glass-stat-card"},Ze={class:"stat-value"},et={class:"stat-card glass-stat-card"},tt={class:"stat-value"},at={key:0,class:"chart-container"},st={class:"event-distribution"},lt={class:"event-name"},nt={class:"bar-container"},ot={class:"bar-value"},it={key:1,class:"activity-chart"},rt={key:0,class:"record-details"},dt={class:"detail-item"},ut={class:"detail-value"},ct={class:"detail-item"},vt={class:"detail-value"},mt={key:0,class:"detail-item"},_t={class:"detail-value"},pt={class:"detail-item"},gt={class:"detail-value"},ft={key:0,class:"detail-item"},ht={class:"detail-value"},bt={key:2,class:"detail-item"},yt={class:"detail-value"},wt={key:3,class:"detail-item"},kt={class:"detail-value"},Nt={key:4,class:"detail-item"},Rt={class:"detail-value"},Vt={key:5,class:"detail-item"},xt=["href"],zt={class:"detail-item"},Ct={class:"detail-value"},Dt={__name:"UserDetailView",setup(Et){const M=ke(),y=g(null),U=g({}),b=g([]),S=g(!0),$=g(!1),H=g("personal-bests"),j=g("all"),w=g("all"),B=g("latest"),V=g(1),x=g(10),O=g(!1),r=g(null),F=f(()=>M.params.id),oe=f(()=>ze()),A=f(()=>{const t=[];for(const[e,c]of Object.entries(U.value||{}))c&&(c.single&&!isNaN(c.single.time)||c.average&&!isNaN(c.average.time))&&t.push({event:e,eventName:L(e),eventType:Ce(e),...c});return t}),ie=f(()=>j.value==="all"?A.value:A.value.filter(t=>t.eventType===j.value)),re=f(()=>{let t=b.value.map(u=>({...u,eventName:L(u.event)}));w.value!=="all"&&(t=t.filter(u=>u.event===w.value)),B.value==="fastest"?t.sort((u,h)=>{var C,N;const m=((C=u.single)==null?void 0:C.time)||1/0,z=((N=h.single)==null?void 0:N.time)||1/0;return m-z}):t.sort((u,h)=>{const m=new Date(u.timestamp);return new Date(h.timestamp)-m});const e=(V.value-1)*x.value,c=e+x.value;return t.slice(e,c)}),J=f(()=>w.value==="all"?b.value.length:b.value.filter(t=>t.event===w.value).length),q=f(()=>b.value.length),G=f(()=>{const t=new Set;return b.value.forEach(e=>{t.add(e.event)}),t.size}),de=f(()=>Object.values(U.value||{}).filter(t=>t.singleRank&&t.singleRank<=3||t.averageRank&&t.averageRank<=3).length),ue=f(()=>Object.values(U.value||{}).filter(t=>t.singleRank===1||t.averageRank===1).length),K=f(()=>{const t={};return b.value.forEach(e=>{t[e.event]||(t[e.event]=0),t[e.event]++}),t}),ce=f(()=>{const t=Object.values(K.value);return t.length>0?Math.max(...t):0}),k=t=>{if(!t||isNaN(t))return"-";if(t<60)return t.toFixed(2);const e=Math.floor(t/60),c=(t%60).toFixed(2).padStart(5,"0");return`${e}:${c}`},W=(t,e=!1)=>{if(!t)return"-";try{const c=new Date(t.$date||t);return e?c.toLocaleString("zh-CN"):c.toLocaleDateString("zh-CN")}catch{return"日期格式错误"}},ve=t=>{var c,u,h,m;console.log("Record details:",JSON.stringify(t,null,2));const e={...t,cube:t.cube||((c=t.single)==null?void 0:c.cube)||((u=t.average)==null?void 0:u.cube),method:t.method||((h=t.single)==null?void 0:h.method)||((m=t.average)==null?void 0:m.method),remark:t.remark,videoLink:t.videoLink};r.value=e,O.value=!0},me=t=>{x.value=t,V.value=1},_e=t=>{V.value=t},Q=async()=>{S.value=!0;try{const t=await fetch(`https://w3mavh11ex.bja.sealos.run/user?userId=${F.value}`);if(!t.ok)throw new Error("获取用户信息失败");const e=await t.json();e.code===0&&e.data?y.value=e.data:ae.error(e.message||"获取用户信息失败")}catch(t){console.error("获取用户信息出错:",t),ae.error(t.message||"获取用户信息失败")}finally{S.value=!1}},X=async()=>{try{const t=await fetch(`https://w3mavh11ex.bja.sealos.run/users-best-record?userId=${F.value}`);if(!t.ok)throw new Error("获取用户成绩失败");const e=await t.json();e.code===0&&e.data?U.value=e.data:console.error("获取用户成绩失败:",e.message)}catch(t){console.error("获取用户成绩出错:",t)}},Y=async()=>{$.value=!0;try{const t=await fetch(`https://w3mavh11ex.bja.sealos.run/users-history-record?userId=${F.value}`);if(!t.ok)throw new Error("获取用户历史成绩失败");const e=await t.json();e.code===0&&e.data?b.value=e.data:console.error("获取用户历史成绩失败:",e.message)}catch(t){console.error("获取用户历史成绩出错:",t)}finally{$.value=!1}};Ne(()=>M.params.id,()=>{Q(),X(),Y()}),Re(()=>{Q(),X(),Y()});const I=t=>t!=null&&t!=="null"&&t!=="";return(t,e)=>{const c=p("el-avatar"),u=p("el-option"),h=p("el-select"),m=p("el-table-column"),z=p("el-tag"),C=p("el-table"),N=p("el-tab-pane"),pe=p("el-option-group"),ge=p("el-button"),fe=p("el-pagination"),T=p("el-col"),he=p("el-row"),be=p("el-tabs"),ye=p("el-dialog"),Z=Ve("loading");return n(),d("div",De,[l(ne,{name:"zoom",duration:600,appear:""},{default:o(()=>{var s,v,ee,te;return[a("div",Ee,[a("div",Ue,[a("div",je,[l(c,{size:128,src:((s=y.value)==null?void 0:s.avatar)||"/default-avatar.svg",class:"avatar"},null,8,["src"])]),a("div",Ie,[a("h1",Te,i(((v=y.value)==null?void 0:v.nickname)||"加载中..."),1),a("p",Le,i(((ee=y.value)==null?void 0:ee.bio)||"这个人很懒，什么都没写~"),1),(te=y.value)!=null&&te.wcaId?(n(),d("p",Se,"WCA ID: "+i(y.value.wcaId),1)):_("",!0)])])])]}),_:1}),l(ne,{name:"slide-up",duration:600,delay:200,appear:""},{default:o(()=>[l(be,{modelValue:H.value,"onUpdate:modelValue":e[5]||(e[5]=s=>H.value=s),class:"profile-tabs glass-tabs"},{default:o(()=>[l(N,{label:"个人最佳",name:"personal-bests"},{default:o(()=>[a("div",$e,[a("div",Be,[e[7]||(e[7]=a("div",null,null,-1)),l(h,{modelValue:j.value,"onUpdate:modelValue":e[0]||(e[0]=s=>j.value=s),placeholder:"项目类型",size:"small",style:{width:"120px"},class:"glass-select"},{default:o(()=>[l(u,{label:"全部类型",value:"all"}),l(u,{label:"官方项目",value:"official"}),l(u,{label:"趣味项目",value:"fun"}),l(u,{label:"整活项目",value:"meme"})]),_:1},8,["modelValue"])]),se((n(),R(C,{data:ie.value,style:{width:"100%"},"empty-text":"该选手暂无成绩记录",class:"glass-table"},{default:o(()=>[l(m,{label:"项目",prop:"eventName","min-width":"120"}),l(m,{label:"单次","min-width":"120"},{default:o(s=>[s.row.single&&!isNaN(s.row.single.time)?(n(),d("div",Oe,[D(i(k(s.row.single.time))+" ",1),s.row.singleRank?(n(),R(z,{key:0,size:"small",type:"primary"},{default:o(()=>[D(" #"+i(s.row.singleRank),1)]),_:2},1024)):_("",!0)])):(n(),d("span",Fe,"-"))]),_:1}),l(m,{label:"平均","min-width":"120"},{default:o(s=>[s.row.average&&!isNaN(s.row.average.time)?(n(),d("div",Pe,[D(i(k(s.row.average.time))+" ",1),s.row.averageRank?(n(),R(z,{key:0,size:"small",type:"success"},{default:o(()=>[D(" #"+i(s.row.averageRank),1)]),_:2},1024)):_("",!0)])):(n(),d("span",Me,"-"))]),_:1})]),_:1},8,["data"])),[[Z,S.value]])])]),_:1}),l(N,{label:"历史成绩",name:"history"},{default:o(()=>[a("div",He,[a("div",Ae,[e[8]||(e[8]=a("h2",{class:"section-title"},"历史成绩",-1)),a("div",Je,[l(h,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),placeholder:"选择项目",size:"small",class:"glass-select"},{default:o(()=>[l(u,{label:"全部项目",value:"all"}),(n(!0),d(E,null,P(oe.value,s=>(n(),R(pe,{key:s.label,label:s.label},{default:o(()=>[(n(!0),d(E,null,P(s.events,v=>(n(),R(u,{key:v.value,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),l(h,{modelValue:B.value,"onUpdate:modelValue":e[2]||(e[2]=s=>B.value=s),placeholder:"排序方式",size:"small",class:"glass-select"},{default:o(()=>[l(u,{label:"最新优先",value:"latest"}),l(u,{label:"最快优先",value:"fastest"})]),_:1},8,["modelValue"])])]),se((n(),R(C,{data:re.value,style:{width:"100%"},"empty-text":"暂无历史成绩记录",class:"glass-table"},{default:o(()=>[l(m,{label:"项目",prop:"eventName","min-width":"100"}),l(m,{label:"单次","min-width":"100"},{default:o(s=>{var v;return[a("span",null,i(k((v=s.row.single)==null?void 0:v.time)),1)]}),_:1}),l(m,{label:"平均","min-width":"100"},{default:o(s=>{var v;return[a("span",null,i(k((v=s.row.average)==null?void 0:v.time)),1)]}),_:1}),l(m,{label:"提交时间","min-width":"160"},{default:o(s=>[a("span",null,i(W(s.row.timestamp)),1)]),_:1}),l(m,{label:"操作",width:"120"},{default:o(s=>[l(ge,{type:"primary",size:"small",onClick:v=>ve(s.row)},{default:o(()=>e[9]||(e[9]=[D(" 详情 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,$.value]]),J.value>0?(n(),d("div",qe,[l(fe,{"current-page":V.value,"onUpdate:currentPage":e[3]||(e[3]=s=>V.value=s),"page-size":x.value,"onUpdate:pageSize":e[4]||(e[4]=s=>x.value=s),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",total:J.value,onSizeChange:me,onCurrentChange:_e},null,8,["current-page","page-size","total"])])):_("",!0)])]),_:1}),l(N,{label:"统计分析",name:"statistics"},{default:o(()=>[a("div",Ge,[e[16]||(e[16]=a("h2",{class:"section-title"},"选手统计",-1)),l(he,{gutter:20,class:"stats-grid"},{default:o(()=>[l(T,{xs:24,sm:12,md:8,lg:6},{default:o(()=>[a("div",Ke,[a("div",We,i(q.value),1),e[10]||(e[10]=a("div",{class:"stat-label"},"总成绩数",-1))])]),_:1}),l(T,{xs:24,sm:12,md:8,lg:6},{default:o(()=>[a("div",Qe,[a("div",Xe,i(G.value),1),e[11]||(e[11]=a("div",{class:"stat-label"},"参与项目",-1))])]),_:1}),l(T,{xs:24,sm:12,md:8,lg:6},{default:o(()=>[a("div",Ye,[a("div",Ze,i(de.value),1),e[12]||(e[12]=a("div",{class:"stat-label"},"排名前三",-1))])]),_:1}),l(T,{xs:24,sm:12,md:8,lg:6},{default:o(()=>[a("div",et,[a("div",tt,i(ue.value),1),e[13]||(e[13]=a("div",{class:"stat-label"},"第一名",-1))])]),_:1})]),_:1}),G.value>0?(n(),d("div",at,[e[14]||(e[14]=a("h3",{class:"chart-title"},"项目分布",-1)),a("div",st,[(n(!0),d(E,null,P(K.value,(s,v)=>(n(),d("div",{key:v,class:"event-bar"},[a("div",lt,i(le(L)(v)),1),a("div",nt,[a("div",{class:"bar",style:xe({width:`${s/ce.value*100}%`})},null,4),a("span",ot,i(s),1)])]))),128))])])):_("",!0),q.value>0?(n(),d("div",it,e[15]||(e[15]=[a("h3",{class:"chart-title"},"活跃度",-1),a("div",{class:"activity-heatmap"},[a("p",{class:"placeholder-text"},"活跃度图表开发中...")],-1)]))):_("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(ye,{modelValue:O.value,"onUpdate:modelValue":e[6]||(e[6]=s=>O.value=s),title:"成绩详情",width:"500px"},{default:o(()=>[r.value?(n(),d("div",rt,[a("div",dt,[e[17]||(e[17]=a("span",{class:"detail-label"},"项目:",-1)),a("span",ut,i(le(L)(r.value.event)),1)]),r.value.single&&!isNaN(r.value.single.time)?(n(),d(E,{key:0},[a("div",ct,[e[18]||(e[18]=a("span",{class:"detail-label"},"单次成绩:",-1)),a("span",vt,i(k(r.value.single.time)),1)]),r.value.singleRank?(n(),d("div",mt,[e[19]||(e[19]=a("span",{class:"detail-label"},"单次排名:",-1)),a("span",_t,"#"+i(r.value.singleRank),1)])):_("",!0)],64)):_("",!0),r.value.average&&!isNaN(r.value.average.time)?(n(),d(E,{key:1},[a("div",pt,[e[20]||(e[20]=a("span",{class:"detail-label"},"平均成绩:",-1)),a("span",gt,i(k(r.value.average.time)),1)]),r.value.averageRank?(n(),d("div",ft,[e[21]||(e[21]=a("span",{class:"detail-label"},"平均排名:",-1)),a("span",ht,"#"+i(r.value.averageRank),1)])):_("",!0)],64)):_("",!0),I(r.value.cube)?(n(),d("div",bt,[e[22]||(e[22]=a("span",{class:"detail-label"},"使用魔方:",-1)),a("span",yt,i(r.value.cube),1)])):_("",!0),I(r.value.method)?(n(),d("div",wt,[e[23]||(e[23]=a("span",{class:"detail-label"},"解法:",-1)),a("span",kt,i(r.value.method),1)])):_("",!0),I(r.value.remark)?(n(),d("div",Nt,[e[24]||(e[24]=a("span",{class:"detail-label"},"感想:",-1)),a("span",Rt,i(r.value.remark),1)])):_("",!0),I(r.value.videoLink)?(n(),d("div",Vt,[e[25]||(e[25]=a("span",{class:"detail-label"},"视频链接:",-1)),a("a",{href:r.value.videoLink,target:"_blank",class:"video-link"},i(r.value.videoLink),9,xt)])):_("",!0),a("div",zt,[e[26]||(e[26]=a("span",{class:"detail-label"},"提交时间:",-1)),a("span",Ct,i(W(r.value.timestamp,!0)),1)])])):_("",!0)]),_:1},8,["modelValue"])])}}},Tt=we(Dt,[["__scopeId","data-v-072dce07"]]);export{Tt as default};
