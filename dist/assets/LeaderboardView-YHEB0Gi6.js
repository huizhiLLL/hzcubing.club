import{_ as ee}from"./refresh-DSDc0Cm4.js";import{_ as le,a as te,u as se,r as h,o as ae,c as H,e as q,w as oe,j as v,k as ne,l as a,m as r,n,p as i,q as s,E as M,v as g,y as re,F as T,A as U,z as S,s as E,D as ie,x as C,I as F,t as _,H as de,b as ue}from"./index-PkMhL9Jo.js";import{E as Y}from"./ElementTransition-CBiVA3Qv.js";const ce={class:"leaderboard-container"},ve={class:"page-header glass-header"},_e={class:"title-with-refresh"},me={key:0,src:ee,alt:"刷新",class:"refresh-icon"},pe={key:1,class:"el-icon-loading"},fe={key:0,class:"error-alert"},ge={class:"card glass-card"},be={class:"filter-header"},ke={class:"filter-controls"},he={class:"filter-row"},ye={key:0,class:"table-responsive"},we={class:"rank-cell"},Ve={key:0,class:"medal-rank"},Se={key:1,class:"rank-number"},$e={class:"player-cell"},Ee={class:"time-cell"},Ie=["onClick"],Re={key:1,class:"no-event-selected"},xe={key:2,class:"no-event-selected"},Ce={key:0,class:"record-details glass-form"},De={class:"detail-item"},Ne={class:"value"},Le={class:"detail-item"},Be={class:"value"},Me={class:"detail-item"},Te={class:"value"},Ue={key:0,class:"detail-item"},Fe={class:"value"},ze={key:1,class:"detail-item"},We={class:"value"},je={key:2,class:"detail-item"},Ae={class:"value"},He={key:3,class:"detail-item"},qe=["href"],Ye={key:4,class:"detail-item"},Ge={class:"value"},Je={__name:"LeaderboardView",setup(Ke){const y=te();se();const w=h("official"),m=h("333"),I=h("single"),f=h(!1),b=h(""),D=h(!1),d=h(null),G=async()=>{f.value=!0,b.value="";try{await y.fetchRecords(),M.success("数据刷新成功")}catch(l){console.error("刷新排行榜失败:",l),b.value=l.message||"获取数据失败，请稍后再试"}finally{f.value=!1}};ae(async()=>{f.value=!0,b.value="";try{await y.fetchRecords()}catch(l){console.error("获取排行榜数据失败:",l),b.value=l.message||"获取数据失败，请稍后再试"}finally{f.value=!1}});const J=H(()=>w.value==="all"?[q.all]:w.value?[q[w.value]]:[]);oe(w,l=>{m.value=l?`${l}_all`:""});const K=H(()=>{if(!m.value||m.value.endsWith("_all"))return[];const l=y.getRecordsByEvent(m.value),e=new Map;return l.forEach(o=>{const u=o.userId;if(!u)return;const p=I.value==="single"?o.singleSeconds:o.averageSeconds;if(p==null)return;const V=o.nickname||y.getNicknameForUser(u)||"未知用户";if(!e.has(u))e.set(u,{userId:u,nickname:V,time:p,recordId:o._id,timestamp:o.timestamp});else{const k=e.get(u);p<k.time&&e.set(u,{userId:u,nickname:V,time:p,recordId:o._id,timestamp:o.timestamp})}}),Array.from(e.values()).sort((o,u)=>o.time-u.time).map((o,u)=>({...o,rank:u+1}))}),N=l=>y.formatTime(l),z=(l,e=!1)=>{if(!l)return"-";let c=l;typeof l=="object"&&l.$date&&(c=l.$date);const o=new Date(c);if(isNaN(o))return"-";const u=o.getFullYear(),p=String(o.getMonth()+1).padStart(2,"0"),V=String(o.getDate()).padStart(2,"0");let k=`${u}.${p}.${V}`;if(e){const B=String(o.getHours()).padStart(2,"0"),$=String(o.getMinutes()).padStart(2,"0");k+=` ${B}:${$}`}return k},W=l=>{var e,c;return l.cube||((e=l.single)==null?void 0:e.cube)||((c=l.average)==null?void 0:c.cube)||""},j=l=>{var e,c;return l.method||((e=l.single)==null?void 0:e.method)||((c=l.average)==null?void 0:c.method)||""},L=l=>l!=null&&l!=="null"&&l!=="",O=async l=>{try{const e=y.records.find(c=>c._id===l);e?(d.value=e,D.value=!0):M.error("记录不存在")}catch(e){console.error("获取记录详情失败:",e),M.error("获取记录详情失败")}};return(l,e)=>{const c=v("el-button"),o=v("el-alert"),u=v("el-option"),p=v("el-select"),V=v("el-option-group"),k=v("el-radio-button"),B=v("el-radio-group"),$=v("el-icon"),R=v("el-table-column"),P=v("router-link"),Q=v("el-table"),A=v("el-empty"),X=v("el-dialog"),Z=ne("loading");return a(),r("div",ce,[n(Y,{name:"fade",duration:600,appear:""},{default:i(()=>[s("div",ve,[s("div",_e,[e[5]||(e[5]=s("h1",{class:"page-title"},"排行榜",-1)),n(c,{circle:"",plain:"",size:"small",type:"info",onClick:G,loading:f.value,class:"refresh-icon-button"},{default:i(()=>[f.value?(a(),r("i",pe)):(a(),r("img",me))]),_:1},8,["loading"])])])]),_:1}),b.value?(a(),r("div",fe,[n(o,{title:"获取数据失败",type:"error",description:b.value,"show-icon":"",closable:"",onClose:e[0]||(e[0]=t=>b.value="")},null,8,["description"])])):g("",!0),n(Y,{name:"slide-up",duration:600,delay:200,appear:""},{default:i(()=>[re((a(),r("div",ge,[s("div",be,[e[8]||(e[8]=s("h2",{class:"section-title"},"项目排行榜",-1)),s("div",ke,[s("div",he,[n(p,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=t=>w.value=t),placeholder:"选择项目类型",class:"category-select glass-select"},{default:i(()=>[(a(!0),r(T,null,U(E(ie),t=>(a(),S(u,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(p,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=t=>m.value=t),placeholder:"选择具体项目",class:"event-select glass-select",loading:f.value},{default:i(()=>[(a(!0),r(T,null,U(J.value,t=>(a(),S(V,{key:t.label,label:t.label},{default:i(()=>[(a(!0),r(T,null,U(t.options,x=>(a(),S(u,{key:x.value,label:x.label,value:x.value},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","loading"]),n(B,{modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=t=>I.value=t),class:"rank-type-select"},{default:i(()=>[n(k,{label:"single"},{default:i(()=>e[6]||(e[6]=[C("单次")])),_:1}),n(k,{label:"average"},{default:i(()=>e[7]||(e[7]=[C("平均")])),_:1})]),_:1},8,["modelValue"])])])]),m.value&&!m.value.endsWith("_all")?(a(),r("div",ye,[n(Q,{data:K.value,style:{width:"100%"},stripe:!0,class:"leaderboard-table glass-table","empty-text":"暂无排行榜数据"},{default:i(()=>[n(R,{prop:"rank",label:"排名",width:"80",align:"center"},{default:i(t=>[s("div",we,[t.row.rank<=3?(a(),r("span",Ve,[t.row.rank===1?(a(),S($,{key:0,class:"gold-medal"},{default:i(()=>[n(E(F),{icon:"mdi:trophy"})]),_:1})):t.row.rank===2?(a(),S($,{key:1,class:"silver-medal"},{default:i(()=>[n(E(F),{icon:"mdi:trophy"})]),_:1})):t.row.rank===3?(a(),S($,{key:2,class:"bronze-medal"},{default:i(()=>[n(E(F),{icon:"mdi:trophy"})]),_:1})):g("",!0)])):(a(),r("span",Se,_(t.row.rank),1))])]),_:1}),n(R,{label:"选手","min-width":"120"},{default:i(t=>[s("div",$e,[n(P,{to:`/user/${t.row.userId}`,class:"player-name"},{default:i(()=>[C(_(t.row.nickname),1)]),_:2},1032,["to"])])]),_:1}),n(R,{label:I.value==="single"?"单次成绩":"平均成绩","min-width":"120",align:"center"},{default:i(t=>[s("div",Ee,[s("span",{class:de(["time-value",{clickable:t.row.recordId}]),onClick:x=>O(t.row.recordId)},_(N(t.row.time)),11,Ie)])]),_:1},8,["label"]),n(R,{label:"提交时间","min-width":"120","class-name":"hide-on-mobile"},{default:i(t=>[C(_(z(t.row.timestamp)),1)]),_:1})]),_:1},8,["data"])])):m.value&&m.value.endsWith("_all")?(a(),r("div",Re,[n(A,{description:"请选择具体项目查看排行榜"})])):(a(),r("div",xe,[n(A,{description:"请选择项目查看排行榜"})]))])),[[Z,f.value]])]),_:1}),n(X,{modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=t=>D.value=t),title:"记录详情",width:"500px",class:"glass-dialog"},{default:i(()=>[d.value?(a(),r("div",Ce,[s("div",De,[e[9]||(e[9]=s("span",{class:"label"},"项目:",-1)),s("span",Ne,_(E(ue)(d.value.event)),1)]),s("div",Le,[e[10]||(e[10]=s("span",{class:"label"},"单次成绩:",-1)),s("span",Be,_(d.value.singleSeconds?N(d.value.singleSeconds):"-"),1)]),s("div",Me,[e[11]||(e[11]=s("span",{class:"label"},"平均成绩:",-1)),s("span",Te,_(d.value.averageSeconds?N(d.value.averageSeconds):"-"),1)]),L(W(d.value))?(a(),r("div",Ue,[e[12]||(e[12]=s("span",{class:"label"},"使用魔方:",-1)),s("span",Fe,_(W(d.value)),1)])):g("",!0),L(j(d.value))?(a(),r("div",ze,[e[13]||(e[13]=s("span",{class:"label"},"使用方法:",-1)),s("span",We,_(j(d.value)),1)])):g("",!0),L(d.value.remark)?(a(),r("div",je,[e[14]||(e[14]=s("span",{class:"label"},"备注:",-1)),s("span",Ae,_(d.value.remark),1)])):g("",!0),d.value.videoLink?(a(),r("div",He,[e[15]||(e[15]=s("span",{class:"label"},"视频链接:",-1)),s("a",{href:d.value.videoLink,target:"_blank",class:"video-link"},_(d.value.videoLink),9,qe)])):g("",!0),d.value.timestamp?(a(),r("div",Ye,[e[16]||(e[16]=s("span",{class:"label"},"提交时间:",-1)),s("span",Ge,_(z(d.value.timestamp,!0)),1)])):g("",!0)])):g("",!0)]),_:1},8,["modelValue"])])}}},Xe=le(Je,[["__scopeId","data-v-1c578f20"]]);export{Xe as default};
