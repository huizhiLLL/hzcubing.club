import{_ as ee}from"./refresh-DSDc0Cm4.js";import{_ as ae,l as le,u as se,r as y,o as te,m as K,w as ne,b as v,p as oe,c as t,d as i,e as o,f as d,g as l,E as W,i as p,q as ie,F as $,v as j,s as E,h as x,j as q,I as A,t as _}from"./index-Dk6zR9k4.js";import{E as O}from"./ElementTransition-B1nF07HC.js";import{e as P,c as re,g as de}from"./events-CUXDbKN2.js";const ue={class:"leaderboard-container"},ce={class:"page-header glass-header"},ve={class:"title-with-refresh"},_e={key:0,src:ee,alt:"刷新",class:"refresh-icon"},me={key:1,class:"el-icon-loading"},pe={key:0,class:"error-alert"},fe={class:"card glass-card"},ge={class:"filter-header"},be={class:"filter-controls"},ke={key:0,class:"table-responsive"},he={class:"rank-cell"},ye={key:0,class:"medal-rank"},we={key:1,class:"rank-number"},Ve={class:"player-cell"},Ee={class:"player-name"},Re={class:"time-cell"},Ce={class:"time-value"},Ie=["onClick"],xe={key:1,class:"no-event-selected"},De={key:2,class:"no-event-selected"},Le={key:0,class:"record-details glass-form"},Ne={class:"detail-item"},Be={class:"value"},Te={class:"detail-item"},Se={class:"value"},Ue={class:"detail-item"},ze={class:"value"},Me={class:"detail-item"},Fe={class:"value"},We={key:0,class:"detail-item"},$e={class:"value"},je={key:1,class:"detail-item"},qe={class:"value"},Ae={key:2,class:"detail-item"},Ge={class:"value"},He={key:3,class:"detail-item"},Je=["href"],Ke={key:4,class:"detail-item"},Oe={class:"value"},Pe={__name:"LeaderboardView",setup(Qe){const R=le();se();const w=y("official"),m=y("official_all"),D=y("single"),f=y(!1),b=y(""),z=y(!1),r=y(null),Q=async()=>{f.value=!0,b.value="";try{await R.fetchRecords(),W.success("数据刷新成功")}catch(s){console.error("刷新排行榜失败:",s),b.value=s.message||"获取数据失败，请稍后再试"}finally{f.value=!1}};te(async()=>{f.value=!0,b.value="";try{await R.fetchRecords()}catch(s){console.error("获取排行榜数据失败:",s),b.value=s.message||"获取数据失败，请稍后再试"}finally{f.value=!1}});const X=K(()=>w.value==="all"?[P.all]:w.value?[P[w.value]]:[]);ne(w,s=>{m.value=s?`${s}_all`:""});const Y=K(()=>{if(!m.value||m.value.endsWith("_all"))return[];const s=R.getRecordsByEvent(m.value),e=new Map;return s.forEach(n=>{var L,C,N,V,k,B,T,I,S,U;const u=n.userId;if(!u)return;const g=D.value==="single"?(L=n.single)==null?void 0:L.time:(C=n.average)==null?void 0:C.time;if(g!=null)if(!e.has(u))e.set(u,{userId:u,nickname:((N=n.single)==null?void 0:N.nickname)||((V=n.average)==null?void 0:V.nickname)||"未知用户",avatar:((k=n.single)==null?void 0:k.avatar)||((B=n.average)==null?void 0:B.avatar),time:g,recordId:n._id,timestamp:n.timestamp});else{const a=e.get(u);g<a.time&&e.set(u,{userId:u,nickname:((T=n.single)==null?void 0:T.nickname)||((I=n.average)==null?void 0:I.nickname)||"未知用户",avatar:((S=n.single)==null?void 0:S.avatar)||((U=n.average)==null?void 0:U.avatar),time:g,recordId:n._id,timestamp:n.timestamp})}}),Array.from(e.values()).sort((n,u)=>n.time-u.time).map((n,u)=>({...n,rank:u+1}))}),M=s=>R.formatTime(s),G=(s,e=!1)=>{if(!s)return"-";const c=new Date(s);if(isNaN(c))return"-";const n={year:"numeric",month:"2-digit",day:"2-digit"};return e&&(n.hour="2-digit",n.minute="2-digit"),c.toLocaleDateString("zh-CN",n)},H=s=>{var e,c;return s.cube||((e=s.single)==null?void 0:e.cube)||((c=s.average)==null?void 0:c.cube)||""},J=s=>{var e,c;return s.method||((e=s.single)==null?void 0:e.method)||((c=s.average)==null?void 0:c.method)||""},F=s=>s!=null&&s!=="null"&&s!=="",Z=async s=>{try{const e=R.records.find(c=>c._id===s);e?(r.value=e,z.value=!0):W.error("记录不存在")}catch(e){console.error("获取记录详情失败:",e),W.error("获取记录详情失败")}};return(s,e)=>{const c=v("el-button"),n=v("el-alert"),u=v("el-option"),g=v("el-select"),L=v("el-option-group"),C=v("el-radio-button"),N=v("el-radio-group"),V=v("el-icon"),k=v("el-table-column"),B=v("el-avatar"),T=v("el-table"),I=v("el-empty"),S=v("el-dialog"),U=oe("loading");return t(),i("div",ue,[o(O,{name:"fade",duration:600,appear:""},{default:d(()=>[l("div",ce,[l("div",ve,[e[5]||(e[5]=l("h1",{class:"page-title"},"排行榜",-1)),o(c,{circle:"",plain:"",size:"small",type:"info",onClick:Q,loading:f.value,class:"refresh-icon-button"},{default:d(()=>[f.value?(t(),i("i",me)):(t(),i("img",_e))]),_:1},8,["loading"])])])]),_:1}),b.value?(t(),i("div",pe,[o(n,{title:"获取数据失败",type:"error",description:b.value,"show-icon":"",closable:"",onClose:e[0]||(e[0]=a=>b.value="")},null,8,["description"])])):p("",!0),o(O,{name:"slide-up",duration:600,delay:200,appear:""},{default:d(()=>[ie((t(),i("div",fe,[l("div",ge,[e[8]||(e[8]=l("h2",{class:"section-title"},"项目排行榜",-1)),l("div",be,[o(g,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=a=>w.value=a),placeholder:"选择项目类型",class:"category-select glass-select"},{default:d(()=>[(t(!0),i($,null,j(x(re),a=>(t(),E(u,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(g,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a),placeholder:"选择具体项目",class:"event-select glass-select",loading:f.value},{default:d(()=>[(t(!0),i($,null,j(X.value,a=>(t(),E(L,{key:a.label,label:a.label},{default:d(()=>[(t(!0),i($,null,j(a.options,h=>(t(),E(u,{key:h.value,label:h.label,value:h.value},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","loading"]),o(N,{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=a=>D.value=a),class:"rank-type-select"},{default:d(()=>[o(C,{label:"single"},{default:d(()=>e[6]||(e[6]=[q("单次")])),_:1}),o(C,{label:"average"},{default:d(()=>e[7]||(e[7]=[q("平均")])),_:1})]),_:1},8,["modelValue"])])]),m.value&&!m.value.endsWith("_all")?(t(),i("div",ke,[o(T,{data:Y.value,style:{width:"100%"},stripe:!0,class:"leaderboard-table glass-table","empty-text":"暂无排行榜数据"},{default:d(()=>[o(k,{prop:"rank",label:"排名",width:"80",align:"center"},{default:d(a=>[l("div",he,[a.row.rank<=3?(t(),i("span",ye,[a.row.rank===1?(t(),E(V,{key:0,class:"gold-medal"},{default:d(()=>[o(x(A),{icon:"mdi:trophy"})]),_:1})):a.row.rank===2?(t(),E(V,{key:1,class:"silver-medal"},{default:d(()=>[o(x(A),{icon:"mdi:trophy"})]),_:1})):a.row.rank===3?(t(),E(V,{key:2,class:"bronze-medal"},{default:d(()=>[o(x(A),{icon:"mdi:trophy"})]),_:1})):p("",!0)])):(t(),i("span",we,_(a.row.rank),1))])]),_:1}),o(k,{label:"选手","min-width":"120"},{default:d(a=>[l("div",Ve,[o(B,{src:a.row.avatar||"/default-avatar.svg",size:32,class:"player-avatar"},null,8,["src"]),l("span",Ee,_(a.row.nickname),1)])]),_:1}),o(k,{label:D.value==="single"?"单次成绩":"平均成绩","min-width":"120",align:"center"},{default:d(a=>[l("div",Re,[l("span",Ce,_(M(a.row.time)),1),a.row.recordId?(t(),i("span",{key:0,class:"record-link",onClick:h=>Z(a.row.recordId)}," 查看记录 ",8,Ie)):p("",!0)])]),_:1},8,["label"]),o(k,{label:"提交时间","min-width":"120","class-name":"hide-on-mobile"},{default:d(a=>[q(_(G(a.row.timestamp)),1)]),_:1})]),_:1},8,["data"])])):m.value&&m.value.endsWith("_all")?(t(),i("div",xe,[o(I,{description:"请选择具体项目查看排行榜"})])):(t(),i("div",De,[o(I,{description:"请选择项目查看排行榜"})]))])),[[U,f.value]])]),_:1}),o(S,{modelValue:z.value,"onUpdate:modelValue":e[4]||(e[4]=a=>z.value=a),title:"记录详情",width:"500px",class:"glass-dialog"},{default:d(()=>{var a,h;return[r.value?(t(),i("div",Le,[l("div",Ne,[e[9]||(e[9]=l("span",{class:"label"},"项目:",-1)),l("span",Be,_(x(de)(r.value.event)),1)]),l("div",Te,[e[10]||(e[10]=l("span",{class:"label"},"选手:",-1)),l("span",Se,_(r.value.nickname),1)]),l("div",Ue,[e[11]||(e[11]=l("span",{class:"label"},"单次成绩:",-1)),l("span",ze,_((a=r.value.single)!=null&&a.time?M(r.value.single.time):"-"),1)]),l("div",Me,[e[12]||(e[12]=l("span",{class:"label"},"平均成绩:",-1)),l("span",Fe,_((h=r.value.average)!=null&&h.time?M(r.value.average.time):"-"),1)]),F(H(r.value))?(t(),i("div",We,[e[13]||(e[13]=l("span",{class:"label"},"使用魔方:",-1)),l("span",$e,_(H(r.value)),1)])):p("",!0),F(J(r.value))?(t(),i("div",je,[e[14]||(e[14]=l("span",{class:"label"},"使用方法:",-1)),l("span",qe,_(J(r.value)),1)])):p("",!0),F(r.value.remark)?(t(),i("div",Ae,[e[15]||(e[15]=l("span",{class:"label"},"备注:",-1)),l("span",Ge,_(r.value.remark),1)])):p("",!0),r.value.videoLink?(t(),i("div",He,[e[16]||(e[16]=l("span",{class:"label"},"视频链接:",-1)),l("a",{href:r.value.videoLink,target:"_blank",class:"video-link"},_(r.value.videoLink),9,Je)])):p("",!0),r.value.timestamp?(t(),i("div",Ke,[e[17]||(e[17]=l("span",{class:"label"},"提交时间:",-1)),l("span",Oe,_(G(r.value.timestamp,!0)),1)])):p("",!0)])):p("",!0)]}),_:1},8,["modelValue"])])}}},aa=ae(Pe,[["__scopeId","data-v-f5d0f274"]]);export{aa as default};
