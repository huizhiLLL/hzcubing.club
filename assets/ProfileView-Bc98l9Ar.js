import{_ as Le,u as Me,a as Ue,r as I,c as O,g as U,b as G,e as qe,d as He,w as Ge,f as _e,o as Ke,E as w,h as Ye,i as Qe,j as x,k as Xe,l as u,m as f,n as v,p as g,q as a,s as A,t as y,v as _,x as p,y as be,z as V,F as z,A as Ie,B as Ze}from"./index-BHRzxtpC.js";import{E as Se}from"./ElementTransition-C-ObTZXC.js";const eo={class:"profile-container"},oo={class:"card profile-header glass-card"},to={class:"user-profile"},lo={class:"user-info"},so={class:"nickname"},ao={class:"bio"},no={key:0,class:"wca-id"},ro={class:"action-buttons"},io={class:"card glass-card"},co={class:"section-header"},uo={key:0,class:"record-value"},vo={key:1},go={key:0,class:"record-value"},fo={key:1},mo={class:"card glass-card"},po={class:"section-header"},yo={class:"filter-controls"},ko=["onClick"],ho={key:0,class:"pagination-container"},_o={class:"card glass-card"},bo={class:"stats-container"},Io={key:0,class:"stats-message"},So={class:"highlight-number"},Ro={class:"highlight-number"},wo={class:"highlight-number"},Co={class:"highlight-number"},Do={key:1,class:"stats-message"},To={key:0,class:"medal-container"},No={class:"rank-list"},xo={class:"event-name"},Oo={class:"rank-badges"};const Vo={key:0,class:"glass-form"},Eo={key:1,class:"loading-text"},Ao={class:"dialog-footer"},zo={key:0,class:"record-details"},Bo={class:"detail-item"},$o={class:"detail-value"},jo={class:"detail-item"},Po={class:"detail-value"},Jo={key:0,class:"detail-item"},Fo={class:"detail-value"},Wo={class:"detail-item"},Lo={class:"detail-value"},Mo={key:0,class:"detail-item"},Uo={class:"detail-value"},qo={key:2,class:"detail-item"},Ho={class:"detail-value"},Go={key:3,class:"detail-item"},Ko={class:"detail-value"},Yo={key:4,class:"detail-item"},Qo={class:"detail-value"},Xo={key:5,class:"detail-item"},Zo=["href"],et={class:"detail-item"},ot={class:"detail-value"},tt={__name:"ProfileView",setup(lt){const K=Ye(),E=Me(),P=Ue(),{user:s}=E,Re=I(!1),B=I({}),$=I([]),Y=I(!1),re=I("personal-bests"),Q=I("all"),J=I("all"),oe=I("latest"),q=I(1),H=I(10),te=I(!1),k=I(null),ie=O(()=>{const o=[];for(const[e,l]of Object.entries(B.value||{}))l&&(!isNaN(l.singleSeconds)||!isNaN(l.averageSeconds))&&o.push({event:e,eventName:G(e),eventType:U(e),...l});return o.sort((e,l)=>{var D;const t={official:1,fun:2,meme:3},c=t[e.eventType]-t[l.eventType];if(c!==0)return c;const i=((D=qe[e.eventType])==null?void 0:D.options)||[],n=i.findIndex(h=>h.value===e.event),S=i.findIndex(h=>h.value===l.event);return(n===-1?999:n)-(S===-1?999:S)}),o}),we=O(()=>Q.value==="all"?ie.value:ie.value.filter(o=>o.eventType===Q.value)),Ce=O(()=>{let o=$.value.map(t=>({...t,eventName:G(t.event)}));J.value!=="all"&&(o=o.filter(t=>t.event===J.value)),oe.value==="fastest"?o.sort((t,c)=>{const i=t.singleSeconds??1/0,n=c.singleSeconds??1/0;return i-n}):o.sort((t,c)=>{const i=new Date(t.timestamp);return new Date(c.timestamp)-i});const e=(q.value-1)*H.value,l=e+H.value;return o.slice(e,l)}),ce=O(()=>J.value==="all"?$.value.length:$.value.filter(o=>o.event===J.value).length),De=O(()=>{const o=new Set;return $.value.forEach(e=>{e.event&&o.add(e.event)}),Array.from(o).sort()}),de=O(()=>$.value.length),Te=O(()=>{const o=new Set;return $.value.forEach(e=>{o.add(e.event)}),o.size}),N=I(0),C=I(0),Ne=O(()=>{const o={};return $.value.forEach(e=>{o[e.event]||(o[e.event]=0),o[e.event]++}),o}),st=O(()=>{const o=Object.values(Ne.value);return o.length>0?Math.max(...o):0}),F=o=>{if(!o||isNaN(o))return"-";if(o<60)return o.toFixed(2);const e=Math.floor(o/60),l=(o%60).toFixed(2).padStart(5,"0");return`${e}:${l}`},ue=(o,e=!1)=>{if(!o)return"-";try{const l=new Date(o.$date||o),t=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),i=String(l.getDate()).padStart(2,"0");let n=`${t}.${c}.${i}`;if(e){const S=String(l.getHours()).padStart(2,"0"),R=String(l.getMinutes()).padStart(2,"0");n+=` ${S}:${R}`}return n}catch{return"日期格式错误"}},xe=o=>{var l,t,c,i;console.log("Record details:",JSON.stringify(o,null,2));const e={...o,cube:o.cube||((l=o.single)==null?void 0:l.cube)||((t=o.average)==null?void 0:t.cube),method:o.method||((c=o.single)==null?void 0:c.method)||((i=o.average)==null?void 0:i.method),remark:o.remark,videoLink:o.videoLink};k.value=e,te.value=!0},Oe=o=>{H.value=o,q.value=1},Ve=o=>{q.value=o},ve=async o=>{var e,l;try{let t=o||((e=s.value)==null?void 0:e._id)||((l=s.value)==null?void 0:l.id);if(console.log("获取个人最佳记录 - 原始用户ID:",t),!o&&typeof s.value=="object"&&s.value!==null&&(s.value._id?t=s.value._id:s.value.id&&(t=s.value.id)),console.log("获取个人最佳记录 - 最终使用的用户ID:",t),console.log("获取个人最佳记录 - 用户对象:",s.value?JSON.stringify(s.value):"未登录"),!t){console.error("无法获取用户ID，用户可能未登录或数据未加载完成");return}console.log("开始请求个人最佳记录API, userId:",t);const c=await _e.getUsersBestRecord(t);if(console.log("个人最佳记录API响应数据:",JSON.stringify(c)),me(c,"个人最佳记录"),c.code===200&&c.data){const i={};if((c.data||[]).forEach(n=>{i[n.event]={singleSeconds:typeof n.bestSingleSeconds=="number"?n.bestSingleSeconds:null,averageSeconds:typeof n.bestAverageSeconds=="number"?n.bestAverageSeconds:null}}),B.value=i,console.log("个人最佳记录数据已加载, 条目数:",Object.keys(i).length),Object.keys(i).length>0){const n=Object.keys(i)[0];console.log("第一个项目的数据结构:",JSON.stringify(i[n]))}}else console.error("获取用户成绩失败:",c.message,"响应码:",c.code)}catch(t){console.error("获取用户成绩出错:",t)}},ge=async o=>{var e,l;Y.value=!0;try{let t=o||((e=s.value)==null?void 0:e._id)||((l=s.value)==null?void 0:l.id);if(console.log("获取历史记录 - 原始用户ID:",t),!o&&typeof s.value=="object"&&s.value!==null&&(s.value._id?t=s.value._id:s.value.id&&(t=s.value.id)),console.log("获取历史记录 - 最终使用的用户ID:",t),console.log("获取历史记录 - 用户对象:",s.value?JSON.stringify(s.value):"未登录"),!t){console.error("无法获取用户ID，用户可能未登录或数据未加载完成"),Y.value=!1;return}console.log("开始请求历史记录API, userId:",t);const c=await _e.getUsersHistoryRecord(t);if(console.log("历史记录API响应数据:",JSON.stringify(c)),me(c,"历史记录"),c.code===200&&c.data){const i=(c.data||[]).map(n=>({...n,singleSeconds:typeof n.singleSeconds=="number"?n.singleSeconds:n.single&&typeof n.single.time=="number"?n.single.time:null,averageSeconds:typeof n.averageSeconds=="number"?n.averageSeconds:n.average&&typeof n.average.time=="number"?n.average.time:null}));$.value=i,console.log("历史记录数据已加载, 条目数:",i.length),i.length>0&&console.log("第一条历史记录的数据结构:",JSON.stringify(i[0])),await fe(t)}else console.error("获取用户历史成绩失败:",c.message,"响应码:",c.code)}catch(t){console.error("获取用户历史成绩出错:",t)}finally{Y.value=!1}},fe=async o=>{try{console.log("检查排行榜数据是否已加载, 当前记录数:",P.records.length),P.records.length===0&&(console.log("排行榜数据未加载，开始获取..."),await P.fetchRecords(),console.log("排行榜数据加载完成, 记录数:",P.records.length)),console.log("开始计算排名..."),Ee(o),console.log("手动计算统计数据..."),N.value=le(),C.value=se(),console.log("排名计算完成，统计结果:",{topThreeCount:N.value,firstPlaceCount:C.value,topThreeRecordsCount:Object.keys(W.value).length,sortedTopThreeRecordsCount:j.value.length})}catch(e){console.error("加载排行榜数据出错:",e),N.value=le(),C.value=se()}},me=(o,e)=>{try{if(console.log(`调试${e}API返回数据:`),!o){console.log("数据为空");return}console.log("数据类型:",typeof o),typeof o=="object"&&(console.log("是否为数组:",Array.isArray(o)),console.log("顶层键:",Object.keys(o)),Array.isArray(o)?(console.log("数组长度:",o.length),o.length>0&&console.log("第一条数据示例:",JSON.stringify(o[0]).substring(0,200)+"...")):("code"in o&&console.log("code:",o.code),"message"in o&&console.log("message:",o.message),"data"in o&&(console.log("data字段类型:",typeof o.data),Array.isArray(o.data)?(console.log("data数组长度:",o.data.length),o.data.length>0&&console.log("第一条数据示例:",JSON.stringify(o.data[0]).substring(0,200)+"...")):typeof o.data=="object"&&o.data&&console.log("data对象键:",Object.keys(o.data)))))}catch(l){console.error("调试数据时出错:",l)}},Ee=o=>{var e,l;try{const t=o||((e=s.value)==null?void 0:e._id)||((l=s.value)==null?void 0:l.id);if(!t){console.error("计算排名时无法获取用户ID");return}console.log("开始计算排名, 用户ID:",t),console.log("当前recordsStore中记录数:",P.records.length),N.value=0,C.value=0;for(const[i,n]of Object.entries(B.value)){if(U(i)==="meme"){console.log(`项目 ${i} 是整活项目，跳过排名计算`);continue}const R=P.getRecordsByEvent(i);if(console.log(`项目 ${i} 的记录数:`,R.length),!isNaN(n.singleSeconds)){const b=new Map;R.forEach(d=>{!d.userId||d.singleSeconds==null||(!b.has(d.userId)||d.singleSeconds<b.get(d.userId).time)&&b.set(d.userId,{userId:d.userId,time:d.singleSeconds})});const D=Array.from(b.values()).sort((d,T)=>d.time-T.time);console.log(`项目 ${i} 单次排序后的记录:`,D.map(d=>({userId:d.userId,time:d.time})));const h=D.findIndex(d=>d.userId===t)+1;h>0?(n.singleRank=h,console.log(`项目 ${i} 单次排名:`,h),h===1&&(C.value++,console.log("第一名计数增加，当前:",C.value)),h<=3&&(N.value++,console.log("前三名计数增加，当前:",N.value))):(console.log(`项目 ${i} 单次排名未找到，用户ID:`,t),console.log("排序后的记录中的用户ID:",D.map(d=>d.userId)))}if(!isNaN(n.averageSeconds)){const b=new Map;R.forEach(d=>{!d.userId||d.averageSeconds==null||(!b.has(d.userId)||d.averageSeconds<b.get(d.userId).time)&&b.set(d.userId,{userId:d.userId,time:d.averageSeconds})});const D=Array.from(b.values()).sort((d,T)=>d.time-T.time);console.log(`项目 ${i} 平均排序后的记录:`,D.map(d=>({userId:d.userId,time:d.time})));const h=D.findIndex(d=>d.userId===t)+1;h>0?(n.averageRank=h,console.log(`项目 ${i} 平均排名:`,h),h===1&&(C.value++,console.log("第一名计数增加，当前:",C.value)),h<=3&&(N.value++,console.log("前三名计数增加，当前:",N.value))):(console.log(`项目 ${i} 平均排名未找到，用户ID:`,t),console.log("排序后的记录中的用户ID:",D.map(d=>d.userId)))}}console.log("排名计算完成, 前三名数量:",N.value,"第一名数量:",C.value);const c=Object.keys(W.value).length;console.log("topThreeRecords条目数:",c),c>0&&console.log("topThreeRecords内容示例:",JSON.stringify(Object.entries(W.value)[0])),console.log("sortedTopThreeRecords条目数:",j.value.length),j.value.length>0&&console.log("sortedTopThreeRecords内容示例:",JSON.stringify(j.value[0]))}catch(t){console.error("计算排名信息出错:",t),N.value=le(),C.value=se()}},le=()=>{console.log("计算排名前三的数量");let o=0,e=0;for(const[l,t]of Object.entries(B.value)){if(U(l)==="meme")continue;e++;const i=t.singleRank&&t.singleRank<=3,n=t.averageRank&&t.averageRank<=3;(i||n)&&(o++,console.log(`项目 ${l} 有前三名排名:`,i?`单次 #${t.singleRank}`:"",n?`平均 #${t.averageRank}`:""))}return console.log(`共检查了 ${e} 个项目，有 ${o} 个项目排名前三`),o},se=()=>{console.log("计算第一名的数量");let o=0,e=0;for(const[l,t]of Object.entries(B.value)){if(U(l)==="meme")continue;e++;const i=t.singleRank===1,n=t.averageRank===1;(i||n)&&(o++,console.log(`项目 ${l} 有第一名排名:`,i?"单次 #1":"",n?"平均 #1":""))}return console.log(`共检查了 ${e} 个项目，有 ${o} 个项目排名第一`),o},X=o=>o!=null&&o!=="null"&&o!=="",W=O(()=>{console.log("计算topThreeRecords，personalBests条目数:",Object.keys(B.value).length);const o={};for(const[e,l]of Object.entries(B.value)){if(U(e)==="meme")continue;const c=l.singleRank&&l.singleRank<=3,i=l.averageRank&&l.averageRank<=3;(c||i)&&(o[e]={...l,eventCode:e})}return console.log("topThreeRecords结果条目数:",Object.keys(o).length),o}),j=O(()=>{console.log("计算sortedTopThreeRecords，topThreeRecords条目数:",Object.keys(W.value).length);const o=[];for(const[l,t]of Object.entries(W.value)){const c={...t,eventCode:l||t.eventCode},i=t.singleRank&&t.singleRank<=3?t.singleRank:999,n=t.averageRank&&t.averageRank<=3?t.averageRank:999;o.push({...c,singleRank:t.singleRank,averageRank:t.averageRank,rankWeight:Math.min(i,n)})}const e=o.sort((l,t)=>l.rankWeight-t.rankWeight);return console.log("sortedTopThreeRecords结果条目数:",e.length),e.length>0&&console.log("排序后第一条记录:",JSON.stringify({eventCode:e[0].eventCode,singleRank:e[0].singleRank,averageRank:e[0].averageRank,rankWeight:e[0].rankWeight})),e});O(()=>{const o={};for(const[e,l]of Object.entries(B.value))U(e)!=="meme"&&(l.singleRank===1||l.averageRank===1)&&(o[e]=l);return o});const L=I(!1),ae=I(),m=He({nickname:"",bio:"",wcaId:""}),Ae={nickname:[{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],bio:[{max:200,message:"签名不能超过200个字符",trigger:"blur"}],wcaId:[{max:20,message:"WCA ID 最多20字符",trigger:"blur"}]},ze=async()=>{console.log("刷新用户信息"),await E.initUser(),s.value&&Ze(()=>{try{const o=document.querySelector(".nickname"),e=document.querySelector(".bio");o&&(o.textContent=s.value.nickname||""),e&&(e.textContent=s.value.bio||"这个人很懒，什么都没写~");let l=document.querySelector(".wca-id");s.value.wcaId?l?(l.textContent=`WCA ID: ${s.value.wcaId}`,l.style.display="block"):(l=document.createElement("p"),l.className="wca-id",l.textContent=`WCA ID: ${s.value.wcaId}`,e&&e.parentNode&&e.parentNode.insertBefore(l,e.nextSibling)):l&&(l.style.display="none"),console.log("页面更新完成")}catch(o){console.error("更新页面时出错:",o)}})},Be=()=>{console.log("取消编辑"),L.value=!1},$e=async()=>{ae.value&&await ae.value.validate(async o=>{if(o){const e=w({message:"正在更新资料...",type:"info",duration:0});try{if(!E.user){e.close(),w.error("请先登录"),K.push("/login");return}const l=localStorage.getItem("token");if(!l){e.close(),w.error("登录状态已过期，请重新登录"),K.push("/login");return}console.log("提交数据:",JSON.stringify(m)),console.log("当前用户状态:",JSON.stringify(E.user)),console.log("当前token:",l);const t=await E.updateProfile(m);console.log("更新结果:",t),e.close(),L.value=!1,w.success("个人资料更新成功"),await ze()}catch(l){e.close(),console.error("资料更新失败:",l),l.message&&l.message.includes("登录")?(w.error("登录状态已过期，请重新登录"),localStorage.removeItem("token"),E.clearToken(),K.push("/login")):w.error(l.message||"更新失败，请重试")}}})};Ge(()=>E.user,(o,e)=>{if(console.log("用户数据发生变化:",o?`ID: ${o._id||o.id}`:"无用户数据",e?`旧ID: ${e._id||e.id}`:"之前无用户数据"),o&&L.value&&(m.nickname=o.nickname||"",m.bio=o.bio||"",m.wcaId=o.wcaId||"",console.log("用户数据更新，重新设置表单数据:",m)),o&&(!e||(o._id||o.id)!==(e._id||e.id))){console.log("用户信息已更新，重新获取成绩记录"),!o._id&&o.id&&(o._id=o.id,console.log("添加_id字段:",o._id)),!o.id&&o._id&&(o.id=o._id,console.log("添加id字段:",o.id));const l=o._id||o.id;l?(console.log("监听到用户ID变化，开始获取成绩记录:",l),ve(l),ge(l)):console.error("监听到用户变化，但没有有效的ID字段")}},{deep:!0});const je=async()=>{console.log("开始初始化数据...");try{let o=null;if(s.value&&(console.log("用户对象存在，尝试获取ID"),console.log("用户对象结构:",JSON.stringify(s.value)),s.value._id?(o=s.value._id,console.log("从user.value._id获取ID:",o)):s.value.id?(o=s.value.id,console.log("从user.value.id获取ID:",o)):typeof s.value=="string"&&(o=s.value,console.log("用户对象本身是ID字符串:",o))),!o){console.log("用户ID未找到，尝试等待用户信息加载...");const e=localStorage.getItem("token"),l=localStorage.getItem("userInfo");if(l)try{console.log("从localStorage获取缓存的用户信息");const t=JSON.parse(l);t&&(t._id||t.id)&&(o=t._id||t.id,console.log("从缓存用户信息获取ID:",o))}catch(t){console.error("解析缓存用户信息失败:",t)}if(!o&&e){console.log("发现token，尝试初始化用户信息");try{await E.initUser(),s.value&&(s.value._id?o=s.value._id:s.value.id&&(o=s.value.id),console.log("用户初始化后的ID:",o))}catch(t){console.error("初始化用户失败:",t)}}}if(o||(console.log("尝试使用控制台显示的ID"),o="68359567c0efb590c7e1092f",console.log("使用固定ID:",o)),!o){console.error("无法获取用户ID，用户可能未登录"),w.warning("请先登录后查看个人资料"),K.push("/");return}console.log("使用当前用户ID获取成绩记录:",o),await ve(o),await ge(o),await fe(o),console.log("初始化完成，检查排名结果:",{personalBestsCount:Object.keys(B.value).length,historyRecordsCount:$.value.length,topThreeCount:N.value,firstPlaceCount:C.value,topThreeRecordsCount:Object.keys(W.value).length,sortedTopThreeRecordsCount:j.value.length})}catch(o){console.error("初始化数据失败:",o)}};Ke(async()=>{var l,t;console.log("ProfileView 组件挂载开始");const o=((l=s.value)==null?void 0:l._id)||((t=s.value)==null?void 0:t.id);console.log("组件挂载时的用户ID:",o||"未登录"),await je(),localStorage.getItem("profile_message")==="edit_success"&&w.success("资料更新成功"),localStorage.removeItem("profile_message"),console.log("ProfileView 组件挂载完成")});const Pe=()=>{s.value&&(m.nickname=s.value.nickname||"",m.bio=s.value.bio||"",m.wcaId=s.value.wcaId||"",console.log("预填充表单数据:",m)),L.value=!0},Z=I(null),ee=I(!1),Je=()=>{Z.value.click()},Fe=async o=>{const e=o.target.files[0];if(!e){w.error("未选择文件");return}if(console.log("选择的文件:",e.name,"类型:",e.type,"大小:",(e.size/1024).toFixed(2),"KB"),!e.type.startsWith("image/")){w.error("请选择图片文件");return}if(e.size>2*1024*1024){w.error("图片大小不能超过2MB");return}ee.value=!0,w.info("正在上传头像...");try{const l=new FileReader;l.onload=async t=>{var c,i;try{const n=t.target.result;console.log("文件已转换为base64，长度:",n.length);const S=n.split(",")[1],R={userId:(c=E.user)==null?void 0:c._id,fileName:e.name,fileType:e.type,fileSize:e.size,fileData:S};console.log("发送数据:",{userId:R.userId,fileName:R.fileName,fileType:R.fileType,fileSize:R.fileSize,fileDataLength:R.fileData.length});const b=localStorage.getItem("token");console.log("有token:",!!b);const D="https://w3mavh11ex.bja.sealos.run/avater";console.log("上传到:",D),console.log("开始发送上传请求...");const h=await fetch(D,{method:"POST",headers:{"Content-Type":"application/json",...b?{Authorization:`Bearer ${b}`}:{}},body:JSON.stringify(R)});console.log("上传响应状态:",h.status,h.statusText);const d=await h.text();console.log("原始响应:",d);let T;try{T=JSON.parse(d),console.log("解析响应:",T)}catch(ne){throw console.error("响应解析失败:",ne),new Error("服务器响应格式错误")}if(T.code===200&&((i=T.data)!=null&&i.avatarUrl))s.value&&(console.log("更新头像URL:",T.data.avatarUrl),s.value.avatar=T.data.avatarUrl,localStorage.setItem("userInfo",JSON.stringify(s.value))),w.success("头像更新成功");else throw new Error(T.message||"上传失败")}catch(n){console.error("处理上传失败:",n),w.error(n.message||"上传头像失败，请重试"),ee.value=!1}},l.onerror=t=>{console.error("文件读取失败:",t),w.error("文件读取失败"),ee.value=!1},l.readAsDataURL(e)}catch(l){console.error("上传头像失败:",l),w.error(l.message||"上传头像失败，请重试"),ee.value=!1}finally{Z.value&&(Z.value.value="")}},We=()=>{console.log("对话框已打开，填充表单数据"),setTimeout(()=>{s.value?(m.nickname=s.value.nickname||"",m.bio=s.value.bio||"",m.wcaId=s.value.wcaId||"",console.log("表单数据已填充:",m)):(console.warn("用户数据不存在，无法填充表单"),E.initUser().then(()=>{s.value&&(m.nickname=s.value.nickname||"",m.bio=s.value.bio||"",m.wcaId=s.value.wcaId||"",console.log("重新获取用户数据后填充表单:",m))}))},100)};return O(()=>Qe()),(o,e)=>{const l=x("el-avatar"),t=x("el-button"),c=x("el-option"),i=x("el-select"),n=x("el-table-column"),S=x("el-tag"),R=x("el-table"),b=x("el-tab-pane"),D=x("el-pagination"),h=x("el-tabs"),d=x("el-input"),T=x("el-form-item"),ne=x("el-form"),pe=x("el-dialog"),ye=Xe("loading");return u(),f("div",eo,[v(Se,{name:"zoom",duration:600,appear:""},{default:g(()=>{var r,M,ke,he;return[a("div",oo,[a("div",to,[a("div",{class:"avatar-container",onClick:Je},[v(l,{size:128,src:((r=A(s))==null?void 0:r.avatar)||"/default-avatar.svg",class:"avatar"},null,8,["src"]),e[11]||(e[11]=a("div",{class:"avatar-overlay"},[a("span",null,"更换头像")],-1)),a("input",{type:"file",ref_key:"fileInput",ref:Z,style:{display:"none"},accept:"image/*",onChange:Fe},null,544)]),a("div",lo,[a("h1",so,y((M=A(s))==null?void 0:M.nickname),1),a("p",ao,y(((ke=A(s))==null?void 0:ke.bio)||"这个人很懒，什么都没写~"),1),(he=A(s))!=null&&he.wcaId?(u(),f("p",no,"WCA ID: "+y(A(s).wcaId),1)):_("",!0),a("div",ro,[v(t,{type:"primary",onClick:Pe},{default:g(()=>e[12]||(e[12]=[p(" 编辑资料 ")])),_:1})])])])])]}),_:1}),v(Se,{name:"slide-up",duration:600,delay:200,appear:""},{default:g(()=>[v(h,{modelValue:re.value,"onUpdate:modelValue":e[5]||(e[5]=r=>re.value=r),class:"profile-tabs glass-tabs"},{default:g(()=>[v(b,{label:"个人最佳",name:"personal-bests"},{default:g(()=>[a("div",io,[a("div",co,[e[13]||(e[13]=a("div",null,null,-1)),v(i,{modelValue:Q.value,"onUpdate:modelValue":e[0]||(e[0]=r=>Q.value=r),placeholder:"项目类型",size:"small",style:{width:"120px"},class:"glass-select"},{default:g(()=>[v(c,{label:"全部类型",value:"all"}),v(c,{label:"官方项目",value:"official"}),v(c,{label:"趣味项目",value:"fun"}),v(c,{label:"整活项目",value:"meme"})]),_:1},8,["modelValue"])]),be((u(),V(R,{data:we.value,style:{width:"100%"},"empty-text":"暂无成绩记录",class:"glass-table"},{default:g(()=>[v(n,{label:"项目",prop:"eventName","min-width":"120"}),v(n,{label:"单次","min-width":"120"},{default:g(r=>[isNaN(r.row.singleSeconds)?(u(),f("span",vo,"-")):(u(),f("div",uo,[p(y(F(r.row.singleSeconds))+" ",1),r.row.singleRank===1?(u(),V(S,{key:0,size:"small",type:"danger",effect:"dark",class:"gr-tag"},{default:g(()=>e[14]||(e[14]=[p(" GR ")])),_:1})):_("",!0)]))]),_:1}),v(n,{label:"平均","min-width":"120"},{default:g(r=>[isNaN(r.row.averageSeconds)?(u(),f("span",fo,"-")):(u(),f("div",go,[p(y(F(r.row.averageSeconds))+" ",1),r.row.averageRank===1?(u(),V(S,{key:0,size:"small",type:"danger",effect:"dark",class:"gr-tag"},{default:g(()=>e[15]||(e[15]=[p(" GR ")])),_:1})):_("",!0)]))]),_:1})]),_:1},8,["data"])),[[ye,Re.value]])])]),_:1}),v(b,{label:"历史成绩",name:"history"},{default:g(()=>[a("div",mo,[a("div",po,[e[16]||(e[16]=a("h2",{class:"section-title"},"历史成绩",-1)),a("div",yo,[v(i,{modelValue:J.value,"onUpdate:modelValue":e[1]||(e[1]=r=>J.value=r),placeholder:"选择项目",size:"small",class:"glass-select"},{default:g(()=>[v(c,{label:"全部项目",value:"all"}),(u(!0),f(z,null,Ie(De.value,r=>(u(),V(c,{key:r,label:A(G)(r),value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),v(i,{modelValue:oe.value,"onUpdate:modelValue":e[2]||(e[2]=r=>oe.value=r),placeholder:"排序方式",size:"small",class:"glass-select"},{default:g(()=>[v(c,{label:"最新优先",value:"latest"}),v(c,{label:"最快优先",value:"fastest"})]),_:1},8,["modelValue"])])]),be((u(),V(R,{data:Ce.value,style:{width:"100%"},"empty-text":"暂无历史成绩记录",class:"glass-table"},{default:g(()=>[v(n,{label:"项目",prop:"eventName","min-width":"100"}),v(n,{label:"单次","min-width":"100"},{default:g(r=>[a("span",null,y(F(r.row.singleSeconds)),1)]),_:1}),v(n,{label:"平均","min-width":"100"},{default:g(r=>[a("span",null,y(F(r.row.averageSeconds)),1)]),_:1}),v(n,{label:"提交时间","min-width":"160"},{default:g(r=>[a("div",{class:"record-cell",onClick:M=>xe(r.row)},[a("span",null,y(ue(r.row.timestamp)),1),e[17]||(e[17]=a("span",{class:"detail-text"}," 详情 ",-1))],8,ko)]),_:1})]),_:1},8,["data"])),[[ye,Y.value]]),ce.value>0?(u(),f("div",ho,[v(D,{"current-page":q.value,"onUpdate:currentPage":e[3]||(e[3]=r=>q.value=r),"page-size":H.value,"onUpdate:pageSize":e[4]||(e[4]=r=>H.value=r),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",total:ce.value,onSizeChange:Oe,onCurrentChange:Ve},null,8,["current-page","page-size","total"])])):_("",!0)])]),_:1}),v(b,{label:"统计分析",name:"statistics"},{default:g(()=>[a("div",_o,[e[33]||(e[33]=a("h2",{class:"section-title"},null,-1)),a("div",bo,[de.value>0?(u(),f("div",Io,[C.value>0?(u(),f(z,{key:0},[e[18]||(e[18]=p(" 你一共在 ")),a("span",So,y(C.value),1),e[19]||(e[19]=p(" 个项目中取得了第一名 "))],64)):_("",!0),N.value>0?(u(),f(z,{key:1},[C.value>0?(u(),f(z,{key:0},[p("，")],64)):(u(),f(z,{key:1},[p("你")],64)),e[20]||(e[20]=p(" 在 ")),a("span",Ro,y(N.value),1),e[21]||(e[21]=p(" 个项目中取得了前三名 "))],64)):_("",!0),C.value>0||N.value>0?(u(),f(z,{key:2},[p("，")],64)):(u(),f(z,{key:3},[p("你")],64)),e[22]||(e[22]=p(" 总共参与了 ")),a("span",wo,y(Te.value),1),e[23]||(e[23]=p(" 个项目， 上传了 ")),a("span",Co,y(de.value),1),e[24]||(e[24]=p(" 个成绩数 "))])):(u(),f("div",Do," 你还未参与任何项目哦 "))]),j.value.length>0?(u(),f("div",To,[e[31]||(e[31]=a("h3",{class:"chart-title"},"排名分布",-1)),a("div",No,[(u(!0),f(z,null,Ie(j.value,(r,M)=>(u(),f("div",{key:M,class:"rank-item"},[a("span",xo,y(A(G)(r.eventCode)),1),a("div",Oo,[r.singleRank===1?(u(),V(S,{key:0,type:"danger",effect:"dark",size:"small",round:""},{default:g(()=>e[25]||(e[25]=[p(" 单次 #1 ")])),_:1})):r.singleRank===2?(u(),V(S,{key:1,type:"warning",effect:"dark",size:"small",round:""},{default:g(()=>e[26]||(e[26]=[p(" 单次 #2 ")])),_:1})):r.singleRank===3?(u(),V(S,{key:2,type:"success",effect:"dark",size:"small",round:""},{default:g(()=>e[27]||(e[27]=[p(" 单次 #3 ")])),_:1})):_("",!0),r.averageRank===1?(u(),V(S,{key:3,type:"danger",effect:"dark",size:"small",round:""},{default:g(()=>e[28]||(e[28]=[p(" 平均 #1 ")])),_:1})):r.averageRank===2?(u(),V(S,{key:4,type:"warning",effect:"dark",size:"small",round:""},{default:g(()=>e[29]||(e[29]=[p(" 平均 #2 ")])),_:1})):r.averageRank===3?(u(),V(S,{key:5,type:"success",effect:"dark",size:"small",round:""},{default:g(()=>e[30]||(e[30]=[p(" 平均 #3 ")])),_:1})):_("",!0)])]))),128))])])):_("",!0),_("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),v(pe,{modelValue:L.value,"onUpdate:modelValue":e[9]||(e[9]=r=>L.value=r),title:"编辑资料",width:"500px","destroy-on-close":!1,"close-on-click-modal":!1,onOpen:We,class:"glass-dialog"},{footer:g(()=>[a("span",Ao,[v(t,{onClick:Be},{default:g(()=>e[34]||(e[34]=[p("取消")])),_:1}),v(t,{type:"primary",onClick:$e,disabled:!A(s)},{default:g(()=>e[35]||(e[35]=[p(" 确定 ")])),_:1},8,["disabled"])])]),default:g(()=>[A(s)?(u(),f("div",Vo,[v(ne,{ref_key:"editFormRef",ref:ae,model:m,rules:Ae,"label-width":"80px"},{default:g(()=>[v(T,{label:"昵称",prop:"nickname"},{default:g(()=>[v(d,{modelValue:m.nickname,"onUpdate:modelValue":e[6]||(e[6]=r=>m.nickname=r),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),v(T,{label:"签名",prop:"bio"},{default:g(()=>[v(d,{modelValue:m.bio,"onUpdate:modelValue":e[7]||(e[7]=r=>m.bio=r),type:"textarea",rows:3,placeholder:"请输入个人签名"},null,8,["modelValue"])]),_:1}),v(T,{label:"WCA ID",prop:"wcaId"},{default:g(()=>[v(d,{modelValue:m.wcaId,"onUpdate:modelValue":e[8]||(e[8]=r=>m.wcaId=r),placeholder:"如有请填写"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):(u(),f("div",Eo," 加载用户数据中... "))]),_:1},8,["modelValue"]),v(pe,{modelValue:te.value,"onUpdate:modelValue":e[10]||(e[10]=r=>te.value=r),title:"成绩详情",width:"500px"},{default:g(()=>[k.value?(u(),f("div",zo,[a("div",Bo,[e[36]||(e[36]=a("span",{class:"detail-label"},"项目:",-1)),a("span",$o,y(A(G)(k.value.event)),1)]),isNaN(k.value.singleSeconds)?_("",!0):(u(),f(z,{key:0},[a("div",jo,[e[37]||(e[37]=a("span",{class:"detail-label"},"单次成绩:",-1)),a("span",Po,y(F(k.value.singleSeconds)),1)]),k.value.singleRank?(u(),f("div",Jo,[e[38]||(e[38]=a("span",{class:"detail-label"},"单次排名:",-1)),a("span",Fo,"#"+y(k.value.singleRank),1)])):_("",!0)],64)),isNaN(k.value.averageSeconds)?_("",!0):(u(),f(z,{key:1},[a("div",Wo,[e[39]||(e[39]=a("span",{class:"detail-label"},"平均成绩:",-1)),a("span",Lo,y(F(k.value.averageSeconds)),1)]),k.value.averageRank?(u(),f("div",Mo,[e[40]||(e[40]=a("span",{class:"detail-label"},"平均排名:",-1)),a("span",Uo,"#"+y(k.value.averageRank),1)])):_("",!0)],64)),X(k.value.cube)?(u(),f("div",qo,[e[41]||(e[41]=a("span",{class:"detail-label"},"使用魔方:",-1)),a("span",Ho,y(k.value.cube),1)])):_("",!0),X(k.value.method)?(u(),f("div",Go,[e[42]||(e[42]=a("span",{class:"detail-label"},"解法:",-1)),a("span",Ko,y(k.value.method),1)])):_("",!0),X(k.value.remark)?(u(),f("div",Yo,[e[43]||(e[43]=a("span",{class:"detail-label"},"感想:",-1)),a("span",Qo,y(k.value.remark),1)])):_("",!0),X(k.value.videoLink)?(u(),f("div",Xo,[e[44]||(e[44]=a("span",{class:"detail-label"},"视频链接:",-1)),a("a",{href:k.value.videoLink,target:"_blank",class:"video-link"},y(k.value.videoLink),9,Zo)])):_("",!0),a("div",et,[e[45]||(e[45]=a("span",{class:"detail-label"},"提交时间:",-1)),a("span",ot,y(ue(k.value.timestamp,!0)),1)])])):_("",!0)]),_:1},8,["modelValue"])])}}},it=Le(tt,[["__scopeId","data-v-7032fe62"]]);export{it as default};
