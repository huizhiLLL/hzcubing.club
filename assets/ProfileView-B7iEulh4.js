import{_ as Le,u as Me,b as Ue,r as b,c as V,g as U,d as G,e as qe,f as He,w as Ge,a as ne,o as Ke,E as C,h as Ye,i as Qe,j as T,k as Xe,l as d,m as f,n as v,p as g,q as a,s as E,t as y,v as h,x as p,y as he,z as x,F as A,A as be,B as Ze}from"./index-Bsn6c0zj.js";import{E as Ie}from"./ElementTransition-DMMnBOwW.js";const eo={class:"profile-container"},oo={class:"card profile-header glass-card"},lo={class:"user-profile"},to={class:"user-info"},so={class:"nickname"},ao={class:"bio"},no={key:0,class:"wca-id"},ro={class:"action-buttons"},io={class:"card glass-card"},co={class:"section-header"},uo={key:0,class:"record-value"},vo={key:1},go={key:0,class:"record-value"},fo={key:1},mo={class:"card glass-card"},po={class:"section-header"},yo={class:"filter-controls"},ko=["onClick"],_o={key:0,class:"pagination-container"},ho={class:"card glass-card"},bo={class:"stats-container"},Io={key:0,class:"stats-message"},Ro={class:"highlight-number"},So={class:"highlight-number"},wo={class:"highlight-number"},Co={class:"highlight-number"},Do={key:1,class:"stats-message"},No={key:0,class:"medal-container"},To={class:"rank-list"},Vo={class:"event-name"},xo={class:"rank-badges"};const Oo={key:0,class:"glass-form"},Eo={key:1,class:"loading-text"},Ao={class:"dialog-footer"},zo={key:0,class:"record-details"},Bo={class:"detail-item"},$o={class:"detail-value"},jo={class:"detail-item"},Po={class:"detail-value"},Jo={key:0,class:"detail-item"},Fo={class:"detail-value"},Wo={class:"detail-item"},Lo={class:"detail-value"},Mo={key:0,class:"detail-item"},Uo={class:"detail-value"},qo={key:2,class:"detail-item"},Ho={class:"detail-value"},Go={key:3,class:"detail-item"},Ko={class:"detail-value"},Yo={key:4,class:"detail-item"},Qo={class:"detail-value"},Xo={key:5,class:"detail-item"},Zo=["href"],el={class:"detail-item"},ol={class:"detail-value"},ll={__name:"ProfileView",setup(tl){const K=Ye(),O=Me(),P=Ue(),{user:s}=O,Re=b(!1),z=b({}),B=b([]),Y=b(!1),re=b("personal-bests"),Q=b("all"),J=b("all"),oe=b("latest"),q=b(1),H=b(10),le=b(!1),k=b(null),ie=V(()=>{const o=[];for(const[e,t]of Object.entries(z.value||{}))t&&(!isNaN(t.singleSeconds)||!isNaN(t.averageSeconds))&&o.push({event:e,eventName:G(e),eventType:U(e),...t});return o.sort((e,t)=>{var _;const l={official:1,fun:2,meme:3},c=l[e.eventType]-l[t.eventType];if(c!==0)return c;const i=((_=qe[e.eventType])==null?void 0:_.options)||[],n=i.findIndex(I=>I.value===e.event),R=i.findIndex(I=>I.value===t.event);return(n===-1?999:n)-(R===-1?999:R)}),o}),Se=V(()=>Q.value==="all"?ie.value:ie.value.filter(o=>o.eventType===Q.value)),we=V(()=>{let o=B.value.map(l=>({...l,eventName:G(l.event)}));J.value!=="all"&&(o=o.filter(l=>l.event===J.value)),oe.value==="fastest"?o.sort((l,c)=>{const i=l.singleSeconds??1/0,n=c.singleSeconds??1/0;return i-n}):o.sort((l,c)=>{const i=new Date(l.timestamp);return new Date(c.timestamp)-i});const e=(q.value-1)*H.value,t=e+H.value;return o.slice(e,t)}),ce=V(()=>J.value==="all"?B.value.length:B.value.filter(o=>o.event===J.value).length),Ce=V(()=>{const o=new Set;return B.value.forEach(e=>{e.event&&o.add(e.event)}),Array.from(o).sort()}),de=V(()=>B.value.length),De=V(()=>{const o=new Set;return B.value.forEach(e=>{o.add(e.event)}),o.size}),N=b(0),D=b(0),Ne=V(()=>{const o={};return B.value.forEach(e=>{o[e.event]||(o[e.event]=0),o[e.event]++}),o}),sl=V(()=>{const o=Object.values(Ne.value);return o.length>0?Math.max(...o):0}),F=o=>{if(!o||isNaN(o))return"-";if(o<60)return o.toFixed(2);const e=Math.floor(o/60),t=(o%60).toFixed(2).padStart(5,"0");return`${e}:${t}`},ue=(o,e=!1)=>{if(!o)return"-";try{const t=new Date(o.$date||o),l=t.getFullYear(),c=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");let n=`${l}.${c}.${i}`;if(e){const R=String(t.getHours()).padStart(2,"0"),S=String(t.getMinutes()).padStart(2,"0");n+=` ${R}:${S}`}return n}catch{return"日期格式错误"}},Te=o=>{var t,l,c,i;console.log("Record details:",JSON.stringify(o,null,2));const e={...o,cube:o.cube||((t=o.single)==null?void 0:t.cube)||((l=o.average)==null?void 0:l.cube),method:o.method||((c=o.single)==null?void 0:c.method)||((i=o.average)==null?void 0:i.method),remark:o.remark,videoLink:o.videoLink};k.value=e,le.value=!0},Ve=o=>{H.value=o,q.value=1},xe=o=>{q.value=o},ve=async o=>{var e,t;try{let l=o||((e=s.value)==null?void 0:e._id)||((t=s.value)==null?void 0:t.id);if(console.log("获取个人最佳记录 - 原始用户ID:",l),!o&&typeof s.value=="object"&&s.value!==null&&(s.value._id?l=s.value._id:s.value.id&&(l=s.value.id)),console.log("获取个人最佳记录 - 最终使用的用户ID:",l),console.log("获取个人最佳记录 - 用户对象:",s.value?JSON.stringify(s.value):"未登录"),!l){console.error("无法获取用户ID，用户可能未登录或数据未加载完成");return}console.log("开始请求个人最佳记录API, userId:",l);const c=await ne.getUsersBestRecord(l);if(console.log("个人最佳记录API响应数据:",JSON.stringify(c)),me(c,"个人最佳记录"),c.code===200&&c.data){const i={};if((c.data||[]).forEach(n=>{i[n.event]={singleSeconds:typeof n.bestSingleSeconds=="number"?n.bestSingleSeconds:null,averageSeconds:typeof n.bestAverageSeconds=="number"?n.bestAverageSeconds:null}}),z.value=i,console.log("个人最佳记录数据已加载, 条目数:",Object.keys(i).length),Object.keys(i).length>0){const n=Object.keys(i)[0];console.log("第一个项目的数据结构:",JSON.stringify(i[n]))}}else console.error("获取用户成绩失败:",c.message,"响应码:",c.code)}catch(l){console.error("获取用户成绩出错:",l)}},ge=async o=>{var e,t;Y.value=!0;try{let l=o||((e=s.value)==null?void 0:e._id)||((t=s.value)==null?void 0:t.id);if(console.log("获取历史记录 - 原始用户ID:",l),!o&&typeof s.value=="object"&&s.value!==null&&(s.value._id?l=s.value._id:s.value.id&&(l=s.value.id)),console.log("获取历史记录 - 最终使用的用户ID:",l),console.log("获取历史记录 - 用户对象:",s.value?JSON.stringify(s.value):"未登录"),!l){console.error("无法获取用户ID，用户可能未登录或数据未加载完成"),Y.value=!1;return}console.log("开始请求历史记录API, userId:",l);const c=await ne.getUsersHistoryRecord(l);if(console.log("历史记录API响应数据:",JSON.stringify(c)),me(c,"历史记录"),c.code===200&&c.data){const i=(c.data||[]).map(n=>({...n,singleSeconds:typeof n.singleSeconds=="number"?n.singleSeconds:n.single&&typeof n.single.time=="number"?n.single.time:null,averageSeconds:typeof n.averageSeconds=="number"?n.averageSeconds:n.average&&typeof n.average.time=="number"?n.average.time:null}));B.value=i,console.log("历史记录数据已加载, 条目数:",i.length),i.length>0&&console.log("第一条历史记录的数据结构:",JSON.stringify(i[0])),await fe(l)}else console.error("获取用户历史成绩失败:",c.message,"响应码:",c.code)}catch(l){console.error("获取用户历史成绩出错:",l)}finally{Y.value=!1}},fe=async o=>{try{console.log("检查排行榜数据是否已加载, 当前记录数:",P.records.length),P.records.length===0&&(console.log("排行榜数据未加载，开始获取..."),await P.fetchRecords(),console.log("排行榜数据加载完成, 记录数:",P.records.length)),console.log("开始计算排名..."),Oe(o),console.log("手动计算统计数据..."),N.value=te(),D.value=se(),console.log("排名计算完成，统计结果:",{topThreeCount:N.value,firstPlaceCount:D.value,topThreeRecordsCount:Object.keys(W.value).length,sortedTopThreeRecordsCount:$.value.length})}catch(e){console.error("加载排行榜数据出错:",e),N.value=te(),D.value=se()}},me=(o,e)=>{try{if(console.log(`调试${e}API返回数据:`),!o){console.log("数据为空");return}console.log("数据类型:",typeof o),typeof o=="object"&&(console.log("是否为数组:",Array.isArray(o)),console.log("顶层键:",Object.keys(o)),Array.isArray(o)?(console.log("数组长度:",o.length),o.length>0&&console.log("第一条数据示例:",JSON.stringify(o[0]).substring(0,200)+"...")):("code"in o&&console.log("code:",o.code),"message"in o&&console.log("message:",o.message),"data"in o&&(console.log("data字段类型:",typeof o.data),Array.isArray(o.data)?(console.log("data数组长度:",o.data.length),o.data.length>0&&console.log("第一条数据示例:",JSON.stringify(o.data[0]).substring(0,200)+"...")):typeof o.data=="object"&&o.data&&console.log("data对象键:",Object.keys(o.data)))))}catch(t){console.error("调试数据时出错:",t)}},Oe=o=>{var e,t;try{const l=o||((e=s.value)==null?void 0:e._id)||((t=s.value)==null?void 0:t.id);if(!l){console.error("计算排名时无法获取用户ID");return}console.log("开始计算排名, 用户ID:",l),console.log("当前recordsStore中记录数:",P.records.length),N.value=0,D.value=0;for(const[i,n]of Object.entries(z.value)){if(U(i)==="meme"){console.log(`项目 ${i} 是整活项目，跳过排名计算`);continue}const S=P.getRecordsByEvent(i);if(console.log(`项目 ${i} 的记录数:`,S.length),!isNaN(n.singleSeconds)){const w=new Map;S.forEach(u=>{!u.userId||u.singleSeconds==null||(!w.has(u.userId)||u.singleSeconds<w.get(u.userId).time)&&w.set(u.userId,{userId:u.userId,time:u.singleSeconds})});const _=Array.from(w.values()).sort((u,j)=>u.time-j.time);console.log(`项目 ${i} 单次排序后的记录:`,_.map(u=>({userId:u.userId,time:u.time})));const I=_.findIndex(u=>u.userId===l)+1;I>0?(n.singleRank=I,console.log(`项目 ${i} 单次排名:`,I),I===1&&(D.value++,console.log("第一名计数增加，当前:",D.value)),I<=3&&(N.value++,console.log("前三名计数增加，当前:",N.value))):(console.log(`项目 ${i} 单次排名未找到，用户ID:`,l),console.log("排序后的记录中的用户ID:",_.map(u=>u.userId)))}if(!isNaN(n.averageSeconds)){const w=new Map;S.forEach(u=>{!u.userId||u.averageSeconds==null||(!w.has(u.userId)||u.averageSeconds<w.get(u.userId).time)&&w.set(u.userId,{userId:u.userId,time:u.averageSeconds})});const _=Array.from(w.values()).sort((u,j)=>u.time-j.time);console.log(`项目 ${i} 平均排序后的记录:`,_.map(u=>({userId:u.userId,time:u.time})));const I=_.findIndex(u=>u.userId===l)+1;I>0?(n.averageRank=I,console.log(`项目 ${i} 平均排名:`,I),I===1&&(D.value++,console.log("第一名计数增加，当前:",D.value)),I<=3&&(N.value++,console.log("前三名计数增加，当前:",N.value))):(console.log(`项目 ${i} 平均排名未找到，用户ID:`,l),console.log("排序后的记录中的用户ID:",_.map(u=>u.userId)))}}console.log("排名计算完成, 前三名数量:",N.value,"第一名数量:",D.value);const c=Object.keys(W.value).length;console.log("topThreeRecords条目数:",c),c>0&&console.log("topThreeRecords内容示例:",JSON.stringify(Object.entries(W.value)[0])),console.log("sortedTopThreeRecords条目数:",$.value.length),$.value.length>0&&console.log("sortedTopThreeRecords内容示例:",JSON.stringify($.value[0]))}catch(l){console.error("计算排名信息出错:",l),N.value=te(),D.value=se()}},te=()=>{console.log("计算排名前三的数量");let o=0,e=0;for(const[t,l]of Object.entries(z.value)){if(U(t)==="meme")continue;e++;const i=l.singleRank&&l.singleRank<=3,n=l.averageRank&&l.averageRank<=3;(i||n)&&(o++,console.log(`项目 ${t} 有前三名排名:`,i?`单次 #${l.singleRank}`:"",n?`平均 #${l.averageRank}`:""))}return console.log(`共检查了 ${e} 个项目，有 ${o} 个项目排名前三`),o},se=()=>{console.log("计算第一名的数量");let o=0,e=0;for(const[t,l]of Object.entries(z.value)){if(U(t)==="meme")continue;e++;const i=l.singleRank===1,n=l.averageRank===1;(i||n)&&(o++,console.log(`项目 ${t} 有第一名排名:`,i?"单次 #1":"",n?"平均 #1":""))}return console.log(`共检查了 ${e} 个项目，有 ${o} 个项目排名第一`),o},X=o=>o!=null&&o!=="null"&&o!=="",W=V(()=>{console.log("计算topThreeRecords，personalBests条目数:",Object.keys(z.value).length);const o={};for(const[e,t]of Object.entries(z.value)){if(U(e)==="meme")continue;const c=t.singleRank&&t.singleRank<=3,i=t.averageRank&&t.averageRank<=3;(c||i)&&(o[e]={...t,eventCode:e})}return console.log("topThreeRecords结果条目数:",Object.keys(o).length),o}),$=V(()=>{console.log("计算sortedTopThreeRecords，topThreeRecords条目数:",Object.keys(W.value).length);const o=[];for(const[t,l]of Object.entries(W.value)){const c={...l,eventCode:t||l.eventCode},i=l.singleRank&&l.singleRank<=3?l.singleRank:999,n=l.averageRank&&l.averageRank<=3?l.averageRank:999;o.push({...c,singleRank:l.singleRank,averageRank:l.averageRank,rankWeight:Math.min(i,n)})}const e=o.sort((t,l)=>t.rankWeight-l.rankWeight);return console.log("sortedTopThreeRecords结果条目数:",e.length),e.length>0&&console.log("排序后第一条记录:",JSON.stringify({eventCode:e[0].eventCode,singleRank:e[0].singleRank,averageRank:e[0].averageRank,rankWeight:e[0].rankWeight})),e});V(()=>{const o={};for(const[e,t]of Object.entries(z.value))U(e)!=="meme"&&(t.singleRank===1||t.averageRank===1)&&(o[e]=t);return o});const L=b(!1),ae=b(),m=He({nickname:"",bio:"",wcaId:""}),Ee={nickname:[{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],bio:[{max:200,message:"签名不能超过200个字符",trigger:"blur"}],wcaId:[{max:20,message:"WCA ID 最多20字符",trigger:"blur"}]},Ae=async()=>{console.log("刷新用户信息"),await O.initUser(),s.value&&Ze(()=>{try{const o=document.querySelector(".nickname"),e=document.querySelector(".bio");o&&(o.textContent=s.value.nickname||""),e&&(e.textContent=s.value.bio||"这个人很懒，什么都没写~");let t=document.querySelector(".wca-id");s.value.wcaId?t?(t.textContent=`WCA ID: ${s.value.wcaId}`,t.style.display="block"):(t=document.createElement("p"),t.className="wca-id",t.textContent=`WCA ID: ${s.value.wcaId}`,e&&e.parentNode&&e.parentNode.insertBefore(t,e.nextSibling)):t&&(t.style.display="none"),console.log("页面更新完成")}catch(o){console.error("更新页面时出错:",o)}})},ze=()=>{console.log("取消编辑"),L.value=!1},Be=async()=>{ae.value&&await ae.value.validate(async o=>{if(o){const e=C({message:"正在更新资料...",type:"info",duration:0});try{if(!O.user){e.close(),C.error("请先登录"),K.push("/login");return}const t=localStorage.getItem("token");if(!t){e.close(),C.error("登录状态已过期，请重新登录"),K.push("/login");return}console.log("提交数据:",JSON.stringify(m)),console.log("当前用户状态:",JSON.stringify(O.user)),console.log("当前token:",t);const l=await O.updateProfile(m);console.log("更新结果:",l),e.close(),L.value=!1,C.success("个人资料更新成功"),await Ae()}catch(t){e.close(),console.error("资料更新失败:",t),t.message&&t.message.includes("登录")?(C.error("登录状态已过期，请重新登录"),localStorage.removeItem("token"),O.clearToken(),K.push("/login")):C.error(t.message||"更新失败，请重试")}}})};Ge(()=>O.user,(o,e)=>{if(console.log("用户数据发生变化:",o?`ID: ${o._id||o.id}`:"无用户数据",e?`旧ID: ${e._id||e.id}`:"之前无用户数据"),o&&L.value&&(m.nickname=o.nickname||"",m.bio=o.bio||"",m.wcaId=o.wcaId||"",console.log("用户数据更新，重新设置表单数据:",m)),o&&(!e||(o._id||o.id)!==(e._id||e.id))){console.log("用户信息已更新，重新获取成绩记录"),!o._id&&o.id&&(o._id=o.id,console.log("添加_id字段:",o._id)),!o.id&&o._id&&(o.id=o._id,console.log("添加id字段:",o.id));const t=o._id||o.id;t?(console.log("监听到用户ID变化，开始获取成绩记录:",t),ve(t),ge(t)):console.error("监听到用户变化，但没有有效的ID字段")}},{deep:!0});const $e=async()=>{console.log("开始初始化数据...");try{let o=null;if(s.value&&(console.log("用户对象存在，尝试获取ID"),console.log("用户对象结构:",JSON.stringify(s.value)),s.value._id?(o=s.value._id,console.log("从user.value._id获取ID:",o)):s.value.id?(o=s.value.id,console.log("从user.value.id获取ID:",o)):typeof s.value=="string"&&(o=s.value,console.log("用户对象本身是ID字符串:",o))),!o){console.log("用户ID未找到，尝试等待用户信息加载...");const e=localStorage.getItem("token"),t=localStorage.getItem("userInfo");if(t)try{console.log("从localStorage获取缓存的用户信息");const l=JSON.parse(t);l&&(l._id||l.id)&&(o=l._id||l.id,console.log("从缓存用户信息获取ID:",o))}catch(l){console.error("解析缓存用户信息失败:",l)}if(!o&&e){console.log("发现token，尝试初始化用户信息");try{await O.initUser(),s.value&&(s.value._id?o=s.value._id:s.value.id&&(o=s.value.id),console.log("用户初始化后的ID:",o))}catch(l){console.error("初始化用户失败:",l)}}}if(o||(console.log("尝试使用控制台显示的ID"),o="68359567c0efb590c7e1092f",console.log("使用固定ID:",o)),!o){console.error("无法获取用户ID，用户可能未登录"),C.warning("请先登录后查看个人资料"),K.push("/");return}console.log("使用当前用户ID获取成绩记录:",o),await ve(o),await ge(o),await fe(o),console.log("初始化完成，检查排名结果:",{personalBestsCount:Object.keys(z.value).length,historyRecordsCount:B.value.length,topThreeCount:N.value,firstPlaceCount:D.value,topThreeRecordsCount:Object.keys(W.value).length,sortedTopThreeRecordsCount:$.value.length})}catch(o){console.error("初始化数据失败:",o)}};Ke(async()=>{var t,l;console.log("ProfileView 组件挂载开始");const o=((t=s.value)==null?void 0:t._id)||((l=s.value)==null?void 0:l.id);console.log("组件挂载时的用户ID:",o||"未登录"),await $e(),localStorage.getItem("profile_message")==="edit_success"&&C.success("资料更新成功"),localStorage.removeItem("profile_message"),console.log("ProfileView 组件挂载完成")});const je=()=>{s.value&&(m.nickname=s.value.nickname||"",m.bio=s.value.bio||"",m.wcaId=s.value.wcaId||"",console.log("预填充表单数据:",m)),L.value=!0},Z=b(null),ee=b(!1),Pe=()=>{Z.value.click()},Je=async o=>{const e=o.target.files[0];if(!e){C.error("未选择文件");return}if(console.log("选择的文件:",e.name,"类型:",e.type,"大小:",(e.size/1024).toFixed(2),"KB"),!e.type.startsWith("image/")){C.error("请选择图片文件");return}if(e.size>2*1024*1024){C.error("图片大小不能超过2MB");return}ee.value=!0,C.info("正在上传头像...");try{const t=new FileReader;t.onload=async l=>{var c,i;try{const n=l.target.result;console.log("文件已转换为base64，长度:",n.length);const R=n.split(",")[1],S={userId:(c=O.user)==null?void 0:c._id,fileName:e.name,fileType:e.type,fileSize:e.size,fileData:R};console.log("发送数据:",{userId:S.userId,fileName:S.fileName,fileType:S.fileType,fileSize:S.fileSize,fileDataLength:S.fileData.length});const w=localStorage.getItem("token");console.log("有token:",!!w),console.log("开始发送上传请求...");const _=await ne.uploadAvatar(S);if(console.log("解析响应:",_),_.code===200&&((i=_.data)!=null&&i.avatarUrl))s.value&&(console.log("更新头像URL:",_.data.avatarUrl),s.value.avatar=_.data.avatarUrl,localStorage.setItem("userInfo",JSON.stringify(s.value))),C.success("头像更新成功");else throw new Error(_.message||"上传失败")}catch(n){console.error("处理上传失败:",n),C.error(n.message||"上传头像失败，请重试"),ee.value=!1}},t.onerror=l=>{console.error("文件读取失败:",l),C.error("文件读取失败"),ee.value=!1},t.readAsDataURL(e)}catch(t){console.error("上传头像失败:",t),C.error(t.message||"上传头像失败，请重试"),ee.value=!1}finally{Z.value&&(Z.value.value="")}},Fe=()=>{console.log("对话框已打开，填充表单数据"),setTimeout(()=>{s.value?(m.nickname=s.value.nickname||"",m.bio=s.value.bio||"",m.wcaId=s.value.wcaId||"",console.log("表单数据已填充:",m)):(console.warn("用户数据不存在，无法填充表单"),O.initUser().then(()=>{s.value&&(m.nickname=s.value.nickname||"",m.bio=s.value.bio||"",m.wcaId=s.value.wcaId||"",console.log("重新获取用户数据后填充表单:",m))}))},100)};return V(()=>Qe()),(o,e)=>{const t=T("el-avatar"),l=T("el-button"),c=T("el-option"),i=T("el-select"),n=T("el-table-column"),R=T("el-tag"),S=T("el-table"),w=T("el-tab-pane"),_=T("el-pagination"),I=T("el-tabs"),u=T("el-input"),j=T("el-form-item"),We=T("el-form"),pe=T("el-dialog"),ye=Xe("loading");return d(),f("div",eo,[v(Ie,{name:"zoom",duration:600,appear:""},{default:g(()=>{var r,M,ke,_e;return[a("div",oo,[a("div",lo,[a("div",{class:"avatar-container",onClick:Pe},[v(t,{size:128,src:((r=E(s))==null?void 0:r.avatar)||"/default-avatar.svg",class:"avatar"},null,8,["src"]),e[11]||(e[11]=a("div",{class:"avatar-overlay"},[a("span",null,"更换头像")],-1)),a("input",{type:"file",ref_key:"fileInput",ref:Z,style:{display:"none"},accept:"image/*",onChange:Je},null,544)]),a("div",to,[a("h1",so,y((M=E(s))==null?void 0:M.nickname),1),a("p",ao,y(((ke=E(s))==null?void 0:ke.bio)||"这个人很懒，什么都没写~"),1),(_e=E(s))!=null&&_e.wcaId?(d(),f("p",no,"WCA ID: "+y(E(s).wcaId),1)):h("",!0),a("div",ro,[v(l,{type:"primary",onClick:je},{default:g(()=>e[12]||(e[12]=[p(" 编辑资料 ")])),_:1})])])])])]}),_:1}),v(Ie,{name:"slide-up",duration:600,delay:200,appear:""},{default:g(()=>[v(I,{modelValue:re.value,"onUpdate:modelValue":e[5]||(e[5]=r=>re.value=r),class:"profile-tabs glass-tabs"},{default:g(()=>[v(w,{label:"个人最佳",name:"personal-bests"},{default:g(()=>[a("div",io,[a("div",co,[e[13]||(e[13]=a("div",null,null,-1)),v(i,{modelValue:Q.value,"onUpdate:modelValue":e[0]||(e[0]=r=>Q.value=r),placeholder:"项目类型",size:"small",style:{width:"120px"},class:"glass-select"},{default:g(()=>[v(c,{label:"全部类型",value:"all"}),v(c,{label:"官方项目",value:"official"}),v(c,{label:"趣味项目",value:"fun"}),v(c,{label:"整活项目",value:"meme"})]),_:1},8,["modelValue"])]),he((d(),x(S,{data:Se.value,style:{width:"100%"},"empty-text":"暂无成绩记录",class:"glass-table"},{default:g(()=>[v(n,{label:"项目",prop:"eventName","min-width":"120"}),v(n,{label:"单次","min-width":"120"},{default:g(r=>[isNaN(r.row.singleSeconds)?(d(),f("span",vo,"-")):(d(),f("div",uo,[p(y(F(r.row.singleSeconds))+" ",1),r.row.singleRank===1?(d(),x(R,{key:0,size:"small",type:"danger",effect:"dark",class:"gr-tag"},{default:g(()=>e[14]||(e[14]=[p(" GR ")])),_:1})):h("",!0)]))]),_:1}),v(n,{label:"平均","min-width":"120"},{default:g(r=>[isNaN(r.row.averageSeconds)?(d(),f("span",fo,"-")):(d(),f("div",go,[p(y(F(r.row.averageSeconds))+" ",1),r.row.averageRank===1?(d(),x(R,{key:0,size:"small",type:"danger",effect:"dark",class:"gr-tag"},{default:g(()=>e[15]||(e[15]=[p(" GR ")])),_:1})):h("",!0)]))]),_:1})]),_:1},8,["data"])),[[ye,Re.value]])])]),_:1}),v(w,{label:"历史成绩",name:"history"},{default:g(()=>[a("div",mo,[a("div",po,[e[16]||(e[16]=a("h2",{class:"section-title"},"历史成绩",-1)),a("div",yo,[v(i,{modelValue:J.value,"onUpdate:modelValue":e[1]||(e[1]=r=>J.value=r),placeholder:"选择项目",size:"small",class:"glass-select"},{default:g(()=>[v(c,{label:"全部项目",value:"all"}),(d(!0),f(A,null,be(Ce.value,r=>(d(),x(c,{key:r,label:E(G)(r),value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),v(i,{modelValue:oe.value,"onUpdate:modelValue":e[2]||(e[2]=r=>oe.value=r),placeholder:"排序方式",size:"small",class:"glass-select"},{default:g(()=>[v(c,{label:"最新优先",value:"latest"}),v(c,{label:"最快优先",value:"fastest"})]),_:1},8,["modelValue"])])]),he((d(),x(S,{data:we.value,style:{width:"100%"},"empty-text":"暂无历史成绩记录",class:"glass-table"},{default:g(()=>[v(n,{label:"项目",prop:"eventName","min-width":"100"}),v(n,{label:"单次","min-width":"100"},{default:g(r=>[a("span",null,y(F(r.row.singleSeconds)),1)]),_:1}),v(n,{label:"平均","min-width":"100"},{default:g(r=>[a("span",null,y(F(r.row.averageSeconds)),1)]),_:1}),v(n,{label:"提交时间","min-width":"160"},{default:g(r=>[a("div",{class:"record-cell",onClick:M=>Te(r.row)},[a("span",null,y(ue(r.row.timestamp)),1),e[17]||(e[17]=a("span",{class:"detail-text"}," 详情 ",-1))],8,ko)]),_:1})]),_:1},8,["data"])),[[ye,Y.value]]),ce.value>0?(d(),f("div",_o,[v(_,{"current-page":q.value,"onUpdate:currentPage":e[3]||(e[3]=r=>q.value=r),"page-size":H.value,"onUpdate:pageSize":e[4]||(e[4]=r=>H.value=r),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",total:ce.value,onSizeChange:Ve,onCurrentChange:xe},null,8,["current-page","page-size","total"])])):h("",!0)])]),_:1}),v(w,{label:"统计分析",name:"statistics"},{default:g(()=>[a("div",ho,[e[33]||(e[33]=a("h2",{class:"section-title"},null,-1)),a("div",bo,[de.value>0?(d(),f("div",Io,[D.value>0?(d(),f(A,{key:0},[e[18]||(e[18]=p(" 你一共在 ")),a("span",Ro,y(D.value),1),e[19]||(e[19]=p(" 个项目中取得了第一名 "))],64)):h("",!0),N.value>0?(d(),f(A,{key:1},[D.value>0?(d(),f(A,{key:0},[p("，")],64)):(d(),f(A,{key:1},[p("你")],64)),e[20]||(e[20]=p(" 在 ")),a("span",So,y(N.value),1),e[21]||(e[21]=p(" 个项目中取得了前三名 "))],64)):h("",!0),D.value>0||N.value>0?(d(),f(A,{key:2},[p("，")],64)):(d(),f(A,{key:3},[p("你")],64)),e[22]||(e[22]=p(" 总共参与了 ")),a("span",wo,y(De.value),1),e[23]||(e[23]=p(" 个项目， 上传了 ")),a("span",Co,y(de.value),1),e[24]||(e[24]=p(" 个成绩数 "))])):(d(),f("div",Do," 你还未参与任何项目哦 "))]),$.value.length>0?(d(),f("div",No,[e[31]||(e[31]=a("h3",{class:"chart-title"},"排名分布",-1)),a("div",To,[(d(!0),f(A,null,be($.value,(r,M)=>(d(),f("div",{key:M,class:"rank-item"},[a("span",Vo,y(E(G)(r.eventCode)),1),a("div",xo,[r.singleRank===1?(d(),x(R,{key:0,type:"danger",effect:"dark",size:"small",round:""},{default:g(()=>e[25]||(e[25]=[p(" 单次 #1 ")])),_:1})):r.singleRank===2?(d(),x(R,{key:1,type:"warning",effect:"dark",size:"small",round:""},{default:g(()=>e[26]||(e[26]=[p(" 单次 #2 ")])),_:1})):r.singleRank===3?(d(),x(R,{key:2,type:"success",effect:"dark",size:"small",round:""},{default:g(()=>e[27]||(e[27]=[p(" 单次 #3 ")])),_:1})):h("",!0),r.averageRank===1?(d(),x(R,{key:3,type:"danger",effect:"dark",size:"small",round:""},{default:g(()=>e[28]||(e[28]=[p(" 平均 #1 ")])),_:1})):r.averageRank===2?(d(),x(R,{key:4,type:"warning",effect:"dark",size:"small",round:""},{default:g(()=>e[29]||(e[29]=[p(" 平均 #2 ")])),_:1})):r.averageRank===3?(d(),x(R,{key:5,type:"success",effect:"dark",size:"small",round:""},{default:g(()=>e[30]||(e[30]=[p(" 平均 #3 ")])),_:1})):h("",!0)])]))),128))])])):h("",!0),h("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),v(pe,{modelValue:L.value,"onUpdate:modelValue":e[9]||(e[9]=r=>L.value=r),title:"编辑资料",width:"500px","destroy-on-close":!1,"close-on-click-modal":!1,onOpen:Fe,class:"glass-dialog"},{footer:g(()=>[a("span",Ao,[v(l,{onClick:ze},{default:g(()=>e[34]||(e[34]=[p("取消")])),_:1}),v(l,{type:"primary",onClick:Be,disabled:!E(s)},{default:g(()=>e[35]||(e[35]=[p(" 确定 ")])),_:1},8,["disabled"])])]),default:g(()=>[E(s)?(d(),f("div",Oo,[v(We,{ref_key:"editFormRef",ref:ae,model:m,rules:Ee,"label-width":"80px"},{default:g(()=>[v(j,{label:"昵称",prop:"nickname"},{default:g(()=>[v(u,{modelValue:m.nickname,"onUpdate:modelValue":e[6]||(e[6]=r=>m.nickname=r),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),v(j,{label:"签名",prop:"bio"},{default:g(()=>[v(u,{modelValue:m.bio,"onUpdate:modelValue":e[7]||(e[7]=r=>m.bio=r),type:"textarea",rows:3,placeholder:"请输入个人签名"},null,8,["modelValue"])]),_:1}),v(j,{label:"WCA ID",prop:"wcaId"},{default:g(()=>[v(u,{modelValue:m.wcaId,"onUpdate:modelValue":e[8]||(e[8]=r=>m.wcaId=r),placeholder:"如有请填写"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):(d(),f("div",Eo," 加载用户数据中... "))]),_:1},8,["modelValue"]),v(pe,{modelValue:le.value,"onUpdate:modelValue":e[10]||(e[10]=r=>le.value=r),title:"成绩详情",width:"500px"},{default:g(()=>[k.value?(d(),f("div",zo,[a("div",Bo,[e[36]||(e[36]=a("span",{class:"detail-label"},"项目:",-1)),a("span",$o,y(E(G)(k.value.event)),1)]),isNaN(k.value.singleSeconds)?h("",!0):(d(),f(A,{key:0},[a("div",jo,[e[37]||(e[37]=a("span",{class:"detail-label"},"单次成绩:",-1)),a("span",Po,y(F(k.value.singleSeconds)),1)]),k.value.singleRank?(d(),f("div",Jo,[e[38]||(e[38]=a("span",{class:"detail-label"},"单次排名:",-1)),a("span",Fo,"#"+y(k.value.singleRank),1)])):h("",!0)],64)),isNaN(k.value.averageSeconds)?h("",!0):(d(),f(A,{key:1},[a("div",Wo,[e[39]||(e[39]=a("span",{class:"detail-label"},"平均成绩:",-1)),a("span",Lo,y(F(k.value.averageSeconds)),1)]),k.value.averageRank?(d(),f("div",Mo,[e[40]||(e[40]=a("span",{class:"detail-label"},"平均排名:",-1)),a("span",Uo,"#"+y(k.value.averageRank),1)])):h("",!0)],64)),X(k.value.cube)?(d(),f("div",qo,[e[41]||(e[41]=a("span",{class:"detail-label"},"使用魔方:",-1)),a("span",Ho,y(k.value.cube),1)])):h("",!0),X(k.value.method)?(d(),f("div",Go,[e[42]||(e[42]=a("span",{class:"detail-label"},"解法:",-1)),a("span",Ko,y(k.value.method),1)])):h("",!0),X(k.value.remark)?(d(),f("div",Yo,[e[43]||(e[43]=a("span",{class:"detail-label"},"感想:",-1)),a("span",Qo,y(k.value.remark),1)])):h("",!0),X(k.value.videoLink)?(d(),f("div",Xo,[e[44]||(e[44]=a("span",{class:"detail-label"},"视频链接:",-1)),a("a",{href:k.value.videoLink,target:"_blank",class:"video-link"},y(k.value.videoLink),9,Zo)])):h("",!0),a("div",el,[e[45]||(e[45]=a("span",{class:"detail-label"},"提交时间:",-1)),a("span",ol,y(ue(k.value.timestamp,!0)),1)])])):h("",!0)]),_:1},8,["modelValue"])])}}},il=Le(ll,[["__scopeId","data-v-e9fc5a72"]]);export{il as default};
