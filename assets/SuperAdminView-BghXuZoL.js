import{_ as Te,h as Be,u as De,J as Ae,r as c,c as Ee,o as Ne,E as f,a as k,b as Le,j as i,k as Fe,l as p,m as _,q as a,n as t,p as n,x as d,t as u,s as m,a6 as Z,a7 as Pe,a8 as je,a9 as qe,ab as We,a1 as ee,a3 as Ie,aa as Je,v as w,F as W,A as I,T as Oe,$ as Qe,y as Ge,z as se,S as He,M as te}from"./index-Bq31S5oz.js";import{g as M,A as Ke}from"./AdminDashboard-COTxgLR7.js";import{R as Xe}from"./RecordsTable-Dy_ydgLE.js";const Ye={class:"super-admin-container"},Ze={class:"admin-layout"},es={class:"admin-sidebar"},ss={class:"sidebar-header"},ts={class:"sidebar-footer"},as={class:"admin-main"},ns={key:0,class:"admin-section"},ls={key:1,class:"admin-section"},os={key:2,class:"admin-section"},rs={class:"feedback-list"},is={class:"feedback-header"},us={class:"feedback-user"},ds={class:"feedback-time"},cs={class:"feedback-content"},ms={class:"feedback-status"},ps={key:0,class:"empty-feedback"},_s={key:3,class:"admin-section"},fs={class:"user-stats-grid"},vs={class:"role-stats"},gs={class:"role-stat-item"},ys={class:"role-count"},bs={class:"role-stat-item"},ws={class:"role-count"},ks={class:"role-stat-item"},Cs={class:"role-count"},hs={class:"status-stats"},Ss={class:"status-stat-item"},xs={class:"status-count"},Us={class:"status-stat-item"},Rs={class:"status-count"},Vs={class:"status-stat-item"},zs={class:"status-count"},$s={key:4,class:"admin-section"},Ms={class:"section-header"},Ts={class:"section-actions"},Bs={class:"pagination-container"},Ds={key:5,class:"admin-section"},As={class:"role-overview"},Es={class:"roles-overview-grid"},Ns={class:"role-header"},Ls={class:"user-count"},Fs={class:"role-permissions"},Ps={key:6,class:"admin-section"},js={class:"setting-item"},qs={key:0,class:"edit-role-content"},Ws={class:"role-selection"},Is={__name:"SuperAdminView",setup(Js){const ae=Be(),J=De(),ne=Ae(),g=c("dashboard"),T=c(!1),O=c([]),B=c(""),x=c(""),D=c(1),A=c(20),Q=c(0),G=c([]),E=c([]),C=c({userCount:0,adminCount:0,superAdminCount:0,activeCount:0,inactiveCount:0,bannedCount:0}),U=c(!1),v=c(null),b=c(""),L=c(!1),R=c(!1),F=c(!1),H=c([{key:"user",name:"用户",userCount:0,permissions:["view_records","submit_record","edit_own_record"]},{key:"admin",name:"管理员",userCount:0,permissions:["view_records","submit_record","admin_panel"]},{key:"super_admin",name:"超级管理员",userCount:0,permissions:["manage_users","manage_permissions","system_config"]}]),le=Ee(()=>{let s=O.value;if(B.value){const e=B.value.toLowerCase();s=s.filter(r=>{var o,y;return((o=r.nickname)==null?void 0:o.toLowerCase().includes(e))||((y=r.email)==null?void 0:y.toLowerCase().includes(e))})}return x.value&&(s=s.filter(e=>e.role===x.value)),s}),oe=s=>{g.value=s,K(s)},K=async s=>{T.value=!0;try{switch(s){case"dashboard":break;case"records":await X();break;case"feedback":await re();break;case"users-stats":await ie();break;case"user-management":await V();break;case"role-management":await ue();break;case"system-settings":await de();break}}catch(e){f.error("加载数据失败: "+e.message)}finally{T.value=!1}},X=async()=>{try{const s=Le();await s.fetchRecords(),G.value=s.records}catch(s){console.error("获取成绩记录失败:",s),f.error("获取成绩记录失败: "+s.message)}},re=async()=>{try{const s=await k.getFeedbackList({page:1,pageSize:50});if(s.code===200)E.value=s.data||[];else throw new Error(s.message||"获取用户反馈失败")}catch(s){f.error("获取用户反馈失败: "+s.message),E.value=[]}},ie=async()=>{try{const s=await k.getWebsiteStats();if(s.code===200){const{userStats:e}=s.data;C.value={userCount:e.usersByRole.user,adminCount:e.usersByRole.admin,superAdminCount:e.usersByRole.super_admin,activeCount:e.activeUsers,inactiveCount:e.inactiveUsers,bannedCount:e.bannedUsers}}else throw new Error(s.message||"获取用户统计失败")}catch(s){console.error("获取用户统计失败:",s),f.error("获取用户统计失败: "+s.message)}},V=async()=>{try{const s=await k.getAllUsers({page:D.value,pageSize:A.value,role:x.value});if(s.code===200)O.value=s.data||[],Q.value=s.total||0;else throw new Error(s.message||"获取用户列表失败")}catch(s){console.error("获取用户列表失败:",s),f.error("获取用户列表失败: "+s.message)}},ue=async()=>{try{const s=await k.getWebsiteStats();if(s.code===200){const{userStats:e}=s.data;H.value.forEach(r=>{r.userCount=e.usersByRole[r.key]||0})}else throw new Error(s.message||"获取角色统计失败")}catch(s){console.error("获取角色统计失败:",s),f.error("获取角色统计失败: "+s.message)}},de=async()=>{try{const s=await k.getMaintenanceMode();s.code===200&&(R.value=s.data.maintenanceMode||!1)}catch(s){console.error("获取系统设置失败:",s),R.value=!1}},ce=s=>{v.value=s,b.value=s.role,U.value=!0},me=async()=>{if(!(!v.value||!b.value))try{await te.confirm(`确定要将用户 "${v.value.nickname}" 的角色从 "${M(v.value.role)}" 修改为 "${M(b.value)}" 吗？`,"确认角色变更",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),L.value=!0;const s=await k.updateUserRole(v.value._id,b.value);if(s.code===200)f.success("角色修改成功"),v.value.role=b.value,U.value=!1,await V();else throw new Error(s.message||"角色修改失败")}catch(s){s!=="cancel"&&f.error("角色修改失败: "+s.message)}finally{L.value=!1}},pe=async s=>{const e=s.status==="active"?"inactive":"active",r=e==="active"?"启用":"禁用";try{await te.confirm(`确定要${r}用户 "${s.nickname}" 吗？`,`确认${r}`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const o=await k.updateUserStatus(s._id,e);if(o.code===200)f.success(`用户${r}成功`),s.status=e;else throw new Error(o.message||`用户${r}失败`)}catch(o){o!=="cancel"&&f.error(`用户${r}失败: `+o.message)}},_e=async s=>{F.value=!0;try{const e=s?"系统维护升级中，请稍后访问":"",r=await k.setMaintenanceMode(s,e);if(r.code===200)f.success(s?"维护模式已开启":"维护模式已关闭");else throw new Error(r.message||"设置维护模式失败")}catch(e){f.error("设置维护模式失败: "+e.message),R.value=!s}finally{F.value=!1}},fe=s=>{A.value=s,V()},ve=s=>{D.value=s,V()},ge=s=>new Date(s).toLocaleDateString("zh-CN"),ye=s=>{const e=new Date(s),o=new Date-e;return o<1e3*60?"刚刚":o<1e3*60*60?`${Math.floor(o/(1e3*60))}分钟前`:o<1e3*60*60*24?`${Math.floor(o/(1e3*60*60))}小时前`:e.toLocaleDateString("zh-CN")},be=s=>({view_records:"查看记录",submit_record:"提交成绩",edit_own_record:"编辑记录",admin_panel:"管理面板",manage_users:"用户管理",manage_permissions:"权限管理",system_config:"系统配置"})[s]||s,N=s=>({guest:"info",user:"primary",admin:"warning",super_admin:"danger"})[s]||"info";return Ne(()=>{if(!ne.hasPermission("super_admin_panel")){f.error("权限不足"),ae.push("/");return}K("dashboard")}),(s,e)=>{const r=i("el-tag"),o=i("el-icon"),y=i("el-menu-item"),Y=i("el-sub-menu"),we=i("el-menu"),h=i("el-button"),ke=i("el-empty"),z=i("el-card"),Ce=i("el-input"),P=i("el-option"),he=i("el-select"),S=i("el-table-column"),Se=i("el-button-group"),xe=i("el-table"),Ue=i("el-pagination"),Re=i("el-switch"),j=i("el-descriptions-item"),Ve=i("el-descriptions"),q=i("el-radio"),ze=i("el-radio-group"),$e=i("el-dialog"),Me=Fe("loading");return p(),_("div",Ye,[a("div",Ze,[a("aside",es,[a("div",ss,[e[10]||(e[10]=a("h2",null,"超级管理",-1)),t(r,{type:N(m(J).userRole),size:"small",effect:"plain"},{default:n(()=>[d(u(m(M)(m(J).userRole)),1)]),_:1},8,["type"])]),t(we,{"default-active":g.value,"onUpdate:defaultActive":e[0]||(e[0]=l=>g.value=l),class:"admin-menu",onSelect:oe},{default:n(()=>[t(Y,{index:"admin-functions"},{title:n(()=>[t(o,null,{default:n(()=>[t(m(Z))]),_:1}),e[11]||(e[11]=a("span",null,"管理员功能",-1))]),default:n(()=>[t(y,{index:"dashboard"},{default:n(()=>[t(o,null,{default:n(()=>[t(m(Z))]),_:1}),e[12]||(e[12]=a("span",null,"仪表板",-1))]),_:1}),t(y,{index:"records"},{default:n(()=>[t(o,null,{default:n(()=>[t(m(Pe))]),_:1}),e[13]||(e[13]=a("span",null,"成绩管理",-1))]),_:1}),t(y,{index:"feedback"},{default:n(()=>[t(o,null,{default:n(()=>[t(m(je))]),_:1}),e[14]||(e[14]=a("span",null,"用户反馈",-1))]),_:1}),t(y,{index:"users-stats"},{default:n(()=>[t(o,null,{default:n(()=>[t(m(qe))]),_:1}),e[15]||(e[15]=a("span",null,"用户统计",-1))]),_:1})]),_:1}),t(Y,{index:"super-admin-functions"},{title:n(()=>[t(o,null,{default:n(()=>[t(m(ee))]),_:1}),e[16]||(e[16]=a("span",null,"超级管理",-1))]),default:n(()=>[t(y,{index:"user-management"},{default:n(()=>[t(o,null,{default:n(()=>[t(m(We))]),_:1}),e[17]||(e[17]=a("span",null,"用户管理",-1))]),_:1}),t(y,{index:"role-management"},{default:n(()=>[t(o,null,{default:n(()=>[t(m(ee))]),_:1}),e[18]||(e[18]=a("span",null,"权限管理",-1))]),_:1}),t(y,{index:"system-settings"},{default:n(()=>[t(o,null,{default:n(()=>[t(m(Ie))]),_:1}),e[19]||(e[19]=a("span",null,"系统设置",-1))]),_:1})]),_:1})]),_:1},8,["default-active"]),a("div",ts,[t(h,{type:"primary",onClick:e[1]||(e[1]=l=>s.$router.push("/")),plain:""},{default:n(()=>[t(o,null,{default:n(()=>[t(m(Je))]),_:1}),e[20]||(e[20]=d(" 返回首页 "))]),_:1})])]),a("main",as,[g.value==="dashboard"?(p(),_("div",ns,[e[21]||(e[21]=a("h3",{class:"section-title"},"网站统计",-1)),t(Ke)])):w("",!0),g.value==="records"?(p(),_("div",ls,[e[22]||(e[22]=a("h3",{class:"section-title"},"成绩记录管理",-1)),t(Xe,{records:G.value,"show-actions":!1,"auto-refresh":!1,onRefresh:X},null,8,["records"])])):w("",!0),g.value==="feedback"?(p(),_("div",os,[e[23]||(e[23]=a("h3",{class:"section-title"},"用户反馈",-1)),t(z,{class:"feedback-card"},{default:n(()=>[a("div",rs,[(p(!0),_(W,null,I(E.value,l=>(p(),_("div",{key:l._id,class:"feedback-item"},[a("div",is,[a("span",us,u(l.nickname||"匿名用户"),1),a("span",ds,u(ye(l.timestamp)),1)]),a("div",cs,u(l.content),1),a("div",ms,[t(r,{type:l.status==="processed"?"success":"warning",size:"small"},{default:n(()=>[d(u(l.status==="processed"?"已处理":"待处理"),1)]),_:2},1032,["type"])])]))),128))]),E.value.length===0?(p(),_("div",ps,[t(ke,{description:"暂无用户反馈"})])):w("",!0)]),_:1})])):w("",!0),g.value==="users-stats"?(p(),_("div",_s,[e[32]||(e[32]=a("h3",{class:"section-title"},"用户统计信息",-1)),a("div",fs,[t(z,{class:"user-stat-card"},{default:n(()=>[e[27]||(e[27]=a("div",{class:"stat-header"},"角色分布",-1)),a("div",vs,[a("div",gs,[e[24]||(e[24]=a("span",{class:"role-name"},"普通用户",-1)),a("span",ys,u(C.value.userCount||0),1)]),a("div",bs,[e[25]||(e[25]=a("span",{class:"role-name"},"管理员",-1)),a("span",ws,u(C.value.adminCount||0),1)]),a("div",ks,[e[26]||(e[26]=a("span",{class:"role-name"},"超级管理员",-1)),a("span",Cs,u(C.value.superAdminCount||0),1)])])]),_:1}),t(z,{class:"user-stat-card"},{default:n(()=>[e[31]||(e[31]=a("div",{class:"stat-header"},"用户状态",-1)),a("div",hs,[a("div",Ss,[e[28]||(e[28]=a("span",{class:"status-name"},"活跃用户",-1)),a("span",xs,u(C.value.activeCount||0),1)]),a("div",Us,[e[29]||(e[29]=a("span",{class:"status-name"},"非活跃用户",-1)),a("span",Rs,u(C.value.inactiveCount||0),1)]),a("div",Vs,[e[30]||(e[30]=a("span",{class:"status-name"},"被禁用户",-1)),a("span",zs,u(C.value.bannedCount||0),1)])])]),_:1})])])):w("",!0),g.value==="user-management"?(p(),_("div",$s,[a("div",Ms,[e[34]||(e[34]=a("h3",{class:"section-title"},"用户管理",-1)),a("div",Ts,[t(Ce,{modelValue:B.value,"onUpdate:modelValue":e[2]||(e[2]=l=>B.value=l),placeholder:"搜索用户...",style:{width:"200px"},clearable:""},{prefix:n(()=>[t(o,null,{default:n(()=>[t(m(Oe))]),_:1})]),_:1},8,["modelValue"]),t(he,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=l=>x.value=l),placeholder:"筛选角色",style:{width:"120px"},clearable:""},{default:n(()=>[t(P,{label:"用户",value:"user"}),t(P,{label:"管理员",value:"admin"}),t(P,{label:"超级管理员",value:"super_admin"})]),_:1},8,["modelValue"]),t(h,{onClick:V,loading:T.value},{default:n(()=>[t(o,null,{default:n(()=>[t(m(Qe))]),_:1}),e[33]||(e[33]=d(" 刷新 "))]),_:1},8,["loading"])])]),Ge((p(),se(xe,{data:le.value,class:"users-table"},{default:n(()=>[t(S,{prop:"nickname",label:"昵称",width:"120"}),t(S,{prop:"email",label:"邮箱",width:"200"}),t(S,{prop:"role",label:"角色",width:"100"},{default:n(({row:l})=>[t(r,{type:N(l.role),size:"small",effect:"plain"},{default:n(()=>[d(u(m(M)(l.role)),1)]),_:2},1032,["type"])]),_:1}),t(S,{prop:"status",label:"状态",width:"80"},{default:n(({row:l})=>[t(r,{type:l.status==="active"?"success":"warning",size:"small"},{default:n(()=>[d(u(l.status==="active"?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(S,{prop:"createTime",label:"注册时间",width:"120"},{default:n(({row:l})=>[d(u(ge(l.createTime)),1)]),_:1}),t(S,{label:"操作",width:"200"},{default:n(({row:l})=>[t(Se,null,{default:n(()=>[t(h,{size:"small",onClick:$=>ce(l)},{default:n(()=>[t(o,null,{default:n(()=>[t(m(He))]),_:1}),e[35]||(e[35]=d(" 角色 "))]),_:2},1032,["onClick"]),t(h,{size:"small",type:l.status==="active"?"warning":"success",onClick:$=>pe(l)},{default:n(()=>[d(u(l.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Me,T.value]]),a("div",Bs,[t(Ue,{"current-page":D.value,"onUpdate:currentPage":e[4]||(e[4]=l=>D.value=l),"page-size":A.value,"onUpdate:pageSize":e[5]||(e[5]=l=>A.value=l),"page-sizes":[10,20,50,100],total:Q.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:fe,onCurrentChange:ve},null,8,["current-page","page-size","total"])])])):w("",!0),g.value==="role-management"?(p(),_("div",Ds,[e[37]||(e[37]=a("h3",{class:"section-title"},"权限管理",-1)),t(z,{class:"role-management-card"},{default:n(()=>[a("div",As,[e[36]||(e[36]=a("h4",null,"角色权限概览",-1)),a("div",Es,[(p(!0),_(W,null,I(H.value,l=>(p(),_("div",{key:l.key,class:"role-overview-item"},[a("div",Ns,[t(r,{type:N(l.key),effect:"plain"},{default:n(()=>[d(u(l.name),1)]),_:2},1032,["type"]),a("span",Ls,u(l.userCount)+" 用户",1)]),a("div",Fs,[(p(!0),_(W,null,I(l.permissions,$=>(p(),se(r,{key:$,size:"small",class:"permission-tag"},{default:n(()=>[d(u(be($)),1)]),_:2},1024))),128))])]))),128))])])]),_:1})])):w("",!0),g.value==="system-settings"?(p(),_("div",Ps,[e[39]||(e[39]=a("h3",{class:"section-title"},"系统设置",-1)),t(z,{class:"system-settings-card"},{default:n(()=>[a("div",js,[e[38]||(e[38]=a("div",{class:"setting-info"},[a("h4",null,"维护模式"),a("p",null,"开启后，网站将显示维护页面，仅管理员可访问")],-1)),t(Re,{modelValue:R.value,"onUpdate:modelValue":e[6]||(e[6]=l=>R.value=l),onChange:_e,loading:F.value,size:"large"},null,8,["modelValue","loading"])])]),_:1})])):w("",!0)])]),t($e,{modelValue:U.value,"onUpdate:modelValue":e[9]||(e[9]=l=>U.value=l),title:"编辑用户角色",width:"400px"},{footer:n(()=>{var l;return[t(h,{onClick:e[8]||(e[8]=$=>U.value=!1)},{default:n(()=>e[44]||(e[44]=[d("取消")])),_:1}),t(h,{type:"primary",onClick:me,loading:L.value,disabled:!b.value||b.value===((l=v.value)==null?void 0:l.role)},{default:n(()=>e[45]||(e[45]=[d(" 确认修改 ")])),_:1},8,["loading","disabled"])]}),default:n(()=>[v.value?(p(),_("div",qs,[t(Ve,{column:1,border:""},{default:n(()=>[t(j,{label:"用户昵称"},{default:n(()=>[d(u(v.value.nickname),1)]),_:1}),t(j,{label:"邮箱"},{default:n(()=>[d(u(v.value.email),1)]),_:1}),t(j,{label:"当前角色"},{default:n(()=>[t(r,{type:N(v.value.role),effect:"plain"},{default:n(()=>[d(u(m(M)(v.value.role)),1)]),_:1},8,["type"])]),_:1})]),_:1}),a("div",Ws,[e[43]||(e[43]=a("h4",null,"选择新角色：",-1)),t(ze,{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=l=>b.value=l)},{default:n(()=>[t(q,{label:"user"},{default:n(()=>[t(r,{type:"primary",effect:"plain"},{default:n(()=>e[40]||(e[40]=[d("用户")])),_:1})]),_:1}),t(q,{label:"admin"},{default:n(()=>[t(r,{type:"warning",effect:"plain"},{default:n(()=>e[41]||(e[41]=[d("管理员")])),_:1})]),_:1}),t(q,{label:"super_admin"},{default:n(()=>[t(r,{type:"danger",effect:"plain"},{default:n(()=>e[42]||(e[42]=[d("超级管理员")])),_:1})]),_:1})]),_:1},8,["modelValue"])])])):w("",!0)]),_:1},8,["modelValue"])])}}},Hs=Te(Is,[["__scopeId","data-v-0aadc5a4"]]);export{Hs as default};
