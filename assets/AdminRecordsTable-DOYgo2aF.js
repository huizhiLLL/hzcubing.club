import{_ as C,b as P,r as w,o as q,a as H,E as W,j as m,l as c,m as u,q as s,n as a,p as n,t as l,s as g,ad as R,a8 as Y,aa as G,ac as J,F as K,A as O,ae as Q,c as X,k as Z,a0 as ss,x,y as ts,z as N,d as z,v as D}from"./index-Bsn6c0zj.js";function ht(b){return{guest:"访客",user:"用户",admin:"管理员",super_admin:"顶级管理员"}[b]||"未知"}const es={class:"admin-dashboard"},as={class:"stats-grid"},os={class:"stat-content"},ls={class:"stat-value"},ns={class:"stat-extra"},is={class:"stat-content"},ds={class:"stat-value"},cs={class:"stat-extra"},rs={class:"stat-content"},us={class:"stat-value"},vs={class:"stat-extra"},_s={class:"stat-content"},ps={class:"stat-value"},hs={class:"activity-list"},ms={class:"activity-content"},fs={class:"activity-text"},gs={class:"activity-time"},bs={__name:"AdminDashboard",setup(b){const T=P(),v=w({totalVisits:0,visitsToday:0,visitsThisMonth:0,totalRecords:0,recordsThisMonth:0,totalUsers:0,usersThisMonth:0,activeUsers:0}),M=w([]),S=async()=>{try{const r=await H.getWebsiteStats();if(r.code===200){const{userStats:e,recordStats:_,visitStats:i,recentActivities:y}=r.data;v.value={totalVisits:i.totalVisits,visitsToday:i.visitsToday,visitsThisMonth:i.visitsThisMonth,totalRecords:_.totalRecords,recordsThisMonth:_.recordsThisMonth,totalUsers:e.totalUsers,usersThisMonth:e.usersThisMonth,activeUsers:e.activeUsers},M.value=y||[]}else throw new Error(r.message||"获取统计数据失败")}catch(r){W.error("加载统计数据失败: "+r.message);try{await T.fetchRecords(),v.value.totalRecords=T.records.length}catch{}}},k=r=>{const e=new Date(r),i=new Date-e;return i<1e3*60?"刚刚":i<1e3*60*60?`${Math.floor(i/(1e3*60))}分钟前`:i<1e3*60*60*24?`${Math.floor(i/(1e3*60*60))}小时前`:e.toLocaleDateString("zh-CN")};return q(()=>{S()}),(r,e)=>{const _=m("el-icon"),i=m("el-card");return c(),u("div",es,[s("div",as,[a(i,{class:"stat-card"},{default:n(()=>[s("div",os,[s("div",ls,l(v.value.totalVisits||"-"),1),e[0]||(e[0]=s("div",{class:"stat-label"},"主页访问量",-1)),a(_,{class:"stat-icon"},{default:n(()=>[a(g(R))]),_:1}),s("div",ns,"今日: "+l(v.value.visitsToday||0),1)])]),_:1}),a(i,{class:"stat-card"},{default:n(()=>[s("div",is,[s("div",ds,l(v.value.totalRecords||"-"),1),e[1]||(e[1]=s("div",{class:"stat-label"},"成绩提交数",-1)),a(_,{class:"stat-icon"},{default:n(()=>[a(g(Y))]),_:1}),s("div",cs,"本月: "+l(v.value.recordsThisMonth||0),1)])]),_:1}),a(i,{class:"stat-card"},{default:n(()=>[s("div",rs,[s("div",us,l(v.value.totalUsers||"-"),1),e[2]||(e[2]=s("div",{class:"stat-label"},"注册用户数",-1)),a(_,{class:"stat-icon"},{default:n(()=>[a(g(G))]),_:1}),s("div",vs,"本月: "+l(v.value.usersThisMonth||0),1)])]),_:1}),a(i,{class:"stat-card"},{default:n(()=>[s("div",_s,[s("div",ps,l(v.value.activeUsers||"-"),1),e[3]||(e[3]=s("div",{class:"stat-label"},"活跃用户数",-1)),a(_,{class:"stat-icon"},{default:n(()=>[a(g(J))]),_:1}),e[4]||(e[4]=s("div",{class:"stat-extra"},"30天内有活动",-1))])]),_:1})]),e[5]||(e[5]=s("h4",{class:"section-subtitle"},"最近活动",-1)),a(i,{class:"activity-card"},{default:n(()=>[s("div",hs,[(c(!0),u(K,null,O(M.value,y=>(c(),u("div",{key:y.id,class:"activity-item"},[a(_,{class:"activity-icon"},{default:n(()=>[a(g(Q))]),_:1}),s("div",ms,[s("div",fs,l(y.description),1),s("div",gs,l(k(y.timestamp)),1)])]))),128))])]),_:1})])}}},mt=C(bs,[["__scopeId","data-v-ead04ce6"]]),ys={class:"admin-records-container"},Ss={class:"table-header"},ks={class:"table-info"},$s={class:"record-count"},ws={class:"table-actions"},Ts={class:"user-info"},Ms={key:1,class:"anonymous-user"},xs={class:"time-cell"},Ds={key:0,class:"time-value"},Ns={key:1,class:"no-time"},zs={class:"time-cell"},Cs={key:0,class:"time-value"},Rs={key:1,class:"no-time"},Vs={class:"cube-info"},Us={class:"method-info"},As={class:"timestamp-cell"},Es={class:"date"},Fs={class:"time"},Bs={class:"action-buttons"},Ls={class:"pagination-container"},Is={key:0,class:"record-details"},js={class:"detail-section"},Ps={class:"detail-grid"},qs={class:"detail-item"},Hs={class:"value"},Ws={class:"detail-item"},Ys={class:"value"},Gs={class:"detail-item"},Js={class:"value"},Ks={class:"detail-section"},Os={class:"detail-grid"},Qs={class:"detail-item"},Xs={class:"value"},Zs={class:"detail-item"},st={class:"value"},tt={class:"detail-section"},et={class:"detail-grid"},at={class:"detail-item"},ot={class:"value"},lt={class:"detail-item"},nt={class:"value"},it={key:0,class:"detail-section"},dt={class:"remark-content"},ct={key:1,class:"detail-section"},rt={class:"video-link"},ut=["href"],vt={__name:"AdminRecordsTable",props:{records:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(b,{emit:T}){const v=b,M=T,S=w(1),k=w(20),r=w(!1),e=w(null),_=X(()=>{const d=(S.value-1)*k.value,t=d+k.value;return v.records.slice(d,t)}),i=(d,t=!1)=>{if(t){if(!d)return"-";const p=new Date(d);if(isNaN(p))return"-";const $=String(p.getHours()).padStart(2,"0"),h=String(p.getMinutes()).padStart(2,"0");return`${$}:${h}`}if(d==null||isNaN(d))return"-";const f=parseFloat(d);if(f>=60){const p=Math.floor(f/60),$=(f%60).toFixed(2);return`${p}:${$.padStart(5,"0")}`}else return f.toFixed(2)},y=d=>{if(!d)return"-";const t=new Date(d);if(isNaN(t))return"-";const f=t.getFullYear(),p=String(t.getMonth()+1).padStart(2,"0"),$=String(t.getDate()).padStart(2,"0");return`${f}.${p}.${$}`},V=d=>{e.value=d,r.value=!0},U=()=>{M("refresh")},A=d=>{k.value=d,S.value=1},E=d=>{S.value=d};return(d,t)=>{const f=m("el-icon"),p=m("el-button"),$=m("el-tag"),h=m("el-table-column"),F=m("router-link"),B=m("el-table"),L=m("el-pagination"),I=m("el-dialog"),j=Z("loading");return c(),u("div",ys,[s("div",Ss,[s("div",ks,[s("span",$s,"共 "+l(b.records.length)+" 条记录",1)]),s("div",ws,[a(p,{onClick:U,loading:b.loading,size:"small"},{default:n(()=>[a(f,null,{default:n(()=>[a(g(ss))]),_:1}),t[3]||(t[3]=x(" 刷新 "))]),_:1},8,["loading"])])]),ts((c(),N(B,{data:_.value,style:{width:"100%"},stripe:!0,class:"admin-records-table","default-sort":{prop:"timestamp",order:"descending"}},{default:n(()=>[a(h,{label:"项目",prop:"event",width:"100","show-overflow-tooltip":!0},{default:n(({row:o})=>[a($,{size:"small",type:"primary"},{default:n(()=>[x(l(g(z)(o.event)),1)]),_:2},1024)]),_:1}),a(h,{label:"用户",prop:"nickname",width:"120","show-overflow-tooltip":!0},{default:n(({row:o})=>[s("div",Ts,[o.userId?(c(),N(F,{key:0,to:`/user/${o.userId}`,class:"user-link"},{default:n(()=>[x(l(o.nickname||"匿名用户"),1)]),_:2},1032,["to"])):(c(),u("span",Ms,l(o.nickname||"匿名用户"),1))])]),_:1}),a(h,{label:"单次成绩",prop:"singleSeconds",width:"120",sortable:""},{default:n(({row:o})=>[s("div",xs,[o.singleSeconds!==null&&o.singleSeconds!==void 0?(c(),u("span",Ds,l(i(o.singleSeconds)),1)):(c(),u("span",Ns,"-"))])]),_:1}),a(h,{label:"平均成绩",prop:"averageSeconds",width:"120",sortable:""},{default:n(({row:o})=>[s("div",zs,[o.averageSeconds!==null&&o.averageSeconds!==void 0?(c(),u("span",Cs,l(i(o.averageSeconds)),1)):(c(),u("span",Rs,"-"))])]),_:1}),a(h,{label:"魔方",prop:"cube",width:"100","show-overflow-tooltip":!0},{default:n(({row:o})=>[s("span",Vs,l(o.cube||"-"),1)]),_:1}),a(h,{label:"方法",prop:"method",width:"100","show-overflow-tooltip":!0},{default:n(({row:o})=>[s("span",Us,l(o.method||"-"),1)]),_:1}),a(h,{label:"提交时间",prop:"timestamp",width:"140",sortable:""},{default:n(({row:o})=>[s("div",As,[s("div",Es,l(y(o.timestamp)),1),s("div",Fs,l(i(o.timestamp,!0)),1)])]),_:1}),a(h,{label:"操作",width:"120",fixed:"right"},{default:n(({row:o})=>[s("div",Bs,[a(p,{size:"small",onClick:_t=>V(o)},{default:n(()=>[a(f,null,{default:n(()=>[a(g(R))]),_:1}),t[4]||(t[4]=x(" 详情 "))]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[j,b.loading]]),s("div",Ls,[a(L,{"current-page":S.value,"onUpdate:currentPage":t[0]||(t[0]=o=>S.value=o),"page-size":k.value,"onUpdate:pageSize":t[1]||(t[1]=o=>k.value=o),"page-sizes":[10,20,50,100],total:b.records.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:A,onCurrentChange:E},null,8,["current-page","page-size","total"])]),a(I,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=o=>r.value=o),title:"成绩记录详情",width:"500px",class:"record-details-dialog"},{default:n(()=>[e.value?(c(),u("div",Is,[s("div",js,[t[8]||(t[8]=s("h4",null,"基本信息",-1)),s("div",Ps,[s("div",qs,[t[5]||(t[5]=s("span",{class:"label"},"项目:",-1)),s("span",Hs,l(g(z)(e.value.event)),1)]),s("div",Ws,[t[6]||(t[6]=s("span",{class:"label"},"用户:",-1)),s("span",Ys,l(e.value.nickname||"匿名用户"),1)]),s("div",Gs,[t[7]||(t[7]=s("span",{class:"label"},"提交时间:",-1)),s("span",Js,l(y(e.value.timestamp))+" "+l(i(e.value.timestamp,!0)),1)])])]),s("div",Ks,[t[11]||(t[11]=s("h4",null,"成绩信息",-1)),s("div",Os,[s("div",Qs,[t[9]||(t[9]=s("span",{class:"label"},"单次:",-1)),s("span",Xs,l(e.value.singleSeconds!==null&&e.value.singleSeconds!==void 0?i(e.value.singleSeconds):"-"),1)]),s("div",Zs,[t[10]||(t[10]=s("span",{class:"label"},"平均:",-1)),s("span",st,l(e.value.averageSeconds!==null&&e.value.averageSeconds!==void 0?i(e.value.averageSeconds):"-"),1)])])]),s("div",tt,[t[14]||(t[14]=s("h4",null,"设备信息",-1)),s("div",et,[s("div",at,[t[12]||(t[12]=s("span",{class:"label"},"魔方:",-1)),s("span",ot,l(e.value.cube||"-"),1)]),s("div",lt,[t[13]||(t[13]=s("span",{class:"label"},"方法:",-1)),s("span",nt,l(e.value.method||"-"),1)])])]),e.value.remark?(c(),u("div",it,[t[15]||(t[15]=s("h4",null,"备注",-1)),s("div",dt,l(e.value.remark),1)])):D("",!0),e.value.videoLink?(c(),u("div",ct,[t[16]||(t[16]=s("h4",null,"视频链接",-1)),s("div",rt,[s("a",{href:e.value.videoLink,target:"_blank",class:"link"},l(e.value.videoLink),9,ut)])])):D("",!0)])):D("",!0)]),_:1},8,["modelValue"])])}}},ft=C(vt,[["__scopeId","data-v-7e46a6e4"]]);export{mt as A,ft as a,ht as g};
