import{_ as L,h as P,u as j,J as q,b as I,r as p,o as J,E as h,a as x,j as _,l,m as i,q as e,n as a,p as o,x as D,t as r,s as d,a6 as W,a7 as G,a8 as H,a9 as K,aa as O,v as f,F as Q,A as X}from"./index-Bq31S5oz.js";import{g as Y,A as Z}from"./AdminDashboard-COTxgLR7.js";import{R as ss}from"./RecordsTable-Dy_ydgLE.js";const es={class:"admin-container"},ts={class:"admin-layout"},as={class:"admin-sidebar"},os={class:"sidebar-header"},ns={class:"sidebar-footer"},rs={class:"admin-main"},ls={key:0,class:"admin-section"},is={key:1,class:"admin-section"},ds={key:2,class:"admin-section"},us={class:"feedback-list"},cs={class:"feedback-header"},ms={class:"feedback-user"},_s={class:"feedback-time"},ps={class:"feedback-content"},fs={key:0,class:"empty-feedback"},vs={key:3,class:"admin-section"},bs={class:"user-stats-grid"},hs={class:"role-stats"},ys={class:"role-stat-item"},gs={class:"role-count"},ks={class:"role-stat-item"},Cs={class:"role-count"},ws={class:"role-stat-item"},Ss={class:"role-count"},Rs={class:"status-stats"},As={class:"status-stat-item"},xs={class:"status-count"},Ds={class:"status-stat-item"},Ts={class:"status-count"},Us={class:"status-stat-item"},Bs={class:"status-count"},Ms={__name:"AdminView",setup(Ns){const T=P(),g=j(),U=q(),k=I(),u=p("dashboard"),C=p(!1),c=p({userCount:0,adminCount:0,superAdminCount:0,activeCount:0,inactiveCount:0,bannedCount:0}),w=p([]),v=p([]),B=t=>{u.value=t,S(t)},S=async t=>{C.value=!0;try{switch(t){case"dashboard":break;case"records":await R();break;case"feedback":await M();break;case"users-stats":await N();break}}catch(s){h.error("加载数据失败: "+s.message)}finally{C.value=!1}},R=async()=>{try{await k.fetchRecords(),w.value=k.records}catch(t){console.error("获取成绩记录失败:",t)}},M=async()=>{try{const t=await x.getFeedbackList({page:1,pageSize:50});if(t.code===200)v.value=t.data||[];else throw new Error(t.message||"获取用户反馈失败")}catch(t){h.error("获取用户反馈失败: "+t.message),v.value=[]}},N=async()=>{try{const t=await x.getWebsiteStats();if(t.code===200){const{userStats:s}=t.data;c.value={userCount:s.usersByRole.user,adminCount:s.usersByRole.admin,superAdminCount:s.usersByRole.super_admin,activeCount:s.activeUsers,inactiveCount:s.inactiveUsers,bannedCount:s.bannedUsers}}else throw new Error(t.message||"获取用户统计失败")}catch(t){console.error("获取用户统计失败:",t),h.error("获取用户统计失败: "+t.message)}},V=t=>{const s=new Date(t),n=new Date-s;return n<1e3*60?"刚刚":n<1e3*60*60?`${Math.floor(n/(1e3*60))}分钟前`:n<1e3*60*60*24?`${Math.floor(n/(1e3*60*60))}小时前`:s.toLocaleDateString("zh-CN")},E=t=>({guest:"info",user:"primary",admin:"warning",super_admin:"danger"})[t]||"info";return J(()=>{if(!U.hasPermission("admin_panel")){h.error("权限不足"),T.push("/");return}S("dashboard")}),(t,s)=>{const A=_("el-tag"),n=_("el-icon"),b=_("el-menu-item"),F=_("el-menu"),$=_("el-button"),z=_("el-empty"),y=_("el-card");return l(),i("div",es,[e("div",ts,[e("aside",as,[e("div",os,[s[2]||(s[2]=e("h2",null,"管理面板",-1)),a(A,{type:E(d(g).userRole),size:"small",effect:"plain"},{default:o(()=>[D(r(d(Y)(d(g).userRole)),1)]),_:1},8,["type"])]),a(F,{"default-active":u.value,"onUpdate:defaultActive":s[0]||(s[0]=m=>u.value=m),class:"admin-menu",onSelect:B},{default:o(()=>[a(b,{index:"dashboard"},{default:o(()=>[a(n,null,{default:o(()=>[a(d(W))]),_:1}),s[3]||(s[3]=e("span",null,"仪表板",-1))]),_:1}),a(b,{index:"records"},{default:o(()=>[a(n,null,{default:o(()=>[a(d(G))]),_:1}),s[4]||(s[4]=e("span",null,"成绩管理",-1))]),_:1}),a(b,{index:"feedback"},{default:o(()=>[a(n,null,{default:o(()=>[a(d(H))]),_:1}),s[5]||(s[5]=e("span",null,"用户反馈",-1))]),_:1}),a(b,{index:"users-stats"},{default:o(()=>[a(n,null,{default:o(()=>[a(d(K))]),_:1}),s[6]||(s[6]=e("span",null,"用户统计",-1))]),_:1})]),_:1},8,["default-active"]),e("div",ns,[a($,{type:"primary",onClick:s[1]||(s[1]=m=>t.$router.push("/")),plain:""},{default:o(()=>[a(n,null,{default:o(()=>[a(d(O))]),_:1}),s[7]||(s[7]=D(" 返回首页 "))]),_:1})])]),e("main",rs,[u.value==="dashboard"?(l(),i("div",ls,[s[8]||(s[8]=e("h3",{class:"section-title"},"网站统计",-1)),a(Z)])):f("",!0),u.value==="records"?(l(),i("div",is,[s[9]||(s[9]=e("h3",{class:"section-title"},"成绩记录管理",-1)),a(ss,{records:w.value,"show-actions":!1,"auto-refresh":!1,onRefresh:R},null,8,["records"])])):f("",!0),u.value==="feedback"?(l(),i("div",ds,[s[10]||(s[10]=e("h3",{class:"section-title"},"用户反馈",-1)),a(y,{class:"feedback-card"},{default:o(()=>[e("div",us,[(l(!0),i(Q,null,X(v.value,m=>(l(),i("div",{key:m.id,class:"feedback-item"},[e("div",cs,[e("span",ms,r(m.nickname||"匿名用户"),1),e("span",_s,r(V(m.timestamp)),1)]),e("div",ps,r(m.content),1)]))),128))]),v.value.length===0?(l(),i("div",fs,[a(z,{description:"暂无用户反馈"})])):f("",!0)]),_:1})])):f("",!0),u.value==="users-stats"?(l(),i("div",vs,[s[19]||(s[19]=e("h3",{class:"section-title"},"用户统计信息",-1)),e("div",bs,[a(y,{class:"user-stat-card"},{default:o(()=>[s[14]||(s[14]=e("div",{class:"stat-header"},"角色分布",-1)),e("div",hs,[e("div",ys,[s[11]||(s[11]=e("span",{class:"role-name"},"普通用户",-1)),e("span",gs,r(c.value.userCount||0),1)]),e("div",ks,[s[12]||(s[12]=e("span",{class:"role-name"},"管理员",-1)),e("span",Cs,r(c.value.adminCount||0),1)]),e("div",ws,[s[13]||(s[13]=e("span",{class:"role-name"},"超级管理员",-1)),e("span",Ss,r(c.value.superAdminCount||0),1)])])]),_:1}),a(y,{class:"user-stat-card"},{default:o(()=>[s[18]||(s[18]=e("div",{class:"stat-header"},"用户状态",-1)),e("div",Rs,[e("div",As,[s[15]||(s[15]=e("span",{class:"status-name"},"活跃用户",-1)),e("span",xs,r(c.value.activeCount||0),1)]),e("div",Ds,[s[16]||(s[16]=e("span",{class:"status-name"},"非活跃用户",-1)),e("span",Ts,r(c.value.inactiveCount||0),1)]),e("div",Us,[s[17]||(s[17]=e("span",{class:"status-name"},"被禁用户",-1)),e("span",Bs,r(c.value.bannedCount||0),1)])])]),_:1})])])):f("",!0)])])])}}},$s=L(Ms,[["__scopeId","data-v-a0af582e"]]);export{$s as default};
