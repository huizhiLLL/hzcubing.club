import{_ as _e,r as p,u as Ve,c as M,o as we,a as B,E as y,O as xe,w as ke,j as m,l as v,m as b,q as s,n as l,p as o,z as ae,s as E,P as ze,x as w,v as I,Q as Ue,R as Le,t as x,F as R,A as Ce,S as oe,J as he,T as Me,N as Ee}from"./index-CK2GeIUh.js";const Se={class:"minecraft-container"},De={class:"tabs-container glass-card"},$e={class:"mc-locations"},Fe={class:"card-header"},Ie={class:"location-controls"},Te={class:"locations-content"},Ne={key:0,class:"loading-container"},Ye={key:1,class:"empty-locations"},qe={key:2,class:"locations-grid"},Be={class:"location-header"},Re={class:"location-coordinates"},Ae={class:"coordinate"},Xe={class:"value"},Ze={class:"coordinate"},Pe={class:"value"},We={class:"coordinate"},Je={class:"value"},Qe={key:0,class:"location-description"},je={class:"location-meta"},Oe={class:"location-author"},Ge={key:0,class:"location-actions"},He={key:3,class:"pagination-container"},Ke={class:"mc-info"},el={class:"server-info"},ll={class:"server-actions"},al={key:0,class:"mobile-coordinates-group"},ol={class:"centered-buttons"},tl={key:0,class:"mobile-coordinates-group"},sl={class:"centered-buttons"},nl={__name:"MinecraftView",setup(rl){const W=p("locations"),J=Ve(),S=M(()=>!!J.user),k=M(()=>J.user),A=p(window.innerWidth),V=M(()=>A.value<=768),L=M(()=>A.value<=480),Q=()=>{A.value=window.innerWidth};we(()=>{window.addEventListener("resize",Q),q()}),xe(()=>{window.removeEventListener("resize",Q)});const X=p([]),Z=p(!1),z=p(!1),T=p(!1),D=p(null),C=p(!1),P=p(null),n=p({_id:"",name:"",type:"主世界",x:0,y:64,z:0,description:""}),h=p(1),N=p(12),U=p(""),$=p(""),Y=M(()=>{let t=X.value;if(U.value&&(t=t.filter(e=>e.type===U.value)),$.value.trim()){const e=$.value.toLowerCase().trim();t=t.filter(c=>c.name.toLowerCase().includes(e))}return t}),te=M(()=>{const t=(h.value-1)*N.value,e=t+N.value;return Y.value.slice(t,e)});ke([U,$],()=>{h.value=1});const se=t=>{h.value=t},r=p({name:"",type:"主世界",x:0,y:64,z:0,description:""}),j={name:[{required:!0,message:"请输入地点名称",trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择维度类型",trigger:"change"}],x:[{required:!0,message:"请输入X坐标",trigger:"blur"}],y:[{required:!0,message:"请输入Y坐标",trigger:"blur"}],z:[{required:!0,message:"请输入Z坐标",trigger:"blur"}],description:[{max:200,message:"描述不能超过200个字符",trigger:"blur"}]},ne=()=>{navigator.clipboard.writeText("play.simpfun.cn:22788").then(()=>{y.success("服务器地址已复制到剪贴板")}).catch(()=>{y.error("复制失败，请手动复制")})},q=async()=>{Z.value=!0;try{const t=await B.getMcLocations("list");if(t.code===0)X.value=t.data||[],h.value=1;else throw new Error(t.message||"获取坐标信息失败")}catch(t){console.error("获取坐标信息出错:",t),y.error(t.message||"获取坐标信息失败，请稍后再试"),X.value=[]}finally{Z.value=!1}},O=()=>{if(!S.value){y.warning("请先登录后再添加坐标");return}T.value=!0},re=async()=>{D.value&&await D.value.validate(async t=>{var e,c,i;if(t){z.value=!0;try{if(!localStorage.getItem("token"))throw new Error("未登录或登录已过期");const g={...r.value,authorId:((e=k.value)==null?void 0:e._id)||((c=k.value)==null?void 0:c.id),authorName:((i=k.value)==null?void 0:i.nickname)||"匿名用户"};console.log("提交坐标数据:",g);const d=await B.addMcLocation(g);if(d.code===0)y.success("坐标添加成功"),G(),T.value=!1,q();else throw new Error(d.message||"添加坐标失败")}catch(f){console.error("添加坐标出错:",f),y.error(f.message||"添加坐标失败，请稍后再试")}finally{z.value=!1}}})},G=()=>{D.value&&D.value.resetFields()},ie=t=>({主世界:"success",下界:"danger",末地:"warning"})[t]||"",ue=t=>{if(!t)return"-";try{const e=new Date(t.$date||t),c=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),f=String(e.getDate()).padStart(2,"0");return`${c}.${i}.${f}`}catch{return"-"}},de=t=>{const e=`${t.x} ${t.y} ${t.z}`;navigator.clipboard.writeText(e).then(()=>{y.success(`坐标 ${e} 已复制到剪贴板`)}).catch(()=>{y.error("复制失败，请手动复制")})},ce=t=>{if(!S.value){y.warning("请先登录后再修改坐标");return}n.value._id=t._id,n.value.name=t.name,n.value.type=t.type,n.value.x=t.x,n.value.y=t.y,n.value.z=t.z,n.value.description=t.description,C.value=!0},pe=async()=>{P.value&&await P.value.validate(async t=>{var e,c,i;if(t){z.value=!0;try{if(!localStorage.getItem("token"))throw new Error("未登录或登录已过期");const g={...n.value,authorId:((e=k.value)==null?void 0:e._id)||((c=k.value)==null?void 0:c.id),authorName:((i=k.value)==null?void 0:i.nickname)||"匿名用户"};console.log("提交坐标数据:",g);const d=await B.updateMcLocation(g._id,g);if(d.code===0)y.success("坐标修改成功"),C.value=!1,q();else throw new Error(d.message||"修改坐标失败")}catch(f){console.error("修改坐标出错:",f),y.error(f.message||"修改坐标失败，请稍后再试")}finally{z.value=!1}}})},me=async()=>{try{if(await Ee.confirm("确定要删除这个坐标吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),!localStorage.getItem("token"))throw new Error("未登录或登录已过期");const e=await B.deleteMcLocation(n.value._id);if(e.code===0)y.success("坐标删除成功"),C.value=!1,q();else throw new Error(e.message||"删除坐标失败")}catch(t){if(t==="cancel")return;console.error("删除坐标出错:",t),y.error(t.message||"删除坐标失败，请稍后再试")}};return(t,e)=>{const c=m("el-input"),i=m("el-option"),f=m("el-select"),g=m("el-icon"),d=m("el-button"),ve=m("el-tag"),fe=m("el-pagination"),H=m("el-tab-pane"),F=m("el-descriptions-item"),ge=m("el-descriptions"),ye=m("el-tabs"),u=m("el-form-item"),_=m("el-input-number"),K=m("el-form"),ee=m("el-dialog");return v(),b(R,null,[s("div",Se,[e[39]||(e[39]=s("div",{class:"mc-header glass-header"},[s("h1",{class:"page-title"},"Minecraft 服务器")],-1)),s("div",De,[l(ye,{modelValue:W.value,"onUpdate:modelValue":e[3]||(e[3]=a=>W.value=a),class:"mc-tabs",stretch:""},{default:o(()=>[l(H,{label:"坐标信息",name:"locations"},{default:o(()=>[s("div",$e,[s("div",Fe,[e[26]||(e[26]=s("h2",null,"坐标信息（旧服已结档）",-1)),s("div",Ie,[l(c,{modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=a=>$.value=a),placeholder:"搜索坐标名称",clearable:"",class:"search-input","prefix-icon":"Search"},null,8,["modelValue"]),l(f,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=a=>U.value=a),placeholder:"筛选维度",class:"dimension-filter"},{default:o(()=>[l(i,{label:"全部维度",value:""}),l(i,{label:"主世界",value:"主世界"}),l(i,{label:"下界",value:"下界"}),l(i,{label:"末地",value:"末地"})]),_:1},8,["modelValue"]),S.value?(v(),ae(d,{key:0,type:"primary",size:"small",onClick:O},{default:o(()=>[l(g,null,{default:o(()=>[l(E(ze))]),_:1}),e[25]||(e[25]=w(" 添加坐标 "))]),_:1})):I("",!0)])]),s("div",Te,[Z.value?(v(),b("div",Ne,[l(g,{class:"is-loading"},{default:o(()=>[l(E(Ue))]),_:1}),e[27]||(e[27]=s("span",null,"加载中...",-1))])):Y.value.length===0?(v(),b("div",Ye,[l(g,null,{default:o(()=>[l(E(Le))]),_:1}),s("span",null,x(U.value?`暂无${U.value}的坐标信息`:"暂无坐标信息"),1),S.value?(v(),ae(d,{key:0,type:"primary",size:"small",onClick:O},{default:o(()=>e[28]||(e[28]=[w(" 添加第一个坐标 ")])),_:1})):I("",!0)])):(v(),b("div",qe,[(v(!0),b(R,null,Ce(te.value,a=>{var le;return v(),b("div",{key:a._id,class:"location-card glass-effect-light"},[s("div",Be,[s("h3",null,x(a.name),1),l(ve,{size:"small",type:ie(a.type)},{default:o(()=>[w(x(a.type),1)]),_:2},1032,["type"])]),s("div",Re,[s("div",Ae,[e[29]||(e[29]=s("span",{class:"label"},"X:",-1)),s("span",Xe,x(a.x),1)]),s("div",Ze,[e[30]||(e[30]=s("span",{class:"label"},"Y:",-1)),s("span",Pe,x(a.y),1)]),s("div",We,[e[31]||(e[31]=s("span",{class:"label"},"Z:",-1)),s("span",Je,x(a.z),1)]),l(d,{size:"small",type:"info",plain:"",class:"copy-coords-btn",onClick:be=>de(a)},{default:o(()=>[l(g,null,{default:o(()=>[l(E(oe))]),_:1})]),_:2},1032,["onClick"])]),a.description?(v(),b("div",Qe,x(a.description),1)):I("",!0),s("div",je,[s("span",Oe,x(a.authorName),1),s("span",{class:he(["location-date",{"mobile-hidden":V.value}])},x(ue(a.createdAt)),3),S.value&&a.authorId===((le=k.value)==null?void 0:le.id)?(v(),b("div",Ge,[l(d,{size:"small",type:"primary",text:"",onClick:be=>ce(a)},{default:o(()=>[l(g,null,{default:o(()=>[l(E(Me))]),_:1})]),_:2},1032,["onClick"])])):I("",!0)])])}),128))])),Y.value.length>N.value?(v(),b("div",He,[l(fe,{"current-page":h.value,"onUpdate:currentPage":e[2]||(e[2]=a=>h.value=a),"page-size":N.value,total:Y.value.length,layout:"prev, pager, next",background:"",onCurrentChange:se},null,8,["current-page","page-size","total"])])):I("",!0)])])]),_:1}),l(H,{label:"原版模组服",name:"server"},{default:o(()=>[s("div",Ke,[e[38]||(e[38]=s("div",{class:"card-header"},[s("h2",null,"服务器信息")],-1)),s("div",el,[l(ge,{column:1,border:""},{default:o(()=>[l(F,{label:"地址"},{default:o(()=>e[32]||(e[32]=[s("span",{class:"server-value"},"play.simpfun.cn",-1)])),_:1}),l(F,{label:"端口"},{default:o(()=>e[33]||(e[33]=[s("span",{class:"server-value"},"22788",-1)])),_:1}),l(F,{label:"版本"},{default:o(()=>e[34]||(e[34]=[s("div",{class:"server-value-multi"},[s("div",{class:"version-tag"},"Java 1.20.1")],-1)])),_:1}),l(F,{label:"类型"},{default:o(()=>e[35]||(e[35]=[s("div",{class:"server-type-tags"},[s("span",{class:"mc-tag"},"永恒枪械"),s("span",{class:"mc-tag"},"原版优化"),s("span",{class:"mc-tag"},"YSM")],-1)])),_:1}),l(F,{label:"说明"},{default:o(()=>e[36]||(e[36]=[s("div",null,"客户端见群文件",-1)])),_:1})]),_:1}),s("div",ll,[l(d,{type:"primary",onClick:ne,class:"copy-btn"},{default:o(()=>[l(g,{class:"copy-icon"},{default:o(()=>[l(E(oe))]),_:1}),e[37]||(e[37]=w(" 复制服务器地址 "))]),_:1})])])])]),_:1})]),_:1},8,["modelValue"])])]),l(ee,{modelValue:T.value,"onUpdate:modelValue":e[13]||(e[13]=a=>T.value=a),title:"添加坐标",width:V.value?"90%":"500px",class:"add-location-dialog glass-dialog",modal:!0,"append-to-body":!0,"z-index":2e3,"close-on-click-modal":!0,"overlay-class":"glass-overlay",fullscreen:!1},{default:o(()=>[l(K,{model:r.value,rules:j,ref_key:"locationFormRef",ref:D,"label-width":V.value?"auto":"80px","label-position":V.value?"top":"right",class:"glass-form"},{default:o(()=>[l(u,{label:"名称",prop:"name"},{default:o(()=>[l(c,{modelValue:r.value.name,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.name=a),placeholder:"地点名称",style:{width:"60%"}},null,8,["modelValue"])]),_:1}),l(u,{label:"维度",prop:"type"},{default:o(()=>[l(f,{modelValue:r.value.type,"onUpdate:modelValue":e[5]||(e[5]=a=>r.value.type=a),placeholder:"选择所在维度",style:{width:"30%"}},{default:o(()=>[l(i,{label:"主世界",value:"主世界"}),l(i,{label:"下界",value:"下界"}),l(i,{label:"末地",value:"末地"})]),_:1},8,["modelValue"])]),_:1}),V.value?(v(),b("div",al,[l(u,{label:"X",prop:"x",class:"mobile-coordinate-item"},{default:o(()=>[l(_,{modelValue:r.value.x,"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.x=a),precision:0,step:1,controls:!1,class:"mobile-coordinate-input"},null,8,["modelValue"])]),_:1}),l(u,{label:"Y",prop:"y",class:"mobile-coordinate-item"},{default:o(()=>[l(_,{modelValue:r.value.y,"onUpdate:modelValue":e[7]||(e[7]=a=>r.value.y=a),precision:0,step:1,controls:!1,class:"mobile-coordinate-input"},null,8,["modelValue"])]),_:1}),l(u,{label:"Z",prop:"z",class:"mobile-coordinate-item"},{default:o(()=>[l(_,{modelValue:r.value.z,"onUpdate:modelValue":e[8]||(e[8]=a=>r.value.z=a),precision:0,step:1,controls:!1,class:"mobile-coordinate-input"},null,8,["modelValue"])]),_:1})])):(v(),b(R,{key:1},[l(u,{label:"X坐标",prop:"x"},{default:o(()=>[l(_,{modelValue:r.value.x,"onUpdate:modelValue":e[9]||(e[9]=a=>r.value.x=a),precision:0,step:1,controls:!L.value,class:"coordinate-input"},null,8,["modelValue","controls"])]),_:1}),l(u,{label:"Y坐标",prop:"y"},{default:o(()=>[l(_,{modelValue:r.value.y,"onUpdate:modelValue":e[10]||(e[10]=a=>r.value.y=a),precision:0,step:1,controls:!L.value,class:"coordinate-input"},null,8,["modelValue","controls"])]),_:1}),l(u,{label:"Z坐标",prop:"z"},{default:o(()=>[l(_,{modelValue:r.value.z,"onUpdate:modelValue":e[11]||(e[11]=a=>r.value.z=a),precision:0,step:1,controls:!L.value,class:"coordinate-input"},null,8,["modelValue","controls"])]),_:1})],64)),l(u,{label:"描述",prop:"description"},{default:o(()=>[l(c,{modelValue:r.value.description,"onUpdate:modelValue":e[12]||(e[12]=a=>r.value.description=a),type:"textarea",rows:2,placeholder:"可选，添加对该地点的描述"},null,8,["modelValue"])]),_:1}),s("div",ol,[l(d,{type:"primary",onClick:re,loading:z.value},{default:o(()=>e[40]||(e[40]=[w("提交")])),_:1},8,["loading"]),l(d,{onClick:G},{default:o(()=>e[41]||(e[41]=[w("重置")])),_:1})])]),_:1},8,["model","label-width","label-position"])]),_:1},8,["modelValue","width"]),l(ee,{modelValue:C.value,"onUpdate:modelValue":e[24]||(e[24]=a=>C.value=a),title:"修改坐标",width:V.value?"90%":"500px",class:"edit-location-dialog glass-dialog",modal:!0,"append-to-body":!0,"z-index":2e3,"close-on-click-modal":!0,"overlay-class":"glass-overlay",fullscreen:!1},{default:o(()=>[l(K,{model:n.value,rules:j,ref_key:"editLocationFormRef",ref:P,"label-width":V.value?"auto":"80px","label-position":V.value?"top":"right",class:"glass-form"},{default:o(()=>[l(u,{label:"名称",prop:"name"},{default:o(()=>[l(c,{modelValue:n.value.name,"onUpdate:modelValue":e[14]||(e[14]=a=>n.value.name=a),placeholder:"地点名称",style:{width:"60%"}},null,8,["modelValue"])]),_:1}),l(u,{label:"维度",prop:"type"},{default:o(()=>[l(f,{modelValue:n.value.type,"onUpdate:modelValue":e[15]||(e[15]=a=>n.value.type=a),placeholder:"选择所在维度",style:{width:"30%"}},{default:o(()=>[l(i,{label:"主世界",value:"主世界"}),l(i,{label:"下界",value:"下界"}),l(i,{label:"末地",value:"末地"})]),_:1},8,["modelValue"])]),_:1}),V.value?(v(),b("div",tl,[l(u,{label:"X",prop:"x",class:"mobile-coordinate-item"},{default:o(()=>[l(_,{modelValue:n.value.x,"onUpdate:modelValue":e[16]||(e[16]=a=>n.value.x=a),precision:0,step:1,controls:!1,class:"mobile-coordinate-input"},null,8,["modelValue"])]),_:1}),l(u,{label:"Y",prop:"y",class:"mobile-coordinate-item"},{default:o(()=>[l(_,{modelValue:n.value.y,"onUpdate:modelValue":e[17]||(e[17]=a=>n.value.y=a),precision:0,step:1,controls:!1,class:"mobile-coordinate-input"},null,8,["modelValue"])]),_:1}),l(u,{label:"Z",prop:"z",class:"mobile-coordinate-item"},{default:o(()=>[l(_,{modelValue:n.value.z,"onUpdate:modelValue":e[18]||(e[18]=a=>n.value.z=a),precision:0,step:1,controls:!1,class:"mobile-coordinate-input"},null,8,["modelValue"])]),_:1})])):(v(),b(R,{key:1},[l(u,{label:"X坐标",prop:"x"},{default:o(()=>[l(_,{modelValue:n.value.x,"onUpdate:modelValue":e[19]||(e[19]=a=>n.value.x=a),precision:0,step:1,controls:!L.value,class:"coordinate-input"},null,8,["modelValue","controls"])]),_:1}),l(u,{label:"Y坐标",prop:"y"},{default:o(()=>[l(_,{modelValue:n.value.y,"onUpdate:modelValue":e[20]||(e[20]=a=>n.value.y=a),precision:0,step:1,controls:!L.value,class:"coordinate-input"},null,8,["modelValue","controls"])]),_:1}),l(u,{label:"Z坐标",prop:"z"},{default:o(()=>[l(_,{modelValue:n.value.z,"onUpdate:modelValue":e[21]||(e[21]=a=>n.value.z=a),precision:0,step:1,controls:!L.value,class:"coordinate-input"},null,8,["modelValue","controls"])]),_:1})],64)),l(u,{label:"描述",prop:"description"},{default:o(()=>[l(c,{modelValue:n.value.description,"onUpdate:modelValue":e[22]||(e[22]=a=>n.value.description=a),type:"textarea",rows:2,placeholder:"可选，添加对该地点的描述"},null,8,["modelValue"])]),_:1}),s("div",sl,[l(d,{type:"primary",onClick:pe,loading:z.value},{default:o(()=>e[42]||(e[42]=[w("保存修改")])),_:1},8,["loading"]),l(d,{onClick:e[23]||(e[23]=a=>C.value=!1)},{default:o(()=>e[43]||(e[43]=[w("取消")])),_:1}),l(d,{type:"danger",onClick:me,loading:z.value},{default:o(()=>e[44]||(e[44]=[w("删除坐标")])),_:1},8,["loading"])])]),_:1},8,["model","label-width","label-position"])]),_:1},8,["modelValue","width"])],64)}}},ul=_e(nl,[["__scopeId","data-v-fb969998"]]);export{ul as default};
