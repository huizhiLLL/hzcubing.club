import{_ as ie,h as re,u as ue,D as me,b as ce,r as u,o as ve,E as v,a as V,j as i,k as pe,l as p,m as _,q as a,n as t,p as l,x as m,t as c,s as r,a7 as fe,a8 as I,a9 as _e,aa as be,ab as ge,v as E,F as ye,A as we,P as Ce,a0 as ke,y as Ve,z as Ae,T as Ee,N as he,$ as Ne}from"./index-CK2GeIUh.js";import{g as xe,A as Me,a as Se}from"./AdminRecordsTable-C59pq0tC.js";/* empty css                                                                     */const De={class:"admin-container"},Ue={class:"admin-layout"},Re={class:"admin-sidebar"},$e={class:"sidebar-header"},Be={class:"sidebar-footer"},Te={class:"admin-main"},ze={key:0,class:"admin-section"},Fe={key:1,class:"admin-section"},qe={key:2,class:"admin-section"},Le={class:"feedback-list"},Pe={class:"feedback-header"},je={class:"feedback-user"},Ie={class:"feedback-time"},We={class:"feedback-content"},Ye={key:0,class:"empty-feedback"},Ge={key:3,class:"admin-section"},He={class:"user-stats-grid"},Je={class:"role-stats"},Ke={class:"role-stat-item"},Oe={class:"role-count"},Qe={class:"role-stat-item"},Xe={class:"role-count"},Ze={class:"role-stat-item"},et={class:"role-count"},tt={class:"status-stats"},st={class:"status-stat-item"},at={class:"status-count"},lt={class:"status-stat-item"},ot={class:"status-count"},nt={class:"status-stat-item"},dt={class:"status-count"},it={key:4,class:"admin-section"},rt={class:"section-header"},ut={class:"section-actions"},mt={__name:"AdminView",setup(ct){const W=re(),T=ue(),Y=me();ce();const b=u("dashboard"),z=u(!1),U=u(!1),y=u({userCount:0,adminCount:0,superAdminCount:0,activeCount:0,inactiveCount:0,bannedCount:0}),R=u([]),M=u([]),$=u([]),S=u(!1),h=u(!1),N=u(!1),n=u({eventCode:"",eventName:"",description:"",isActive:!0}),x=u(null),G=s=>{b.value=s,F(s)},F=async s=>{z.value=!0;try{switch(s){case"dashboard":break;case"records":await q();break;case"feedback":await H();break;case"users-stats":await J();break;case"meme-events":await D();break}}catch(e){v.error("加载数据失败: "+e.message)}finally{z.value=!1}},q=async()=>{U.value=!0;try{let s=[],e=1;const g=100;for(;;){const d=await V.getRecords({page:e,pageSize:g});if(d.code===200&&d.data&&d.data.length>0){if(s=s.concat(d.data),d.data.length<g)break;e++}else break}R.value=s,console.log(`管理员页面：获取到${s.length}条成绩记录`)}catch(s){console.error("获取成绩记录失败:",s),v.error("获取成绩记录失败: "+s.message),R.value=[]}finally{U.value=!1}},H=async()=>{try{const s=await V.getFeedbackList({page:1,pageSize:50});if(s.code===200)M.value=s.data||[];else throw new Error(s.message||"获取用户反馈失败")}catch(s){v.error("获取用户反馈失败: "+s.message),M.value=[]}},J=async()=>{try{const s=await V.getWebsiteStats();if(s.code===200){const{userStats:e}=s.data;y.value={userCount:e.usersByRole.user,adminCount:e.usersByRole.admin,superAdminCount:e.usersByRole.super_admin,activeCount:e.activeUsers,inactiveCount:e.inactiveUsers,bannedCount:e.bannedUsers}}else throw new Error(s.message||"获取用户统计失败")}catch(s){console.error("获取用户统计失败:",s),v.error("获取用户统计失败: "+s.message)}},K=s=>{const e=new Date(s),d=new Date-e;return d<1e3*60?"刚刚":d<1e3*60*60?`${Math.floor(d/(1e3*60))}分钟前`:d<1e3*60*60*24?`${Math.floor(d/(1e3*60*60))}小时前`:e.toLocaleDateString("zh-CN")},D=async()=>{S.value=!0;try{const s=await V.getMemeEvents({page:1,pageSize:50});if(s.code===200)$.value=s.data||[];else throw new Error(s.message||"获取整活项目失败")}catch(s){v.error("获取整活项目失败: "+s.message),$.value=[]}finally{S.value=!1}},O=()=>{n.value={eventCode:"",eventName:"",description:"",isActive:!0},x.value=null,h.value=!0},Q=s=>{x.value=s,n.value={eventCode:s.eventCode,eventName:s.eventName,description:s.description||"",isActive:s.isActive!==void 0?s.isActive:!0},N.value=!0},X=async s=>{try{await he.confirm(`确定要删除整活项目 "${s.eventName}" 吗？如果该项目已有成绩记录，将无法删除。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await V.deleteMemeEvent(s._id);if(e.code===200)v.success("整活项目删除成功"),await D();else throw new Error(e.message||"删除失败")}catch(e){e!=="cancel"&&v.error("删除失败: "+e.message)}},L=async()=>{try{if(!n.value.eventCode||!n.value.eventName){v.error("项目代码和名称不能为空");return}const s={eventCode:n.value.eventCode,eventName:n.value.eventName,description:n.value.description,isActive:n.value.isActive};let e;if(x.value?e=await V.updateMemeEvent({id:x.value._id,...s}):e=await V.addMemeEvent(s),e.code===200)v.success(x.value?"整活项目修改成功":"整活项目添加成功"),h.value=!1,N.value=!1,await D();else throw new Error(e.message||"操作失败")}catch(s){v.error("操作失败: "+s.message)}},Z=s=>{if(!s)return"-";const e=new Date(s);if(isNaN(e))return"-";const g=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),w=String(e.getDate()).padStart(2,"0");return`${g}.${d}.${w}`},ee=s=>({guest:"info",user:"primary",admin:"warning",super_admin:"danger"})[s]||"info";return ve(()=>{if(!Y.hasPermission("admin_panel")){v.error("权限不足"),W.push("/");return}F("dashboard")}),(s,e)=>{const g=i("el-tag"),d=i("el-icon"),w=i("el-menu-item"),te=i("el-menu"),f=i("el-button"),se=i("el-empty"),B=i("el-card"),C=i("el-table-column"),ae=i("el-button-group"),le=i("el-table"),A=i("el-input"),k=i("el-form-item"),P=i("el-form"),j=i("el-dialog"),oe=i("el-switch"),ne=pe("loading");return p(),_("div",De,[a("div",Ue,[a("aside",Re,[a("div",$e,[e[13]||(e[13]=a("h2",null,"管理面板",-1)),t(g,{type:ee(r(T).userRole),size:"small",effect:"plain"},{default:l(()=>[m(c(r(xe)(r(T).userRole)),1)]),_:1},8,["type"])]),t(te,{"default-active":b.value,"onUpdate:defaultActive":e[0]||(e[0]=o=>b.value=o),class:"admin-menu",onSelect:G},{default:l(()=>[t(w,{index:"dashboard"},{default:l(()=>[t(d,null,{default:l(()=>[t(r(fe))]),_:1}),e[14]||(e[14]=a("span",null,"仪表板",-1))]),_:1}),t(w,{index:"records"},{default:l(()=>[t(d,null,{default:l(()=>[t(r(I))]),_:1}),e[15]||(e[15]=a("span",null,"成绩管理",-1))]),_:1}),t(w,{index:"feedback"},{default:l(()=>[t(d,null,{default:l(()=>[t(r(_e))]),_:1}),e[16]||(e[16]=a("span",null,"用户反馈",-1))]),_:1}),t(w,{index:"users-stats"},{default:l(()=>[t(d,null,{default:l(()=>[t(r(be))]),_:1}),e[17]||(e[17]=a("span",null,"用户统计",-1))]),_:1}),t(w,{index:"meme-events"},{default:l(()=>[t(d,null,{default:l(()=>[t(r(I))]),_:1}),e[18]||(e[18]=a("span",null,"整活项目",-1))]),_:1})]),_:1},8,["default-active"]),a("div",Be,[t(f,{type:"primary",onClick:e[1]||(e[1]=o=>s.$router.push("/")),plain:""},{default:l(()=>[t(d,null,{default:l(()=>[t(r(ge))]),_:1}),e[19]||(e[19]=m(" 返回首页 "))]),_:1})])]),a("main",Te,[b.value==="dashboard"?(p(),_("div",ze,[e[20]||(e[20]=a("h3",{class:"section-title"},"网站统计",-1)),t(Me)])):E("",!0),b.value==="records"?(p(),_("div",Fe,[e[21]||(e[21]=a("h3",{class:"section-title"},"成绩记录管理",-1)),t(Se,{records:R.value,loading:U.value,onRefresh:q},null,8,["records","loading"])])):E("",!0),b.value==="feedback"?(p(),_("div",qe,[e[22]||(e[22]=a("h3",{class:"section-title"},"用户反馈",-1)),t(B,{class:"feedback-card"},{default:l(()=>[a("div",Le,[(p(!0),_(ye,null,we(M.value,o=>(p(),_("div",{key:o.id,class:"feedback-item"},[a("div",Pe,[a("span",je,c(o.nickname||"匿名用户"),1),a("span",Ie,c(K(o.timestamp)),1)]),a("div",We,c(o.content),1)]))),128))]),M.value.length===0?(p(),_("div",Ye,[t(se,{description:"暂无用户反馈"})])):E("",!0)]),_:1})])):E("",!0),b.value==="users-stats"?(p(),_("div",Ge,[e[31]||(e[31]=a("h3",{class:"section-title"},"用户统计信息",-1)),a("div",He,[t(B,{class:"user-stat-card"},{default:l(()=>[e[26]||(e[26]=a("div",{class:"stat-header"},"角色分布",-1)),a("div",Je,[a("div",Ke,[e[23]||(e[23]=a("span",{class:"role-name"},"普通用户",-1)),a("span",Oe,c(y.value.userCount||0),1)]),a("div",Qe,[e[24]||(e[24]=a("span",{class:"role-name"},"管理员",-1)),a("span",Xe,c(y.value.adminCount||0),1)]),a("div",Ze,[e[25]||(e[25]=a("span",{class:"role-name"},"超级管理员",-1)),a("span",et,c(y.value.superAdminCount||0),1)])])]),_:1}),t(B,{class:"user-stat-card"},{default:l(()=>[e[30]||(e[30]=a("div",{class:"stat-header"},"用户状态",-1)),a("div",tt,[a("div",st,[e[27]||(e[27]=a("span",{class:"status-name"},"活跃用户",-1)),a("span",at,c(y.value.activeCount||0),1)]),a("div",lt,[e[28]||(e[28]=a("span",{class:"status-name"},"非活跃用户",-1)),a("span",ot,c(y.value.inactiveCount||0),1)]),a("div",nt,[e[29]||(e[29]=a("span",{class:"status-name"},"被禁用户",-1)),a("span",dt,c(y.value.bannedCount||0),1)])])]),_:1})])])):E("",!0),b.value==="meme-events"?(p(),_("div",it,[a("div",rt,[e[34]||(e[34]=a("h3",{class:"section-title"},"整活项目管理",-1)),a("div",ut,[t(f,{type:"primary",onClick:O},{default:l(()=>[t(d,null,{default:l(()=>[t(r(Ce))]),_:1}),e[32]||(e[32]=m(" 添加项目 "))]),_:1}),t(f,{onClick:D,loading:S.value},{default:l(()=>[t(d,null,{default:l(()=>[t(r(ke))]),_:1}),e[33]||(e[33]=m(" 刷新 "))]),_:1},8,["loading"])])]),Ve((p(),Ae(le,{data:$.value,class:"meme-events-table"},{default:l(()=>[t(C,{prop:"eventCode",label:"项目代码",width:"120"}),t(C,{prop:"eventName",label:"项目名称",width:"200"}),t(C,{prop:"description",label:"描述","show-overflow-tooltip":!0}),t(C,{prop:"isActive",label:"状态",width:"80"},{default:l(({row:o})=>[t(g,{type:o.isActive?"success":"warning",size:"small"},{default:l(()=>[m(c(o.isActive?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(C,{prop:"createdAt",label:"创建时间",width:"120"},{default:l(({row:o})=>[m(c(Z(o.createdAt)),1)]),_:1}),t(C,{prop:"createdByName",label:"创建者",width:"100"}),t(C,{label:"操作",width:"200"},{default:l(({row:o})=>[t(ae,null,{default:l(()=>[t(f,{size:"small",onClick:de=>Q(o)},{default:l(()=>[t(d,null,{default:l(()=>[t(r(Ee))]),_:1}),e[35]||(e[35]=m(" 编辑 "))]),_:2},1032,["onClick"]),t(f,{size:"small",type:"danger",onClick:de=>X(o)},{default:l(()=>[t(d,null,{default:l(()=>[t(r(Ne))]),_:1}),e[36]||(e[36]=m(" 删除 "))]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ne,S.value]])])):E("",!0)])]),t(j,{modelValue:h.value,"onUpdate:modelValue":e[6]||(e[6]=o=>h.value=o),title:"添加整活项目",width:"500px"},{footer:l(()=>[t(f,{onClick:e[5]||(e[5]=o=>h.value=!1)},{default:l(()=>e[38]||(e[38]=[m("取消")])),_:1}),t(f,{type:"primary",onClick:L},{default:l(()=>e[39]||(e[39]=[m("确认添加")])),_:1})]),default:l(()=>[t(P,{model:n.value,"label-width":"80px"},{default:l(()=>[t(k,{label:"项目代码",required:""},{default:l(()=>[t(A,{modelValue:n.value.eventCode,"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.eventCode=o),placeholder:"如: 250ml牛奶"},null,8,["modelValue"]),e[37]||(e[37]=a("div",{class:"form-tip"},"项目代码用于系统识别，添加后不可修改",-1))]),_:1}),t(k,{label:"项目名称",required:""},{default:l(()=>[t(A,{modelValue:n.value.eventName,"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.eventName=o),placeholder:"如: 250ml牛奶"},null,8,["modelValue"])]),_:1}),t(k,{label:"项目描述"},{default:l(()=>[t(A,{modelValue:n.value.description,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.description=o),type:"textarea",rows:3,placeholder:"项目的详细描述（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(j,{modelValue:N.value,"onUpdate:modelValue":e[12]||(e[12]=o=>N.value=o),title:"编辑整活项目",width:"500px"},{footer:l(()=>[t(f,{onClick:e[11]||(e[11]=o=>N.value=!1)},{default:l(()=>e[41]||(e[41]=[m("取消")])),_:1}),t(f,{type:"primary",onClick:L},{default:l(()=>e[42]||(e[42]=[m("确认修改")])),_:1})]),default:l(()=>[t(P,{model:n.value,"label-width":"80px"},{default:l(()=>[t(k,{label:"项目代码",required:""},{default:l(()=>[t(A,{modelValue:n.value.eventCode,"onUpdate:modelValue":e[7]||(e[7]=o=>n.value.eventCode=o),disabled:""},null,8,["modelValue"]),e[40]||(e[40]=a("div",{class:"form-tip"},"项目代码不可修改",-1))]),_:1}),t(k,{label:"项目名称",required:""},{default:l(()=>[t(A,{modelValue:n.value.eventName,"onUpdate:modelValue":e[8]||(e[8]=o=>n.value.eventName=o),placeholder:"如: 250ml牛奶"},null,8,["modelValue"])]),_:1}),t(k,{label:"项目描述"},{default:l(()=>[t(A,{modelValue:n.value.description,"onUpdate:modelValue":e[9]||(e[9]=o=>n.value.description=o),type:"textarea",rows:3,placeholder:"项目的详细描述（可选）"},null,8,["modelValue"])]),_:1}),t(k,{label:"状态"},{default:l(()=>[t(oe,{modelValue:n.value.isActive,"onUpdate:modelValue":e[10]||(e[10]=o=>n.value.isActive=o),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},_t=ie(mt,[["__scopeId","data-v-c98adca4"]]);export{_t as default};
