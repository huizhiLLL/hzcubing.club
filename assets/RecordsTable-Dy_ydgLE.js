import{_ as J,b as P,u as Y,J as G,r as p,c as K,o as O,E as h,j as y,k as Q,l,m as r,y as W,z as m,p as i,n as v,x as c,t as o,s as M,d as T,q as t,v as u}from"./index-Bq31S5oz.js";const X={class:"table-container"},Z={key:1},ee={class:"record-cell"},se={key:0,class:"record-value"},ae={key:0,class:"rank"},le={key:1},te={key:2,class:"holder-nickname"},oe={key:1},ne={class:"record-cell"},re={key:0,class:"record-value"},de={key:0,class:"rank"},ie={key:1},ue={key:2,class:"holder-nickname"},ce={key:1},ve={key:1},_e={key:0,class:"record-details glass-form"},me={class:"detail-item"},ge={class:"value"},ke={class:"detail-item"},fe={class:"value"},pe={key:0,class:"detail-item"},ye={class:"value"},we={key:1},he={key:1,class:"detail-item"},be={class:"value"},He={key:2,class:"detail-item"},Ne={class:"value"},Se={class:"detail-item"},Ue={class:"value"},Ie={key:3,class:"detail-item"},Re={class:"value"},Ve={key:1},$e={key:4,class:"detail-item"},De={class:"value"},Ce={key:5,class:"detail-item"},xe=["href"],Be={key:6,class:"detail-item"},Me={class:"value"},Te={key:7,class:"actions"},Ee={class:"dialog-footer"},Le={__name:"RecordsTable",props:{records:{type:Array,default:()=>[]},showActions:{type:Boolean,default:!0},autoRefresh:{type:Boolean,default:!0},isDebug:{type:Boolean,default:!1}},emits:["refresh","delete"],setup(E,{emit:L}){const b=E,H=L,N=P(),D=Y();G();const S=p(!1),U=p(!1),I=p(!1),g=p(!1),a=p(null),C=n=>{var e,d;return n.cube||((e=n.single)==null?void 0:e.cube)||((d=n.average)==null?void 0:d.cube)||""},x=n=>{var e,d;return n.method||((e=n.single)==null?void 0:e.method)||((d=n.average)==null?void 0:d.method)||""},R=n=>n!=null&&n!=="null"&&n!=="",w=n=>N.formatTime(n),z=(n,e=!1)=>{if(!n)return"-";const d=new Date(n);if(isNaN(d))return"-";const _=d.getFullYear(),V=String(d.getMonth()+1).padStart(2,"0"),k=String(d.getDate()).padStart(2,"0");let f=`${_}.${V}.${k}`;if(e){const $=String(d.getHours()).padStart(2,"0"),s=String(d.getMinutes()).padStart(2,"0");f+=` ${$}:${s}`}return f},A=K(()=>b.records),B=async()=>{if(b.autoRefresh){S.value=!0;try{await N.fetchRecords(),H("refresh")}catch{h.error("刷新数据失败")}finally{S.value=!1}}else H("refresh")},F=n=>!D.user||!n?!1:n.userId===D.user._id,j=()=>{g.value=!0},q=async()=>{if(!a.value||!a.value._id){h.error("无法删除，记录ID不存在"),g.value=!1;return}U.value=!0;try{await N.deleteRecord(a.value._id),h.success("记录已删除"),g.value=!1,I.value=!1,H("delete",a.value._id),B()}catch(n){h.error("删除失败: "+n.message)}finally{U.value=!1}};return O(()=>{b.autoRefresh&&B()}),(n,e)=>{const d=y("el-table-column"),_=y("router-link"),V=y("el-table"),k=y("el-button"),f=y("el-dialog"),$=Q("loading");return l(),r("div",X,[W((l(),m(V,{data:A.value,style:{width:"100%"},stripe:!0,class:"records-table glass-table"},{default:i(()=>[v(d,{label:"项目","min-width":"100"},{default:i(s=>[c(o(M(T)(s.row.event)),1)]),_:1}),v(d,{label:"昵称","min-width":"120","class-name":"nickname-column"},{default:i(s=>[s.row.singleHolderUserId?(l(),m(_,{key:0,to:`/user/${s.row.singleHolderUserId}`,class:"player-name-link"},{default:i(()=>[c(o(s.row.singleHolderNickname||"-"),1)]),_:2},1032,["to"])):(l(),r("span",Z,o(s.row.singleHolderNickname||"-"),1))]),_:1}),v(d,{label:"单次","min-width":"100"},{default:i(s=>[t("div",ee,[s.row.singleSeconds!==void 0?(l(),r("span",se,[c(o(w(s.row.singleSeconds))+" ",1),s.row.singleRank?(l(),r("span",ae,"(#"+o(s.row.singleRank)+")",1)):u("",!0)])):(l(),r("span",le,"-")),s.row.singleHolderNickname?(l(),r("span",te,[s.row.singleHolderUserId?(l(),m(_,{key:0,to:`/user/${s.row.singleHolderUserId}`,class:"player-name-link"},{default:i(()=>[c(o(s.row.singleHolderNickname),1)]),_:2},1032,["to"])):(l(),r("span",oe,o(s.row.singleHolderNickname),1))])):u("",!0)])]),_:1}),v(d,{label:"平均","min-width":"100"},{default:i(s=>[t("div",ne,[s.row.averageSeconds!==void 0?(l(),r("span",re,[c(o(w(s.row.averageSeconds))+" ",1),s.row.averageRank?(l(),r("span",de,"(#"+o(s.row.averageRank)+")",1)):u("",!0)])):(l(),r("span",ie,"-")),s.row.averageHolderNickname?(l(),r("span",ue,[s.row.averageHolderUserId?(l(),m(_,{key:0,to:`/user/${s.row.averageHolderUserId}`,class:"player-name-link"},{default:i(()=>[c(o(s.row.averageHolderNickname),1)]),_:2},1032,["to"])):(l(),r("span",ce,o(s.row.averageHolderNickname),1))])):u("",!0)])]),_:1}),v(d,{label:"昵称","min-width":"120","class-name":"nickname-column"},{default:i(s=>[s.row.averageHolderUserId?(l(),m(_,{key:0,to:`/user/${s.row.averageHolderUserId}`,class:"player-name-link"},{default:i(()=>[c(o(s.row.averageHolderNickname||"-"),1)]),_:2},1032,["to"])):(l(),r("span",ve,o(s.row.averageHolderNickname||"-"),1))]),_:1})]),_:1},8,["data"])),[[$,S.value]]),v(f,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=s=>I.value=s),title:"成绩详情",width:"500px",class:"glass-dialog"},{default:i(()=>[a.value?(l(),r("div",_e,[t("div",me,[e[3]||(e[3]=t("span",{class:"label"},"项目:",-1)),t("span",ge,o(M(T)(a.value.event)),1)]),t("div",ke,[e[4]||(e[4]=t("span",{class:"label"},"单次成绩:",-1)),t("span",fe,o(a.value.singleSeconds?w(a.value.singleSeconds):"-"),1)]),a.value.singleHolderUserId||a.value.singleHolderNickname?(l(),r("div",pe,[e[5]||(e[5]=t("span",{class:"label"},"单次保持者:",-1)),t("span",ye,[a.value.singleHolderUserId?(l(),m(_,{key:0,to:`/user/${a.value.singleHolderUserId}`,class:"player-name-link"},{default:i(()=>[c(o(a.value.singleHolderNickname||"-"),1)]),_:1},8,["to"])):(l(),r("span",we,o(a.value.singleHolderNickname||"-"),1))])])):u("",!0),R(C(a.value))?(l(),r("div",he,[e[6]||(e[6]=t("span",{class:"label"},"使用魔方:",-1)),t("span",be,o(C(a.value)),1)])):u("",!0),R(x(a.value))?(l(),r("div",He,[e[7]||(e[7]=t("span",{class:"label"},"使用方法:",-1)),t("span",Ne,o(x(a.value)),1)])):u("",!0),t("div",Se,[e[8]||(e[8]=t("span",{class:"label"},"平均成绩:",-1)),t("span",Ue,o(a.value.averageSeconds!==void 0?w(a.value.averageSeconds):"-"),1)]),a.value.averageHolderUserId||a.value.averageHolderNickname?(l(),r("div",Ie,[e[9]||(e[9]=t("span",{class:"label"},"平均保持者:",-1)),t("span",Re,[a.value.averageHolderUserId?(l(),m(_,{key:0,to:`/user/${a.value.averageHolderUserId}`,class:"player-name-link"},{default:i(()=>[c(o(a.value.averageHolderNickname||"-"),1)]),_:1},8,["to"])):(l(),r("span",Ve,o(a.value.averageHolderNickname||"-"),1))])])):u("",!0),R(a.value.remark)?(l(),r("div",$e,[e[10]||(e[10]=t("span",{class:"label"},"备注:",-1)),t("span",De,o(a.value.remark),1)])):u("",!0),a.value.videoLink?(l(),r("div",Ce,[e[11]||(e[11]=t("span",{class:"label"},"视频链接:",-1)),t("a",{href:a.value.videoLink,target:"_blank",class:"video-link"},o(a.value.videoLink),9,xe)])):u("",!0),a.value.timestamp?(l(),r("div",Be,[e[12]||(e[12]=t("span",{class:"label"},"提交时间:",-1)),t("span",Me,o(z(a.value.timestamp,!0)),1)])):u("",!0),F(a.value)?(l(),r("div",Te,[v(k,{type:"danger",size:"small",onClick:j},{default:i(()=>e[13]||(e[13]=[c("删除")])),_:1})])):u("",!0)])):u("",!0)]),_:1},8,["modelValue"]),v(f,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=s=>g.value=s),title:"确认删除",width:"300px",class:"glass-dialog"},{footer:i(()=>[t("span",Ee,[v(k,{onClick:e[1]||(e[1]=s=>g.value=!1)},{default:i(()=>e[14]||(e[14]=[c("取消")])),_:1}),v(k,{type:"danger",onClick:q,loading:U.value},{default:i(()=>e[15]||(e[15]=[c("确定")])),_:1},8,["loading"])])]),default:i(()=>[e[16]||(e[16]=t("p",null,"确定要删除这条成绩记录吗？此操作不可恢复。",-1))]),_:1},8,["modelValue"])])}}},Ae=J(Le,[["__scopeId","data-v-9c2186dd"]]);export{Ae as R};
